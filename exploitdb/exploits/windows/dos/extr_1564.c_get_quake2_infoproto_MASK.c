#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  char u_char ;
typedef  int /*<<< orphan*/  buff ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int BUFFSZ ; 
 int /*<<< orphan*/  IPPROTO_UDP ; 
 int MAXPROTO ; 
 int MINPROTO ; 
 int /*<<< orphan*/  SOCK_DGRAM ; 
 int /*<<< orphan*/  FUNC0 (int) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (char,int /*<<< orphan*/ ) ; 
 int FUNC3 (char*,int) ; 
 int /*<<< orphan*/  FUNC4 (char*,...) ; 
 int FUNC5 (int,int /*<<< orphan*/ ,int /*<<< orphan*/ ,char*,int,char*,...) ; 
 int FUNC6 (int,char*,int,char*,int,int) ; 
 int FUNC7 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC8 (char*,char*,int*) ; 
 int /*<<< orphan*/  FUNC9 () ; 
 int /*<<< orphan*/  stdout ; 
 char* FUNC10 (char*,char) ; 
 int /*<<< orphan*/  FUNC11 (char*,char*) ; 

void FUNC12(int onlyinfo, int *retproto) {
    int     sd,
            len,
            proto;
    u_char  buff[BUFFSZ],
            *text,
            *p;

    proto = 35;
    text  = buff + 4;

    FUNC4("- request informations and retrieve server protocol:\n");
    sd = FUNC7(AF_INET, SOCK_DGRAM, IPPROTO_UDP);
    if(sd < 0) FUNC9();

    len = FUNC5(
        0xffffffff,
        0,
        0,
        buff,
        sizeof(buff),
        "status");
    len = FUNC6(sd, buff, len, buff, sizeof(buff), 1);

    if(*buff == '\\') {
        FUNC4("- the port you have specified seems a query port so I try to query it:\n");
        len = FUNC6(sd, "\\status\\", 8, buff, sizeof(buff), 1);
        len = FUNC3(buff, 0);
        if(len > 0) {
            FUNC4("- relaunch this tool specifying the port %d\n\n", len);
        }
        FUNC0(sd);
        FUNC1(1);
    }

    proto = FUNC3(text, 1);

    if(onlyinfo || *retproto) return;

    if(proto < 0) {
        FUNC4(
            "- no server protocol specified in the server's reply.\n"
            "  I try to retrieve it with a fast scanning\n");
        for(proto = MINPROTO; proto < MAXPROTO; proto++) {
            FUNC4("- try protocol %d: ", proto);

            len = FUNC5(
                0xffffffff,
                0,
                0,
                buff,
                sizeof(buff),
                "info %d",
                proto);
            len = FUNC6(sd, buff, len, buff, sizeof(buff), 0);
            if(len < 0) {
                FUNC4("- no reply from the server, I try to get protocol from challenge");
                len = FUNC5(
                    0xffffffff,
                    0,
                    0,
                    buff,
                    sizeof(buff),
                    "getchallenge\n");
                len = FUNC6(sd, buff, len, buff, sizeof(buff), 1);
                FUNC4("  %s\n", text);
                p = FUNC10(text, '=');
                if(p) {
                    FUNC8(p + 1, "%d", &proto);
                } else {
                    FUNC4("- no protocol in the reply from the server\n");
                    proto = 35;
                }
                break;
            }

            if(!FUNC11(text, "wrong")) break;
            FUNC4("%s\n", text);
        }
        if(proto == MAXPROTO) {
            FUNC4("\nError: I have not been able to retrieve the server's protocol\n\n");
            FUNC1(1);
        }
        FUNC2('\n', stdout);
    }

    FUNC0(sd);
    *retproto = proto;
}