#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  buf ;

/* Variables and functions */
 unsigned char AYT ; 
 int /*<<< orphan*/  EXIT_FAILURE ; 
 unsigned char IAC ; 
 unsigned char TELOPT_ENCRYPT ; 
 unsigned char TELOPT_NAOL ; 
 unsigned char WILL ; 
 int /*<<< orphan*/  bs ; 
 int /*<<< orphan*/  bs34 ; 
 int /*<<< orphan*/  FUNC0 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC1 (char*,unsigned char*,int) ; 
 scalar_t__ FUNC2 (unsigned char*,unsigned char*,unsigned int) ; 
 int mode ; 
 int /*<<< orphan*/  FUNC3 (char*) ; 
 int /*<<< orphan*/  FUNC4 (char*,...) ; 
 int FUNC5 (int,unsigned char*,int) ; 
 int FUNC6 (int,unsigned char*,int,int /*<<< orphan*/ ) ; 

int
FUNC7 (int fd)
{
        int             n;
        unsigned int    expect_len = 15;
        unsigned char   expected[] =
                "\x0d\x0a\x5b\x59\x65\x73\x5d\x0d\x0a\xff\xfe\x08\xff\xfd\x26";
                /* \r  \n  [   Y   e   s   ]   \r  \n IAC DONT 08 IAC DO 26*/
        unsigned int    additional_len = 8;
        unsigned char   additional[] =
                "\xff\xfa\x26\x01\x01\x02\xff\xf0";
                /*IAC SB  ENC ........... IAC SE */

        unsigned char   buf[128];

        FUNC5 (fd, buf, sizeof (buf));

        n = 0;
        buf[n++] = IAC;                 /* 0xff */
        buf[n++] = AYT;                 /* 0xf6 */

        buf[n++] = IAC;                 /* 0xff */
        buf[n++] = WILL;                /* 0xfb */
        buf[n++] = TELOPT_NAOL;         /* 0x08 */

        buf[n++] = IAC;                 /* 0xff */
        buf[n++] = WILL;                /* 0xfb */
        buf[n++] = TELOPT_ENCRYPT;      /* 0x26 */

#ifdef DEBUG
        hexdump ("check send buffer", buf, n);
#endif
        if (FUNC6 (fd, buf, n, 0) != n) {
                FUNC3 ("xp_check:send");
                FUNC0 (EXIT_FAILURE);
        }

        n = FUNC5 (fd, buf, sizeof (buf));
#ifdef DEBUG
        hexdump ("check recv buffer", buf, n);
#endif

        if (FUNC2 (buf, expected, expect_len) == 0) {
                if (FUNC2 (buf+expect_len, additional, additional_len) == 0) {
                        mode = 16;
                } else {
                        mode = 34;
                        bs = bs34;
                }
                FUNC4 ("check: PASSED, using %dmb mode\n", mode);

                return (1);
        }

        FUNC4 ("check: FAILED\n");

        return (0);
}