#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  int /*<<< orphan*/  version ;
struct TYPE_2__ {scalar_t__ s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
typedef  int /*<<< orphan*/  s ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 char* OK ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int FUNC0 (int,struct sockaddr*,int*) ; 
 int /*<<< orphan*/  FUNC1 (long) ; 
 int /*<<< orphan*/  FUNC2 (int,struct sockaddr*,int) ; 
 char* FUNC3 (char*) ; 
 int /*<<< orphan*/  FUNC4 (char*) ; 
 int /*<<< orphan*/  FUNC5 (int) ; 
 int /*<<< orphan*/  errno ; 
 int /*<<< orphan*/  FUNC6 (int) ; 
 int /*<<< orphan*/  FUNC7 () ; 
 int /*<<< orphan*/  FUNC8 (int /*<<< orphan*/ ,char*,...) ; 
 int /*<<< orphan*/  FUNC9 (int) ; 
 char* FUNC10 (TYPE_1__) ; 
 int /*<<< orphan*/  FUNC11 (int,int) ; 
 int /*<<< orphan*/  FUNC12 (char*,int /*<<< orphan*/ ,int) ; 
 int FUNC13 (int,char*,int) ; 
 long FUNC14 (char*) ; 
 int FUNC15 (int,char*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC16 (int) ; 
 int /*<<< orphan*/  FUNC17 (char*,int,char*,char*) ; 
 int FUNC18 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  stdout ; 
 char* FUNC19 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC20 (char*) ; 
 int /*<<< orphan*/  FUNC21 (char*,char*,int) ; 
 char* FUNC22 (char*,char*) ; 

void
FUNC23(int port)
{
  struct sockaddr_in s;
  int size, fd, fd2, i, r, cancel = 0;
  char data[1024], version[32], request[512];
  char *ptr;
  long host = 0;

  FUNC12(data,0,1024);

  FUNC8(stdout,"[+] Setting up a fake HTTP server...\n");
 
  fd = FUNC18(AF_INET,SOCK_STREAM,0);
  if(fd < 0)
  {
    FUNC8(stderr,"[-] %s\n",FUNC19(errno));
    FUNC6(1);
  }

  s.sin_family = AF_INET;
  s.sin_port = FUNC9(port);
  s.sin_addr.s_addr = 0;

  FUNC2(fd,(struct sockaddr *) &s,sizeof(s));
  FUNC11(fd,1);
  size = sizeof(s);
  
  FUNC8(stdout,"[+] Awaiting connection on port %i\n",port);

  while(1)
  {
    cancel = 0;
    fd2 = FUNC0(fd,(struct sockaddr *) &s, &size);

    if(!FUNC7())
    {
      FUNC5(fd);
      while(1)
      {
      FUNC12(data,0,1024);
      r = FUNC13(fd2,data,1024);
      if((ptr = FUNC22(data,"User-Agent: lftp")) != NULL)
      {
        if(FUNC22(data,"HEAD"))
        {
          FUNC8(stdout,"[%s] HEAD request received.\n",FUNC10(s.sin_addr));
          size = FUNC15(fd2, OK, FUNC20(OK), 0);
          if(size < 0)
          {
          FUNC8(stderr,"[-] %s\n",FUNC19(errno));
          FUNC5(fd2);
          FUNC6(1);
          }
        }
        if(FUNC22(data,"GET"))
        {
          FUNC12(request,0,512);
          FUNC12(version,0,32);

          FUNC21(version,ptr+12,10);
          version[sizeof(version)-1] = '\0';

          FUNC8(stdout,"[%s] GET request received.\n",FUNC10(s.sin_addr));
          FUNC8(stdout,"[%s] Remote version of lftp: %s ",FUNC10(s.sin_addr),version);
          FUNC4(version);

          FUNC17(request,512,"HTTP/1.1 200 OK\n"
                 "Server: thttpd/2.21 20apr2001\n"
                 "Content-Type: text/html\n"
                 "Date: Sun, 21 Dec 2003 16:29:44 GMT\n"
                 "Last-Modified: Sun, 21 Dec 2003 16:23:41 GMT\n"
                 "Accept-Ranges: bytes\n"
                 "Connection: close\n\n"
                 "<a href=\"/\">empty</a>\tFri May 30 10:09:06 2001 %s\n",FUNC3((char*)FUNC10(s.sin_addr)));

          size = FUNC15(fd2, request, FUNC20(request), 0);
          if(size < 0)
          {
          FUNC8(stderr,"[-] %s\n",FUNC19(errno));
          FUNC5(fd2);
          FUNC6(1);
          }
          FUNC16(2);
          host = FUNC14((char *)FUNC10(s.sin_addr));
          FUNC1(host);
          cancel = 1;
          break;
        }
      }
      }
      if(cancel == 1) break;
    }
    FUNC5(fd2);
  }
  return;
}