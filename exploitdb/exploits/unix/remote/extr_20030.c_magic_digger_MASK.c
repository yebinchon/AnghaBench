#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */

/* Type definitions */

/* Variables and functions */
 int MAX_FAILED ; 
 int MAX_MAGIC ; 
 int /*<<< orphan*/  FUNC0 (char*,int) ; 
 int /*<<< orphan*/  errno ; 
 int /*<<< orphan*/  FUNC1 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC2 (int /*<<< orphan*/ ) ; 
 int* magic ; 
 scalar_t__ FUNC3 (int,char*) ; 
 int FUNC4 (int,char*) ; 
 scalar_t__ FUNC5 (int,char*) ; 
 int* magic_d ; 
 char* magic_str ; 
 scalar_t__ FUNC6 (int) ; 
 int /*<<< orphan*/  FUNC7 (char*) ; 
 int /*<<< orphan*/  FUNC8 (char*,char*) ; 
 int /*<<< orphan*/  FUNC9 (char) ; 
 int /*<<< orphan*/  stdout ; 

int FUNC10(int sock)
{
 int get_out=1,where=0,all_failed=MAX_FAILED*2,f=0,o=0;
        
 if(magic_str==NULL){
  if((magic_str=(char*)FUNC6(4092))==NULL){
   FUNC7("malloc");
   FUNC1(errno);
  }
 }
 (void)FUNC0(magic_str, 4092);
 where=0;
 while(get_out) {
  int q;
  if( where >= MAX_MAGIC-1 || all_failed <= 0 )
    return -1;
  if( FUNC3(sock, magic_str) ) {
   o=0,f++;
    if(f==1){
     if(!magic[where])
      magic[where]=1;
     else
      magic[++where]+=1;
    magic_d[where]=1;
    } else
     magic[where]+=1;
   all_failed=MAX_FAILED*2;
   FUNC8("%s", "%.f"); FUNC2(stdout);
   goto verify;
  }
  all_failed--;
  if((q=FUNC4(sock,magic_str))){
   f=0,o++;
    if(o==1){
     if(!magic[where])
      magic[0]=1;
     else
      magic[++where]+=1;
    magic_d[where]=q;
   } else {
    if(magic_d[where]==q)
     magic[where]+=1;
    else {
     magic[++where]=1;
     magic_d[where]=q;
    }
   }
   all_failed=MAX_FAILED*2;
   FUNC8("%s", q==2?"%c":"%d");
   FUNC2(stdout);
   goto verify;
  }
  all_failed--;
  continue;
  verify:
  if(FUNC5(sock,magic_str)){
   FUNC9('\n');
   return 0;
  }
 }
 return 0;
}