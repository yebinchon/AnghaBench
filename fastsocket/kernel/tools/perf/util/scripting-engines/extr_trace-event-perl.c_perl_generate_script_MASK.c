#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_2__   TYPE_1__ ;

/* Type definitions */
struct pevent {int dummy; } ;
struct format_field {char* name; int flags; struct format_field* next; } ;
struct TYPE_2__ {struct format_field* fields; } ;
struct event_format {char* system; char* name; TYPE_1__ format; } ;
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 int FIELD_IS_FLAG ; 
 int FIELD_IS_SIGNED ; 
 int FIELD_IS_STRING ; 
 int FIELD_IS_SYMBOLIC ; 
 int PATH_MAX ; 
 int /*<<< orphan*/  FUNC0 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC1 (char*,char*) ; 
 int /*<<< orphan*/  FUNC2 (int /*<<< orphan*/ *,char*,...) ; 
 int /*<<< orphan*/  FUNC3 (char*,char*,char const*) ; 
 int /*<<< orphan*/ * stderr ; 
 struct event_format* FUNC4 (struct pevent*,struct event_format*) ; 

__attribute__((used)) static int FUNC5(struct pevent *pevent, const char *outfile)
{
	struct event_format *event = NULL;
	struct format_field *f;
	char fname[PATH_MAX];
	int not_first, count;
	FILE *ofp;

	FUNC3(fname, "%s.pl", outfile);
	ofp = FUNC1(fname, "w");
	if (ofp == NULL) {
		FUNC2(stderr, "couldn't open %s\n", fname);
		return -1;
	}

	FUNC2(ofp, "# perf script event handlers, "
		"generated by perf script -g perl\n");

	FUNC2(ofp, "# Licensed under the terms of the GNU GPL"
		" License version 2\n\n");

	FUNC2(ofp, "# The common_* event handler fields are the most useful "
		"fields common to\n");

	FUNC2(ofp, "# all events.  They don't necessarily correspond to "
		"the 'common_*' fields\n");

	FUNC2(ofp, "# in the format files.  Those fields not available as "
		"handler params can\n");

	FUNC2(ofp, "# be retrieved using Perl functions of the form "
		"common_*($context).\n");

	FUNC2(ofp, "# See Context.pm for the list of available "
		"functions.\n\n");

	FUNC2(ofp, "use lib \"$ENV{'PERF_EXEC_PATH'}/scripts/perl/"
		"Perf-Trace-Util/lib\";\n");

	FUNC2(ofp, "use lib \"./Perf-Trace-Util/lib\";\n");
	FUNC2(ofp, "use Perf::Trace::Core;\n");
	FUNC2(ofp, "use Perf::Trace::Context;\n");
	FUNC2(ofp, "use Perf::Trace::Util;\n\n");

	FUNC2(ofp, "sub trace_begin\n{\n\t# optional\n}\n\n");
	FUNC2(ofp, "sub trace_end\n{\n\t# optional\n}\n\n");

	while ((event = FUNC4(pevent, event))) {
		FUNC2(ofp, "sub %s::%s\n{\n", event->system, event->name);
		FUNC2(ofp, "\tmy (");

		FUNC2(ofp, "$event_name, ");
		FUNC2(ofp, "$context, ");
		FUNC2(ofp, "$common_cpu, ");
		FUNC2(ofp, "$common_secs, ");
		FUNC2(ofp, "$common_nsecs,\n");
		FUNC2(ofp, "\t    $common_pid, ");
		FUNC2(ofp, "$common_comm,\n\t    ");

		not_first = 0;
		count = 0;

		for (f = event->format.fields; f; f = f->next) {
			if (not_first++)
				FUNC2(ofp, ", ");
			if (++count % 5 == 0)
				FUNC2(ofp, "\n\t    ");

			FUNC2(ofp, "$%s", f->name);
		}
		FUNC2(ofp, ") = @_;\n\n");

		FUNC2(ofp, "\tprint_header($event_name, $common_cpu, "
			"$common_secs, $common_nsecs,\n\t             "
			"$common_pid, $common_comm);\n\n");

		FUNC2(ofp, "\tprintf(\"");

		not_first = 0;
		count = 0;

		for (f = event->format.fields; f; f = f->next) {
			if (not_first++)
				FUNC2(ofp, ", ");
			if (count && count % 4 == 0) {
				FUNC2(ofp, "\".\n\t       \"");
			}
			count++;

			FUNC2(ofp, "%s=", f->name);
			if (f->flags & FIELD_IS_STRING ||
			    f->flags & FIELD_IS_FLAG ||
			    f->flags & FIELD_IS_SYMBOLIC)
				FUNC2(ofp, "%%s");
			else if (f->flags & FIELD_IS_SIGNED)
				FUNC2(ofp, "%%d");
			else
				FUNC2(ofp, "%%u");
		}

		FUNC2(ofp, "\\n\",\n\t       ");

		not_first = 0;
		count = 0;

		for (f = event->format.fields; f; f = f->next) {
			if (not_first++)
				FUNC2(ofp, ", ");

			if (++count % 5 == 0)
				FUNC2(ofp, "\n\t       ");

			if (f->flags & FIELD_IS_FLAG) {
				if ((count - 1) % 5 != 0) {
					FUNC2(ofp, "\n\t       ");
					count = 4;
				}
				FUNC2(ofp, "flag_str(\"");
				FUNC2(ofp, "%s::%s\", ", event->system,
					event->name);
				FUNC2(ofp, "\"%s\", $%s)", f->name,
					f->name);
			} else if (f->flags & FIELD_IS_SYMBOLIC) {
				if ((count - 1) % 5 != 0) {
					FUNC2(ofp, "\n\t       ");
					count = 4;
				}
				FUNC2(ofp, "symbol_str(\"");
				FUNC2(ofp, "%s::%s\", ", event->system,
					event->name);
				FUNC2(ofp, "\"%s\", $%s)", f->name,
					f->name);
			} else
				FUNC2(ofp, "$%s", f->name);
		}

		FUNC2(ofp, ");\n");
		FUNC2(ofp, "}\n\n");
	}

	FUNC2(ofp, "sub trace_unhandled\n{\n\tmy ($event_name, $context, "
		"$common_cpu, $common_secs, $common_nsecs,\n\t    "
		"$common_pid, $common_comm) = @_;\n\n");

	FUNC2(ofp, "\tprint_header($event_name, $common_cpu, "
		"$common_secs, $common_nsecs,\n\t             $common_pid, "
		"$common_comm);\n}\n\n");

	FUNC2(ofp, "sub print_header\n{\n"
		"\tmy ($event_name, $cpu, $secs, $nsecs, $pid, $comm) = @_;\n\n"
		"\tprintf(\"%%-20s %%5u %%05u.%%09u %%8u %%-20s \",\n\t       "
		"$event_name, $cpu, $secs, $nsecs, $pid, $comm);\n}\n");

	FUNC2(ofp,
		"\n# Packed byte string args of process_event():\n"
		"#\n"
		"# $event:\tunion perf_event\tutil/event.h\n"
		"# $attr:\tstruct perf_event_attr\tlinux/perf_event.h\n"
		"# $sample:\tstruct perf_sample\tutil/event.h\n"
		"# $raw_data:\tperf_sample->raw_data\tutil/event.h\n"
		"\n"
		"sub process_event\n"
		"{\n"
		"\tmy ($event, $attr, $sample, $raw_data) = @_;\n"
		"\n"
		"\tmy @event\t= unpack(\"LSS\", $event);\n"
		"\tmy @attr\t= unpack(\"LLQQQQQLLQQ\", $attr);\n"
		"\tmy @sample\t= unpack(\"QLLQQQQQLL\", $sample);\n"
		"\tmy @raw_data\t= unpack(\"C*\", $raw_data);\n"
		"\n"
		"\tuse Data::Dumper;\n"
		"\tprint Dumper \\@event, \\@attr, \\@sample, \\@raw_data;\n"
		"}\n");

	FUNC0(ofp);

	FUNC2(stderr, "generated Perl script: %s\n", fname);

	return 0;
}