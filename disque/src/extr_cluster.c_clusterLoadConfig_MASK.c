#define NULL ((void*)0)
typedef unsigned long size_t;  // Customize by platform.
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;  // Either arithmetic or pointer type.
/* By default, we understand bool (as a convenience). */
typedef int bool;
#define false 0
#define true 1

/* Forward declarations */
typedef  struct TYPE_10__   TYPE_3__ ;
typedef  struct TYPE_9__   TYPE_2__ ;
typedef  struct TYPE_8__   TYPE_1__ ;

/* Type definitions */
struct stat {scalar_t__ st_size; } ;
typedef  char* sds ;
struct TYPE_9__ {int /*<<< orphan*/  name; void* pong_received; void* ping_sent; int /*<<< orphan*/  flags; void* fail_time; scalar_t__ port; int /*<<< orphan*/  ip; } ;
typedef  TYPE_2__ clusterNode ;
struct TYPE_10__ {TYPE_1__* cluster; } ;
struct TYPE_8__ {TYPE_2__* myself; } ;
typedef  int /*<<< orphan*/  FILE ;

/* Variables and functions */
 scalar_t__ CLUSTER_NAMELEN ; 
 int /*<<< orphan*/  CLUSTER_NODE_FAIL ; 
 int /*<<< orphan*/  CLUSTER_NODE_HANDSHAKE ; 
 int /*<<< orphan*/  CLUSTER_NODE_LEAVING ; 
 int /*<<< orphan*/  CLUSTER_NODE_MYSELF ; 
 int /*<<< orphan*/  CLUSTER_NODE_NOADDR ; 
 int /*<<< orphan*/  CLUSTER_NODE_PFAIL ; 
 int C_ERR ; 
 int C_OK ; 
 scalar_t__ ENOENT ; 
 int /*<<< orphan*/  LL_NOTICE ; 
 int /*<<< orphan*/  LL_WARNING ; 
 scalar_t__ FUNC0 (char*) ; 
 int /*<<< orphan*/  FUNC1 (TYPE_2__*) ; 
 TYPE_2__* FUNC2 (char*) ; 
 TYPE_2__* FUNC3 (char*,int /*<<< orphan*/ ) ; 
 scalar_t__ errno ; 
 int /*<<< orphan*/  FUNC4 (int) ; 
 int /*<<< orphan*/  FUNC5 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC6 (char*,int,int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/  FUNC7 (int /*<<< orphan*/ *) ; 
 int /*<<< orphan*/ * FUNC8 (char*,char*) ; 
 int FUNC9 (int /*<<< orphan*/ ,struct stat*) ; 
 int /*<<< orphan*/  FUNC10 (int /*<<< orphan*/ ,char*,scalar_t__) ; 
 void* FUNC11 () ; 
 TYPE_2__* myself ; 
 int /*<<< orphan*/  FUNC12 (char**,int) ; 
 char** FUNC13 (char*,int*) ; 
 TYPE_3__ server ; 
 int /*<<< orphan*/  FUNC14 (int /*<<< orphan*/ ) ; 
 int /*<<< orphan*/  FUNC15 (int /*<<< orphan*/ ,char*,...) ; 
 int /*<<< orphan*/  FUNC16 (char*) ; 
 scalar_t__ FUNC17 (char*,char*) ; 
 char* FUNC18 (char*,char) ; 
 int /*<<< orphan*/  FUNC19 (scalar_t__) ; 
 scalar_t__ FUNC20 (char*) ; 
 char* FUNC21 (char*,char) ; 
 int /*<<< orphan*/  FUNC22 (char*) ; 
 char* FUNC23 (int) ; 

int FUNC24(char *filename) {
    FILE *fp = FUNC8(filename,"r");
    struct stat sb;
    char *line;
    int maxline, j;

    if (fp == NULL) {
        if (errno == ENOENT) {
            return C_ERR;
        } else {
            FUNC15(LL_WARNING,
                "Loading the cluster node config from %s: %s",
                filename, FUNC19(errno));
            FUNC4(1);
        }
    }

    /* Check if the file is zero-length: if so return C_ERR to signal
     * we have to write the config. */
    if (FUNC9(FUNC7(fp),&sb) != -1 && sb.st_size == 0) {
        FUNC5(fp);
        return C_ERR;
    }

    /* Parse the file. */
    maxline = 1024;
    line = FUNC23(maxline);
    while(FUNC6(line,maxline,fp) != NULL) {
        int argc;
        sds *argv;
        clusterNode *n;
        char *p, *s;

        /* Skip blank lines, they can be created either by users manually
         * editing nodes.conf or by the config writing process if stopped
         * before the truncate() call. */
        if (line[0] == '\n') continue;

        /* Split the line into arguments for processing. */
        argv = FUNC13(line,&argc);
        if (argv == NULL) goto fmterr;

        /* Handle the special "vars" line. Don't pretend it is the last
         * line even if it actually is when generated by Disque. */
        if (FUNC17(argv[0],"vars") == 0) {
            for (j = 1; j < argc; j += 2) {
                if (FUNC17(argv[j],"someVarNameHere") == 0) {
                    /* TODO: currently not used. */
                } else {
                    FUNC15(LL_WARNING,
                        "Skipping unknown cluster config variable '%s'",
                        argv[j]);
                }
            }
            FUNC12(argv,argc);
            continue;
        }

        /* Regular config lines have at least eight fields */
        if (argc != 6) goto fmterr;

        /* Create this node if it does not exist */
        if (FUNC20(argv[0]) != CLUSTER_NAMELEN) goto fmterr;
        n = FUNC2(argv[0]);
        if (!n) {
            n = FUNC3(argv[0],0);
            FUNC1(n);
        }
        /* Address and port */
        if ((p = FUNC21(argv[1],':')) == NULL) goto fmterr;
        *p = '\0';
        FUNC10(n->ip,argv[1],FUNC20(argv[1])+1);
        n->port = FUNC0(p+1);

        /* Parse flags */
        p = s = argv[2];
        while(p) {
            p = FUNC18(s,',');
            if (p) *p = '\0';
            if (!FUNC17(s,"myself")) {
                FUNC14(server.cluster->myself == NULL);
                myself = server.cluster->myself = n;
                n->flags |= CLUSTER_NODE_MYSELF;
            } else if (!FUNC17(s,"fail?")) {
                n->flags |= CLUSTER_NODE_PFAIL;
            } else if (!FUNC17(s,"fail")) {
                n->flags |= CLUSTER_NODE_FAIL;
                n->fail_time = FUNC11();
            } else if (!FUNC17(s,"handshake")) {
                n->flags |= CLUSTER_NODE_HANDSHAKE;
            } else if (!FUNC17(s,"noaddr")) {
                n->flags |= CLUSTER_NODE_NOADDR;
            } else if (!FUNC17(s,"leaving")) {
                n->flags |= CLUSTER_NODE_LEAVING;
            } else if (!FUNC17(s,"noflags")) {
                /* nothing to do */
            } else {
                FUNC16("Unknown flag in disque cluster config file");
            }
            if (p) s = p+1;
        }

        /* Set ping sent / pong received timestamps */
        if (FUNC0(argv[3])) n->ping_sent = FUNC11();
        if (FUNC0(argv[4])) n->pong_received = FUNC11();

        FUNC12(argv,argc);
    }
    /* Config sanity check */
    if (server.cluster->myself == NULL) goto fmterr;

    FUNC22(line);
    FUNC5(fp);

    FUNC15(LL_NOTICE,"Node configuration loaded, I'm %.40s", myself->name);
    return C_OK;

fmterr:
    FUNC15(LL_WARNING,
        "Unrecoverable error: corrupted cluster config file.");
    FUNC22(line);
    if (fp) FUNC5(fp);
    FUNC4(1);
}